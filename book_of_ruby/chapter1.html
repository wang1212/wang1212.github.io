<!DOCTYPE html>
<html lang="en">
<body>
	<header class="hidden-sm-down text-xs-left">
		<h1>Chapter One</h1><hr />
		<h2>Strings, Numbers, Classes and Objects</h2>
		<ul>
			<li class="h3">Getting and Putting Input</li>
			<li class="h3">Strings and  Embedded  Evaluation</li>
			<li class="h3">Numbers</li>
			<li class="h3">Testing a Condition: if…then</li>
			<li class="h3">Local and Global Variables</li>
			<li class="h3">Classes and Objects</li>
			<li class="h3">Instance Variables</li>
			<li class="h3">Messages, Methods and Polymorphism</li>
			<li class="h3">Constructors-new and Iniatialize</li>
			<li class="h3">Inspecting Objects</li>
		</ul>
	</header>
	<h1>第一章</h1><hr />
	<section>
		<h2 id="page-title">字符串、数字、类和对象</h2>
		<p class="head-indent">
			关于 Ruby 语言，首先要知道的是它是易于使用的。为了证明这一点，让我们来看一看经典的 "Hello world" 程序代码：
		</p>
		<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;1helloworld.rb</div>
		<pre class="language-ruby line-numbers"><code>puts 'hello world'</code></pre>
		<p class="head-indent">
			这就是完整的代码。用到了一个<code>puts</code>方法和一个<code>'Hello world'</code>字符串。没有文件头或者类定义，也不需要导入其他代码和<code>main</code>方法。这真的就是那么简单。（自己）加载这段代码，<strong>1helloworld.rb</strong>，试着运行一下。
		</p>
		<section>
			<h3>获取并保存输入信息</h3>
			<p class="head-indent">
				首先将一个提示字符串输出后（这里是命令行窗口），显然下一步就是获取一个字符串。正如你可能猜到的，Ruby 为此提供的是<code>gets</code>方法。<strong>2helloname.rb</strong> 这段程序提示用户输入他们的名字，假设输入的是 'Fred'，随后将显示一句问候语："Hello Fred"。
			</p>
			<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;2helloname.rb</div>
			<pre class="language-ruby line-numbers"><code>print( 'Enter your name: ' )
name = gets()
puts( "Hello #{name}" )</code></pre>
			<p class="head-indent">
				虽然说这仍然非常地简单，但有一些重要的细节需要说明。首先，注意我输出提示的时候使用的是<code>print</code>方法而不是<code>puts</code>方法。这是因为<code>puts</code>方法会在末尾自动添加一个换行符，但<code>print</code>方法则不会；而当前我希望光标和提示能在同一行显示。
			</p>
			<p class="head-indent">
				在下一行，当用户按下<kbd>Enter</kbd>键时，我使用<code>gets()</code>方法读取用户的输入并以字符串类型保存。该字符串会被赋值给<code>name</code>变量（variable）。我没有预先声明该变量，也没有指定它的类型。在 Ruby 中，你可以根据需要去创建变量，并且 Ruby 会自动去推断该变量的类型。现在我将一个字符串赋值给了<code>name</code>，因此 Ruby 推断<code>name</code>变量的类型一定是字符串（String）。
			</p>
			<div class="note head-indent">
				<strong>注意：Ruby 是大小写敏感的。</strong>一个名为<code>myvar</code>的变量和名为<code>myVar</code>的变量是不同的。一个和示例程序中<code>name</code>一样的变量，它的名字必须以小写字母开头（如果以大写字母开头，Ruby 会认为它是一个常量（constant），关于常量在后面的章节我会详细说明。）
			</div>
			<p class="head-indent">
				顺便说一下，<code>gets()</code>方法的括号是可选的，它与<code>print</code>和<code>puts</code>方法用来包围字符串的括号是一样的，如果你移除了括号，仍然会得到相同的结果。但是，括号可以帮助你解决某些语义冲突，并且在某些情况下，如果你省略它们，解释器将会发出警告。
			</p>
		</section>
		<section>
			<h3>字符串与内嵌表达式</h3>
			<p class="head-indent">在我们的示例代码中，最后一行是相当有趣的。</p>
			<pre class="language-ruby line-numbers"><code>puts( "Hello #{name}" )</code></pre>
			<p class="head-indent">
				这里的<code>name</code>变量被嵌入到字符串（String）本身中。这是通过将变量放置于两个花括号中并在花括号前面加一个 # 字符实现，也就是<code>#{}</code>。这种嵌入式表达式仅限于使用双引号分隔的字符串中起作用。如果你尝试在单引号分隔的字符串中使用它，该变量将不会被执行（解释），恰恰显示的将会是字符串 <strong>'Hello #{name}'</strong>。
			</p>
			<p class="head-indent">不仅仅只有变量可以嵌入到双引号分隔的字符串中。你也可以嵌入非打印（转义）字符，例如换行符<code>\n</code>和制表符<code>\t</code>。你甚至也可以嵌入程序代码和数学表达式。让我们假设你拥有一个方法<code>showname</code>，它的返回值为字符串 'Fred'。
			</p>
			<p class="head-indent">
				下面这个字符串在执行过程中将会调用<code>showname</code>方法，因此，最终结果将会显示为 "Hello Fred"：
			</p>
			<pre class="language-ruby line-numbers"><code>puts "Hello #{showname}"</code></pre>
			<p class="head-indent">看你是否能弄清楚下面这段程序将会显示什么结果：</p>
			<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;3string_eval.rb</div>
			<pre class="language-ruby line-numbers"><code>puts("\n\t#{(1 + 2) * 3}\nGoodbye")</code></pre>
			<p class="head-indent">运行一下 <strong>3string_eval.rb</strong> 程序看看你对了吗。</p>
		</section>
		<section>
			<h3>数字</h3>
			<p class="head-indent">
				数字（Numbers）和字符串一样容易使用。例如，你想基于税率值和合计值来计算一些东西的销售价格或者总的合计值。为此，你需要将合计值乘以合适的税率并将结果加上合计值。假设合计值为 100 美元，税率为 17.5% ，这个 Ruby 程序会进行计算并显示结果：
			</p>
			<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;4calctax.rb</div>
			<pre class="language-ruby line-numbers"><code>subtotal = 100.00
taxrate = 0.175
tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</code></pre>
			<p class="head-indent">
				显然，如果这个程序可以计算不同的合计值的话，相比于计算相同的合计值是更有用的。这是一个简单的可以提示用户输入合计值的计算程序：
			</p>
			<pre class="language-ruby line-numbers"><code>taxrate = 0.175
print "Enter price (ex tax): "
s = gets
subtotal = s.to_f
tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</code></pre>
			<p class="head-indent">
				这里的<code>s.to_f</code>是 String 类的一个方法，它会尝试将该字符串转换成一个浮点数。例如，字符串 "145.45" 将被转换成浮点数 145.45 。如果字符串不能被转换，将会返回 0.0 。所以，对于 <strong>"Hello world".to_f</strong> 将会返回 0.0 。
			</p>
			<div class="note">
				<dl>
					<dt>注释</dt>
					<dd class="head-indent">本书附带的许多示例源代码都有会被 Ruby 解释器忽略的注释。注释可以放置于 <strong>#</strong> 字符之后，该字符之后的一行文本都将会被视为注释：</dd>
				</dl>
				<pre class="language-ruby line-numbers"><code># this is a comment
puts( "hello" ) # this is also a comment</code></pre>
				<p class="head-indent">
					如果你想注释掉多行文本你可以在文本的首行添加 <strong>=begin</strong> 以及在末行添加 <strong>=end</strong>（<strong>=begin</strong> 与 <strong>=end</strong> 必须左对齐顶格写）：
				</p>
				<pre class="language-ruby line-numbers"><code>=begin
This is a
multiline
comment
=end</code></pre>
			</div>
		</section>
		<section>
			<h3>测试条件语句：if ... then</h3>
			<p class="head-indent">
				上面的税率值计算代码的问题是允许负的合计值和税率，这种情况在政府看来可能是不利的。因此，我需要测试负数，如果出现负数将其置为 0 。这是我的新版代码：
			</p>
			<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;5taxcalculator.rb</div>
			<pre class="language-ruby line-numbers"><code>taxrate = 0.175
print "Enter price (ex tax): "
s = gets
subtotal = s.to_f

if (subtotal < 0.0) then
  subtotal = 0.0
end

tax = subtotal * taxrate
puts "Tax on $#{subtotal} is $#{tax}, so grand total is $#{subtotal+tax}"</code></pre>
			<p class="head-indent">
				Ruby 中的<code>if</code>测试语句与其他编程语言中的<code>if</code>相似。注意，这里的括号也是可选的，<code>then</code>也一样。但是，你如果在测试条件之后没有换行符的情况下继续写代码，那么<code>then</code>不能省略：
			</p>
			<pre class="language-ruby line-numbers"><code>if (subtotal < 0.0) then subtotal = 0.0 end</code></pre>
			<p class="head-indent">
				将所有代码写在同一行不会增加代码的清晰度，我会避免这么写。我长期习惯于 Pascal 书写风格所以导致我经常在<code>if</code>条件之后添加<code>then</code>，然而这真的是不需要的，你可以将其看成我的一个癖好。<code>if</code>代码块末尾的<code>end</code>关键字不是可选的，忘记添加它的话你的代码将不会运行。
			</p>
		</section>
		<section>
			<h3>局部变量与全局变量</h3>
			<p class="head-indent">
				在前面的示例中，我将值赋给了变量，例如<code>subtotal</code>、<code>tax</code>和<code>taxrate</code>。这些以小写字母开头的变量都是局部变量（Local variables），这意味着它们只存在于程序的特定部分。换句话说，它们被限制一个定义明确的作用域（scope）内。这是一个实例：
			</p>
			<div style="font-weight: 600"><span class="fa fa-file-code-o"></span>&nbsp;variables.rb</div>
			<pre class="language-ruby line-numbers"><code>localvar = "hello"
$globalvar = "goodbye"

def amethod
  localvar = 10
  puts(localvar)
  puts($globalvar)
end

def anotherMethod
  localvar = 500
  $globalvar = "bonjour"
  puts(localvar)
  puts($globalvar)
end</code></pre>
			<p class="head-indent">
				这里有三个名为<code>localvar</code>的局部变量，一个在 main 作用域内被赋值为 "hello" ;其它的两个分别在独立的方法作用域内被赋值为整数（Integers）：因为每一个局部变量都有不同的作用域，赋值并不影响在其它作用域中同名的局部变量。你可以通过调用方法来验证：
			</p>
			<pre class="language-ruby line-numbers"><code>amethod  #=> localvar = 10
anotherMethod  #=> localvar = 500
amethod  #=> localvar = 10
puts( localvar )  #=> localvar = "hello"</code></pre>
			<p class="head-indent">
				另一方面，一个以 <strong>$</strong> 字符开头的全局变量拥有全局作用域。当在一个方法中对一个全局变量进行赋值，同时也会影响程序中其它任意作用域中的同名全局变量：
			</p>
			<pre class="language-ruby line-numbers"><code>amethod  #=> $globalvar = "goodbye"
anotherMethod  #=> $globalvar = "bonjour"
amethod  #=> $globalvar = "bonjour"
puts($globalvar) #=> $globalvar = "bonjour"</code></pre>
		</section>
		<section>
			<h3>类与对象</h3>
			<p class="head-indent">
				现在先跳过其余的 Ruby 语法，例如类型（type）、循环（loops）、模块（modules）等等（不要怕，我们会很快回过头来），让我们迅速去看看如何创建类（class）和对象（object）。
			</p>
			<div class="note">
				<dl>
					<dt>类、对象和方法</dt>
					<dd class="head-indent">
						类是对象的大纲蓝图，它定义对象包含的数据以及行为方式。许多不同的对象可以从单一的类创建，所以你可能有一个 Cat 类（<code>class</code>），但是有三个 cat 对象（<code>objects</code>）：<em>tiddles</em>、<em>cuddles</em> 和 <em>flossy</em>。一个方法（<code>method</code>）就像一个定义在类中的函数或子例程。
					</dd>
				</dl>
			</div>
			<p class="head-indent">
				Ruby 是面向对象（object oriented）的似乎没什么特别可说的，现代所有的语言不是如此吗？好吧，说一点。大多数现代的“面向对象”语言（Java、C++、C#、Object  Pascal 等等）或多或少都具有面向对象编程（OOP）的特性。另一方面，Ruby 是纯粹面向对象的。事实上，除非你使用过 Smalltalk 或  Eiffel （比 Ruby 更纯粹的面向对象的语言），否则 Ruby 就是你曾经使用过的语言中最面向对象的语言。从简单的数字和字符串到复杂的文件和模块，每一块数据都被视为一个对象。并且你用对象做的每一件事都是通过方法来完成，甚至“运算符”（operators）也是一个方法，例如加 + 和减 - 。看下面这个程序：
			</p>
			<pre class="language-ruby line-numbers"><code>x = 1 + 2</code></pre>
			<p class="head-indent">
				这里的<code>+</code>是 Fixnum (Integer) 对象 1 的一个方法，值 2 被传入该方法；结果 3 被返回并赋值给 x 对象。顺便地说一下，运算符<code>=</code>是“使用对象做任何事情都是通过方法来完成”这条规则的罕见例外。赋值运算符是一个内置的东西（这不是一个术语，我没有添加）并且它不是用来完成任何事情的一个方法。
			</p>
			<p class="head-indent">
				现在
			</p>
		</section>
	</section>
</body>
</html>