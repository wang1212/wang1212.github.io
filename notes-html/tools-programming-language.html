<p>　　编程语言本质上是给开发者使用的工具，不同的业务领域使用不同的编程语言去实现具体的业务，是基于语言本身的设计理念与实现方式来做选择，那么作为开发者应该了解一下编程语言是如何被发明的，且其设计理念是什么。</p>
<p>　　Ruby 是我大学期间课余接触且实际使用过的一门语言，目前我甚是喜爱，其作者松本行弘设计 Ruby 的初心是：为开发者服务，注重简洁和效率。这篇文章主要也是为了记录在拜读了松本行弘先生新书《编程语言的设计与实现》之后掌握的一些相关的关键知识点和其它收获。由于该书主要是围绕作者在设计 Ruby 和新语言 Streem 过程中的一些思考和经验，有些东西可能不太具备普适性，而我在这里主要还是关注一些通用性的知识点和概念。</p>
<h2 id="为什么要创造编程语言">为什么要创造编程语言</h2>
<p>　　在过去，计算机信息技术行业还不够发达，在没有成为主流的时候，编程语言一般是作为商业化附属品出现的，普通人很难能免费且容易的获取到编程语言作为工具使用。所以，基于需求创造自己的编程语言就显得很合理了。然而，当今由于开源技术的盛行，很多编程语言都以开源的形式存在，作为开发者现在很容易就能获取到不同的编程语言作为自己的工具进行业务开发，那为什么还要创造新的编程语言？或者说，为什么现如今新的语言仍然层出不穷？</p>
<p>　　软件编程本质上是“人机交互”，开发者使用编程语言设计业务逻辑，然后交由机器具体来执行，编程语言作为开发者与机器之间交流的媒介存在。随着时代的发展，业务需求和场景日益复杂，开发者与机器之间的交流也日趋复杂，为了让开发者“更轻松”地与机器交流，抽象度更高且更简洁的新编程语言作为新的交流媒介被发明。回忆一下计算机发展史，软件编程正是遵循从“汇编语言”（指令、0 和 1）到“低级语言”（例如 C/C++，语句、函数、数据类型）再到“高级语言”（例如 Java/Go，面向对象、并发、自动 GC）的发展路径。</p>
<p>　　对于个人来说，创造编程语言，或者说深入了解如何创造编程语言，可以提升自己的技术能力和设计能力，也能在一定程度上打造自己的个人品牌（提高个人声望）。</p>
<h2 id="编程语言的设计与实现">编程语言的设计与实现</h2>
<p>　　对于现今的大多数编程语言来说，都属于“低级语言”和“高级语言”的范畴，而机器只能直接理解汇编语言。那么，设计编程语言是在设计什么？</p>
<h3 id="语言和语言处理器">语言和语言处理器</h3>
<p>　　编程语言在使用过程中可大致分为两个阶段：编写代码和运行代码。前者注重的是语言本身，而后者具体要解决的就是语言代码如何让机器能理解进而执行。</p>
<blockquote>
<p><strong>语言是由语法和词汇构成的。语法是一种规则，规定了在该语言中如何表述才能使程序有效；而词汇是能从使用该语言编写的程序中调用的功能的集合，之后会以库的形式逐渐增加。</strong> 在设计语言的场景中说起词汇，就是指该语言一开始就具备的内置功能。</p>
</blockquote>
<p>　　我们可以用不同的编程语言实现同样的功能，但有的语言实现起来复杂繁琐，但有的语言实现起来简单容易，这就是语言层面的直观体现。可以想象的是，很多新出现的编程语言首要解决的就是该问题，如何设计让语法规则更简单易用，内置功能更加强大。</p>
<p>　　另一方面，用语言编写的代码如何在机器上实际运行？</p>
<blockquote>
<p><strong>语言处理器是能够使语法和词汇在计算机上实际运行的软件。</strong> 要想使编程语言成为真正的语言，而非仅仅停留在一个想法上，是离不开语言处理器的。无法运行的编程语言在严格意义上不能称为编程语言。</p>
</blockquote>
<p>　　我们通常所说的“编译器”、“解释器”、“虚拟机”、&quot;JIT（即时编译）&quot;等概念，均属于语言处理器相关的内容。</p>
<p>　　<strong>所以，编程语言的设计是在设计：语言本身和语言处理器。</strong></p>
<h3 id="语言处理器的构成">语言处理器的构成</h3>
<p>　　先来看看语言处理器相关的内容。</p>
<blockquote>
<p><strong>语言处理器大体上可分为解释语法的“编译器”、相当于词汇的“库”，以及实际运行软件所需的“运行时（系统）”。</strong> 这三大构成要素的比重会因语言和处理器性质的不同而发生变化。</p>
</blockquote>
<p>　　如何理解后一句，来看看具体的实例即可。</p>
<p>　　早期的 TinyBASIC 语言很简单，编译器做的工作很少，主要的处理集中在运行时完成，对于这样的语言处理器可称之为”解释器“（interpreter）。现在这些复杂的语言的处理器都是先将程序编译为内部代码，再在运行时执行内部代码，这种“编译器＋运行时”的组合形式，看起来像源代码未经转换就被直接执行了，因此有时也被称为“解释型”，例如 Ruby。然而，像 C 语言这种在与机器非常接近的层面上追求效率的语言，几乎不存在运行时，只有解释语法的编译器部分非常突出，这样的语言处理器被称为“编译型”。</p>
<blockquote>
<p>在 C 语言这类语言中，作为转换结果的程序（可执行文件）是可以直接运行的软件，所以不需要负责运行的运行时。部分运行时的工作，比如内存管理等，由库和操作系统的系统调用负责。</p>
</blockquote>
<p>　　对于如今市场上主流的 Java 语言，其语言处理器设计较为复杂，首先通过编译器将源代码转换为虚拟机的机器码（JVM 字节码），并由虚拟机（JVM）来执行。而且，为了提高效率，运行时采用了将字节码转换为机器码的即时编译（Just In Time Compiler）等技术。</p>
<h4 id="编译器">编译器</h4>
<p>　　<strong>编译器的工作是将编程语言的源代码（原始语言）转换为可执行的形式（目标语言）。</strong></p>
<h2 id="参考">参考</h2>
<ul>
<li>《松本行弘：编程语言的设计与实现》，[日] 松本行弘，郑明智 译</li>
</ul>
