"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["3670"],{6674:function(e,n,t){t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=t(23690),i=t(85893),s=t(50065);let o={title:"\u89E3\u6790 ZRender \u8BBE\u8BA1\uFF1A\u4E8B\u4EF6\u7CFB\u7EDF",date:new Date("2022-11-01T19:47:00.000Z"),update:new Date("2024-06-16T16:09:00.000Z"),authors:"wang1212",tags:["\u8BA1\u7B97\u673A\u6280\u672F","Web \u524D\u7AEF","\u6570\u636E\u53EF\u89C6\u5316","ZRender","Canvas","\u6E90\u7801\u89E3\u6790"],keywords:["\u8BA1\u7B97\u673A\u6280\u672F","Web \u524D\u7AEF","\u6570\u636E\u53EF\u89C6\u5316","ZRender","Canvas","\u6E90\u7801\u89E3\u6790"],description:"\u7ED8\u56FE\u5F15\u64CE\u652F\u6301\u4E30\u5BCC\u4EA4\u4E92\u7684\u524D\u63D0\u662F\u62E5\u6709\u4E00\u5957\u4E8B\u4EF6\u7CFB\u7EDF\uFF0C\u800C\u5728\u753B\u5E03\u4E2D\u5982\u4F55\u62FE\u53D6\u5143\u7D20\u662F\u5B9E\u73B0\u7684\u5173\u952E\uFF0C\u4ECE ZRender \u7684\u6E90\u7801\u6765\u770B\u770B\u5176\u4E8B\u4EF6\u7CFB\u7EDF\u662F\u5982\u4F55\u8BBE\u8BA1\u7684\u3002"},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6",id:"\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6",level:2},{value:"\u5143\u7D20\u62FE\u53D6",id:"\u5143\u7D20\u62FE\u53D6",level:2},{value:"\u6574\u4F53\u5305\u56F4\u76D2\u5224\u5B9A",id:"\u6574\u4F53\u5305\u56F4\u76D2\u5224\u5B9A",level:3},{value:"\u6307\u4EE4\u5305\u542B\u5224\u5B9A",id:"\u6307\u4EE4\u5305\u542B\u5224\u5B9A",level:3},{value:"\u5EF6\u4F38\uFF1A\u78B0\u649E\u68C0\u6D4B",id:"\u5EF6\u4F38\u78B0\u649E\u68C0\u6D4B",level:2},{value:"\u53C2\u8003\u8D44\u6E90",id:"\u53C2\u8003\u8D44\u6E90",level:2}];function h(e){let n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"\u6700\u540E\u66F4\u65B0\u4E8E 2024-06-16 16:09:00"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7ED8\u56FE\u5F15\u64CE\u652F\u6301\u4E30\u5BCC\u4EA4\u4E92\u7684\u524D\u63D0\u662F\u62E5\u6709\u4E00\u5957\u4E8B\u4EF6\u7CFB\u7EDF\uFF0C\u800C\u5728\u753B\u5E03\u4E2D\u5982\u4F55\u62FE\u53D6\u5143\u7D20\u662F\u5B9E\u73B0\u7684\u5173\u952E\uFF0C\u4ECE ",(0,i.jsx)(n.a,{href:"https://ecomfe.github.io/zrender-doc/public/",children:"ZRender"})," \u7684\u6E90\u7801\u6765\u770B\u770B\u5176\u4E8B\u4EF6\u7CFB\u7EDF\u662F\u5982\u4F55\u8BBE\u8BA1\u7684\u3002"]}),"\n",(0,i.jsx)(n.mermaid,{value:'---\ntitle: ZRender\'s Event System(v5.3.2)\n---\nflowchart BT\n    subgraph bind2dom\n        canvas["canvas (dom)"]\n        HandlerProxy["HandlerProxy (DomProxy)"]\n\n        subgraph Handler\n            findHover("findHover()")\n            dispatchToElement("dispatchToElement()")\n\n            findHover -. find .-> dispatchToElement\n        end\n\n        Handler -- on() --\x3e HandlerProxy -- on() --\x3e canvas\n        canvas -- trigger() --\x3e HandlerProxy -- trigger() --\x3e Handler\n    end\n\n    subgraph pick\n        subgraph BoundingRect\n            contain("contain()")\n        end\n\n        subgraph PathProxy\n            PathProxyGetBoundingRect("getBoundingRect()")\n        end\n\n        subgraph Path\n            PathContain("contain()")\n            PathGetBoundingRect("getBoundingRect()")\n        end\n\n        subgraph Element\n            ElGetBoundingRect("getBoundingRect()")\n        end\n\n        Element -- getClipPath() --\x3e Path\n        PathContain --\x3e contain\n        ElGetBoundingRect -.-> PathGetBoundingRect -.-> PathProxyGetBoundingRect\n        PathProxyGetBoundingRect -.-> BoundingRect\n    end\n\n    User("User")\n\n    dispatchToElement -.-> Element\n    findHover --\x3e pick\n\n    User -. on() .-> Element\n    Element -. trigger() .-> User\n\n    User -. interact .-> canvas\n\n    linkStyle 5,6,7,8,9,11 stroke: red,color: red;\n    linkStyle 0,10,12,13 stroke: green,color: green;\n    linkStyle 14 stroke: orange,color: orange;\n\n    style User fill: orange;\n    style pick fill: transparent,color: gray,stroke: gray,stroke-width: 2px,stroke-dasharray: 10 5;\n    style bind2dom fill: transparent,color: gray,stroke: gray,stroke-width: 2px,stroke-dasharray: 10 5;\n'}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0A\u56FE\u4E3A\u5176\u4E8B\u4EF6\u7CFB\u7EDF\u7684\u5DE5\u4F5C\u6D41\u7A0B\u56FE\uFF0C\u53EF\u5C06\u5176\u7B80\u5355\u7684\u770B\u4F5C\u4E24\u4E2A\u9636\u6BB5\uFF0C\u5373",(0,i.jsx)(n.strong,{children:"\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u7684\u4E8B\u4EF6\uFF08bind2dom\uFF09\u548C\u5143\u7D20\u62FE\u53D6\uFF08pick\uFF09"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7B80\u5355\u7684\u6765\u8BF4\uFF0CZRender \u4F1A\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\uFF08\u4F8B\u5982 Web \u73AF\u5883\u7684 canvas Dom \u5B9E\u4F8B\uFF09\u7684\u4E8B\u4EF6\uFF0C\u7528\u6237\u76F4\u63A5\u548C\u5BBF\u4E3B\u73AF\u5883\u8FDB\u884C\u4EA4\u4E92\uFF08\u4F8B\u5982\u9F20\u6807\u70B9\u51FB\uFF09\uFF0C\u5BBF\u4E3B\u73AF\u5883\u901A\u77E5 ZRender \u53D1\u751F\u7528\u6237\u4EA4\u4E92\u4E8B\u4EF6\u5E76\u7ED9\u51FA\u4E00\u4E9B\u4FE1\u606F\uFF08\u4F8B\u5982\u9F20\u6807\u5750\u6807\uFF09\uFF0CZRender \u5F00\u59CB\u5728\u6E32\u67D3\u7684\u56FE\u5F62\u5217\u8868\u4E2D\u62FE\u53D6\u5143\u7D20\uFF0C\u82E5\u62FE\u53D6\u5230\u5143\u7D20\uFF0C\u5219\u54CD\u5E94\u7528\u6237\u4E3B\u52A8\u76D1\u542C\u7684\u5143\u7D20\u4EA4\u4E92\u4E8B\u4EF6\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4E2D ",(0,i.jsx)(n.code,{children:"Element"})," \u662F ZRender \u4E2D\u7ED8\u56FE\u5143\u7D20\u7684\u57FA\u7C7B\uFF0C",(0,i.jsxs)(n.a,{href:"https://github.com/ecomfe/zrender/blob/5.3.2/src/Element.ts#L1698",children:["\u5176\u7EE7\u627F\u81EA ",(0,i.jsx)(n.code,{children:"Eventful"})]}),"\uFF08\u7C7B\u4F3C\u4E8E Node \u4E2D\u7684 EventEmitter \u6A21\u5757\uFF09\uFF0C\u5411\u7528\u6237\u66B4\u9732\u4E8B\u4EF6\u76F8\u5173\u7684 APIs\uFF08\u4F8B\u5982 ",(0,i.jsx)(n.code,{children:"on()"}),"\u3001",(0,i.jsx)(n.code,{children:"off()"})," \u7B49\u7B49\uFF09\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4E0B\u9762\u6839\u636E\u6E90\u7801\u6765\u5206\u6790\u5177\u4F53\u903B\u8F91\u7684\u5B9E\u73B0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6",children:"\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6"}),"\n",(0,i.jsxs)(n.p,{children:["\u7B2C\u4E00\u9636\u6BB5\uFF0C\u5728 ZRender \u5B9E\u4F8B\u5316\u8FC7\u7A0B\u4E2D\u5C31\u4F1A\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u7684\u4E8B\u4EF6\u3002\u5177\u4F53\u7684\u8FC7\u7A0B\u662F\uFF0CZRender \u4F1A\u5B9E\u4F8B\u5316\u4E00\u4E2A\u7528\u6765\u5904\u7406\u7528\u6237\u4E8B\u4EF6\u7684 ",(0,i.jsx)(n.code,{children:"Handler"})," \u7C7B\u5B9E\u4F8B\uFF0C\u4F46\u771F\u6B63\u8D1F\u8D23\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6\u7684\u5B9E\u73B0\u5728\u62BD\u8C61\u7C7B ",(0,i.jsx)(n.code,{children:"HandlerProxy"})," \u4E2D\uFF08Web \u73AF\u5883\u5BF9\u5E94\u7684\u5B9E\u73B0\u4E3A ",(0,i.jsx)(n.code,{children:"HandlerDomProxy"}),"\uFF09\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u521D\u59CB\u5316\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/zrender.ts#L126"',children:"class ZRender {\n  constructor(id: number, dom?: HTMLElement, opts?: ZRenderInitOpt) {\n    // ...\n\n    // highlight-start\n    const handerProxy = (!env.node && !env.worker && !ssrMode)\n        ? new HandlerProxy(painter.getViewportRoot(), painter.root)\n        : null;\n    this.handler = new Handler(storage, painter, handerProxy, painter.root);\n    // highlight-end\n\n    // ...\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u63A5\u4E0B\u6765\uFF0C\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u7684\u4E8B\u4EF6\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/dom/HandlerProxy.ts#L593"',children:"export default class HandlerDomProxy extends Eventful {\n  constructor(dom: HTMLElement, painterRoot: HTMLElement) {\n    // ...\n\n    // highlight-next-line\n    mountLocalDOMEventListeners(this, this._localHandlerScope);\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540E\uFF0C\u76D1\u542C\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6\u5E76\u5B9E\u73B0\u54CD\u5E94\u4E8B\u4EF6\u7684\u5904\u7406\u903B\u8F91\uFF08",(0,i.jsx)(n.strong,{children:"\u9700\u8981\u6CE8\u610F\u7684\u662F\uFF0C\u8FD9\u91CC\u5C06\u7ED1\u5B9A\u5BBF\u4E3B\u73AF\u5883\u4E8B\u4EF6\u548C\u54CD\u5E94\u4E8B\u4EF6\u7684\u903B\u8F91\u5206\u522B\u653E\u5728\u4E24\u4E2A\u4E0D\u540C\u7684\u7C7B\u4E2D\u5B9E\u73B0\u662F\u6709\u610F\u7684\uFF0C\u8FD9\u6837\u4FBF\u4E8E\u5B9E\u73B0\u8DE8\u5E73\u53F0\u652F\u6301"}),"\uFF09\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/Handler.ts#L179"',children:"class Handler extends Eventful {\n  setHandlerProxy(proxy: HandlerProxyInterface) {\n      if (this.proxy) {\n          this.proxy.dispose();\n      }\n\n      if (proxy) {\n          // highlight-start\n          util.each(handlerNames, function (name) {\n              proxy.on && proxy.on(name, this[name as HandlerName], this);\n          }, this);\n          // highlight-end\n          // Attach handler\n          proxy.handler = this;\n      }\n      this.proxy = proxy;\n  }\n\n  mousemove(event: ZRRawEvent) {\n    const x = event.zrX;\n    const y = event.zrY;\n\n    const isOutside = isOutsideBoundary(this, x, y);\n\n    let lastHovered = this._hovered;\n    let lastHoveredTarget = lastHovered.target;\n\n    // If lastHoveredTarget is removed from zr (detected by '__zr') by some API call\n    // (like 'setOption' or 'dispatchAction') in event handlers, we should find\n    // lastHovered again here. Otherwise 'mouseout' can not be triggered normally.\n    // See #6198.\n    if (lastHoveredTarget && !lastHoveredTarget.__zr) {\n        // highlight-next-line\n        lastHovered = this.findHover(lastHovered.x, lastHovered.y);\n        lastHoveredTarget = lastHovered.target;\n    }\n\n    const hovered = this._hovered = isOutside ? new HoveredResult(x, y) : this.findHover(x, y);\n    const hoveredTarget = hovered.target;\n\n    const proxy = this.proxy;\n    proxy.setCursor && proxy.setCursor(hoveredTarget ? hoveredTarget.cursor : 'default');\n\n    // Mouse out on previous hovered element\n    if (lastHoveredTarget && hoveredTarget !== lastHoveredTarget) {\n        // highlight-next-line\n        this.dispatchToElement(lastHovered, 'mouseout', event);\n    }\n\n    // Mouse moving on one element\n    // highlight-next-line\n    this.dispatchToElement(hovered, 'mousemove', event);\n\n    // Mouse over on a new element\n    if (hoveredTarget && hoveredTarget !== lastHoveredTarget) {\n        // highlight-next-line\n        this.dispatchToElement(hovered, 'mouseover', event);\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u5728\u54CD\u5E94\u9F20\u6807\u79FB\u52A8\u4E8B\u4EF6\u7684\u903B\u8F91\u4E2D\uFF0C\u5148\u8C03\u7528\u4E86 ",(0,i.jsx)(n.code,{children:"findHover()"})," \u6765\u627E\u5230\u9F20\u6807\u5750\u6807\u6240\u5728\u533A\u57DF\u5185\u7684\u56FE\u5F62\u5B9E\u4F8B\uFF08\u5373\u5143\u7D20\u62FE\u53D6\uFF09\uFF0C\u62FE\u53D6\u5230\u5143\u7D20\u540E\uFF0C\u518D\u901A\u8FC7 ",(0,i.jsx)(n.code,{children:"dispatchToElement()"})," \u65B9\u6CD5\u54CD\u5E94\u7528\u6237\u7ED1\u5B9A\u5230\u5143\u7D20\u5B9E\u4F8B\u4E0A\u7684\u9F20\u6807\u4E8B\u4EF6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540E\uFF0C\u770B\u770B\u5143\u7D20\u62FE\u53D6\u7684\u903B\u8F91\u5B9E\u73B0\uFF1A"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/Handler.ts#L337"',children:"class Handler extends Eventful {\n  findHover(x: number, y: number, exclude?: Displayable): HoveredResult {\n      const list = this.storage.getDisplayList();\n      const out = new HoveredResult(x, y);\n\n      for (let i = list.length - 1; i >= 0; i--) {\n          let hoverCheckResult;\n          if (list[i] !== exclude\n              // getDisplayList may include ignored item in VML mode\n              && !list[i].ignore\n              // highlight-next-line\n              && (hoverCheckResult = isHover(list[i], x, y))\n          ) {\n              !out.topTarget && (out.topTarget = list[i]);\n              if (hoverCheckResult !== SILENT) {\n                  out.target = list[i];\n                  break;\n              }\n          }\n      }\n\n      return out;\n  }\n}\n\nfunction isHover(displayable: Displayable, x: number, y: number) {\n  if (displayable[displayable.rectHover ? 'rectContain' : 'contain'](x, y)) {\n      let el: Element = displayable;\n      let isSilent;\n      let ignoreClip = false;\n      while (el) {\n          // Ignore clip on any ancestors.\n          if (el.ignoreClip) {\n              ignoreClip = true;\n          }\n          if (!ignoreClip) {\n              // highlight-next-line\n              let clipPath = el.getClipPath();\n              // If clipped by ancestor.\n              // FIXME: If clipPath has neither stroke nor fill,\n              // el.clipPath.contain(x, y) will always return false.\n              // highlight-next-line\n              if (clipPath && !clipPath.contain(x, y)) {\n                  return false;\n              }\n              if (el.silent) {\n                  isSilent = true;\n              }\n          }\n          // Consider when el is textContent, also need to be silent\n          // if any of its host el and its ancestors is silent.\n          const hostEl = el.__hostTarget;\n          el = hostEl ? hostEl : el.parent;\n      }\n      return isSilent ? SILENT : true;\n  }\n\n  return false;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u901A\u8FC7\u904D\u5386\u6E32\u67D3\u7684\u56FE\u5F62\u5217\u8868\uFF0C\u8C03\u7528\u6BCF\u4E2A\u56FE\u5F62\u7684\u8DEF\u5F84\u5B9E\u4F8B\u7684 ",(0,i.jsx)(n.code,{children:"contain()"})," \u65B9\u6CD5\u6765\u5224\u65AD\u9F20\u6807\u5750\u6807\u662F\u5426\u5728\u8BE5\u56FE\u5F62\u533A\u57DF\u5185\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5143\u7D20\u62FE\u53D6",children:"\u5143\u7D20\u62FE\u53D6"}),"\n",(0,i.jsxs)(n.p,{children:["\u7B2C\u4E8C\u9636\u6BB5\uFF0C\u662F\u5143\u7D20\u62FE\u53D6\u7684\u5177\u4F53\u5B9E\u73B0\uFF0CZRender \u91C7\u7528\u4E86",(0,i.jsx)(n.strong,{children:"\u5916\u63A5\u77E9\u5F62\uFF08\u5373\u5305\u56F4\u76D2\uFF0CBounding Box\uFF09"})," \u7684\u5224\u5B9A\u7B56\u7565\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/graphic/Path.ts#L392"',children:"class Path<Props extends PathProps = PathProps> extends Displayable<Props> {\n    contain(x: number, y: number): boolean {\n        const localPos = this.transformCoordToLocal(x, y);\n        const rect = this.getBoundingRect();\n        const style = this.style;\n        x = localPos[0];\n        y = localPos[1];\n\n        // highlight-next-line\n        if (rect.contain(x, y)) {\n            const pathProxy = this.path;\n            if (this.hasStroke()) {\n                let lineWidth = style.lineWidth;\n                let lineScale = style.strokeNoScale ? this.getLineScale() : 1;\n                // Line scale can't be 0;\n                if (lineScale > 1e-10) {\n                    // Only add extra hover lineWidth when there are no fill\n                    if (!this.hasFill()) {\n                        lineWidth = Math.max(lineWidth, this.strokeContainThreshold);\n                    }\n                    // highlight-start\n                    if (pathContain.containStroke(\n                        pathProxy, lineWidth / lineScale, x, y\n                    )) {\n                    // highlight-end\n                        return true;\n                    }\n                }\n            }\n            if (this.hasFill()) {\n                // highlight-next-line\n                return pathContain.contain(pathProxy, x, y);\n            }\n        }\n        return false;\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636E\u4EE5\u4E0A\u6E90\u7801\u5206\u6790\uFF0C\u5728\u8FD9\u4E2A\u8FC7\u7A0B\u4E2D\uFF0C\u4E5F\u5206\u4E3A\u4E24\u4E2A\u6B65\u9AA4\uFF0C",(0,i.jsx)(n.strong,{children:"\u7B2C\u4E00\u6B65\u5148\u901A\u8FC7\u56FE\u5F62\u5143\u7D20\u7684\u6574\u4F53\u5305\u56F4\u76D2\u7C97\u7565\u7684\u8FDB\u884C\u5224\u5B9A\uFF0C\u5982\u679C\u901A\u8FC7\uFF0C\u5219\u8FDB\u884C\u7B2C\u4E8C\u6B65\u5373\u66F4\u7EC6\u7C92\u5EA6\u7684\u6307\u4EE4\u5305\u542B\u5224\u5B9A\u3002"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u6574\u4F53\u5305\u56F4\u76D2\u5224\u5B9A",children:"\u6574\u4F53\u5305\u56F4\u76D2\u5224\u5B9A"}),"\n",(0,i.jsxs)(n.p,{children:["\u7B2C\u4E00\u6B65\uFF0C\u5143\u7D20\u56FE\u5F62\u5B9E\u4F8B\u6574\u4F53\u5305\u56F4\u76D2\u7684\u8BA1\u7B97\u903B\u8F91\u5728\u5173\u8054\u7684 ",(0,i.jsx)(n.code,{children:"PathProxy"})," \u5B9E\u4F8B\u4E2D\u5B9E\u73B0\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/PathProxy.ts#L478"',children:"export default class PathProxy {\n  getBoundingRect() {\n    min[0] = min[1] = min2[0] = min2[1] = Number.MAX_VALUE;\n    max[0] = max[1] = max2[0] = max2[1] = -Number.MAX_VALUE;\n\n    // ...\n\n    let i;\n    for (i = 0; i < this._len;) {\n        const cmd = data[i++] as number;\n\n        // ...\n\n        // highlight-start\n        switch (cmd) {\n            case CMD.M:\n                // ...\n                break;\n            case CMD.L:\n                // ...\n                break;\n            case CMD.C:\n                // ...\n                break;\n            case CMD.Q:\n                // ...\n                break;\n            case CMD.A:\n                // ...\n                break;\n            case CMD.R:\n                // ...\n                break;\n            case CMD.Z:\n                xi = x0;\n                yi = y0;\n                break;\n        }\n        // highlight-end\n\n        // Union\n        vec2.min(min, min, min2);\n        vec2.max(max, max, max2);\n    }\n\n    // ...\n\n    return new BoundingRect(\n        min[0], min[1], max[0] - min[0], max[1] - min[1]\n    );\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636E\u4EE5\u4E0A\u6E90\u7801\u6765\u770B\uFF0C",(0,i.jsx)(n.strong,{children:"\u4E00\u4E2A\u590D\u6742\u56FE\u5F62\u7684\u5305\u56F4\u76D2\u662F\u7531\u6BCF\u4E00\u6BB5\u7ED8\u5236\u547D\u4EE4\u5BF9\u5E94\u7684\u5B50\u56FE\u5F62\u7684\u5305\u56F4\u76D2\u7EC4\u5408\u5728\u4E00\u8D77\u8BA1\u7B97\u5F97\u5230\u7684"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u800C\u5224\u65AD\u4E00\u4E2A\u5750\u6807\u662F\u5426\u5728\u4E00\u4E2A\u77E9\u5F62\u4E2D\u5219\u5728 ",(0,i.jsx)(n.code,{children:"BoundingRect"})," \u7C7B\u4E2D\u5B9E\u73B0\uFF0C\u903B\u8F91\u6BD4\u8F83\u7B80\u5355\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/BoundingRect.ts#L177"',children:"export default class BoundingRect {\n  contain(x: number, y: number): boolean {\n      const rect = this;\n      // highlight-start\n      return x >= rect.x\n          && x <= (rect.x + rect.width)\n          && y >= rect.y\n          && y <= (rect.y + rect.height);\n      // highlight-end\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6307\u4EE4\u5305\u542B\u5224\u5B9A",children:"\u6307\u4EE4\u5305\u542B\u5224\u5B9A"}),"\n",(0,i.jsx)(n.p,{children:"\u7B2C\u4E8C\u6B65\u5219\u662F\u66F4\u7EC6\u7C92\u5EA6\u7684\u5224\u65AD\uFF0C\u56E0\u4E3A\u4EFB\u610F\u56FE\u5F62\u5143\u7D20\u5B9E\u4F8B\u7684\u5305\u56F4\u76D2\u90FD\u662F\u4E00\u4E2A\u77E9\u5F62\u6846\uFF0C\u5728\u9047\u5230\u4E00\u4E9B\u4E0D\u89C4\u5219\u56FE\u5F62\uFF08\u4F8B\u5982\u51F9\u51F8\u591A\u8FB9\u5F62\uFF09\u65F6\u8BEF\u5DEE\u8F83\u5927\uFF0C\u6240\u4EE5\u6574\u4F53\u5305\u56F4\u76D2\u7684\u5224\u5B9A\u7B56\u7565\u7C92\u5EA6\u8F83\u7C97\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/contain/path.ts#L212"',children:"export function contain(pathProxy: PathProxy, x: number, y: number): boolean {\n    return containPath(pathProxy, 0, false, x, y);\n}\n\nexport function containStroke(pathProxy: PathProxy, lineWidth: number, x: number, y: number): boolean {\n    return containPath(pathProxy, lineWidth, true, x, y);\n}\n\nfunction containPath(\n    path: PathProxy, lineWidth: number, isStroke: boolean, x: number, y: number\n): boolean {\n    const data = path.data;\n    const len = path.len();\n     let w = 0;\n\n    // ...\n\n    for (let i = 0; i < len;) {\n        const cmd = data[i++];\n\n        // ...\n\n        // highlight-start\n        switch (cmd) {\n            case CMD.M:\n                // ...\n                break;\n            case CMD.L:\n                // ...\n                break;\n            case CMD.C:\n                // ...\n                break;\n            case CMD.Q:\n                // ...\n                break;\n            case CMD.A:\n                // ...\n                break;\n            case CMD.R:\n                // ...\n                break;\n            case CMD.Z:\n                // ...\n                break;\n        }\n        // highlight-end\n    }\n\n    // ...\n\n    return w !== 0;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636E\u6E90\u7801\u5B9E\u73B0\u6765\u770B\uFF0C",(0,i.jsx)(n.strong,{children:"\u7B2C\u4E8C\u6B65\u4E0E\u7B2C\u4E00\u6B65\u4E2D\u8BA1\u7B97\u5305\u56F4\u76D2\u7684\u7B97\u6CD5\u7C7B\u4F3C\uFF0C\u90FD\u662F\u6839\u636E\u7ED8\u5236\u56FE\u5F62\u5143\u7D20\u7684\u6307\u4EE4\u9010\u6761\u89E3\u6790\uFF0C\u4E0D\u540C\u7684\u662F\uFF0C\u7B2C\u4E00\u6B65\u4EC5\u8BA1\u7B97\u7ED8\u5236\u6307\u4EE4\u7ED8\u5236\u7684\u56FE\u5F62\u7684\u5305\u56F4\u76D2\uFF0C\u7B2C\u4E8C\u6B65\u5219\u7528\u66F4\u590D\u6742\u7684\u7B97\u6CD5\u5224\u65AD\u70B9\u5750\u6807\u662F\u5426\u5728\u7ED8\u5236\u6307\u4EE4\u6240\u7ED8\u5236\u7684\u56FE\u5F62\u8DEF\u5F84\u4E2D\u3002"})]}),"\n",(0,i.jsx)(n.p,{children:"\u4EE5\u4E0A\u5C31\u662F ZRender \u4E8B\u4EF6\u7CFB\u7EDF\u5B9E\u73B0\u7684\u5927\u81F4\u539F\u7406\uFF0C\u5176\u91C7\u7528\u4E86\u51E0\u4F55\u5224\u65AD\u7684\u65B9\u5F0F\u5B9E\u73B0\u4E86\u753B\u5E03\u4E0A\u7684\u5143\u7D20\u62FE\u53D6\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5EF6\u4F38\u78B0\u649E\u68C0\u6D4B",children:"\u5EF6\u4F38\uFF1A\u78B0\u649E\u68C0\u6D4B"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E0A\u8FF0\u5206\u6790\u4E2D\uFF0CZRender \u5143\u7D20\u62FE\u53D6\u7684\u5B9E\u73B0\u662F\u91C7\u7528\u4E86\u5916\u63A5\u77E9\u5F62\u7684\u5224\u5B9A\u7B56\u7565\uFF0C\u800C\u57FA\u4E8E\u5916\u63A5\u77E9\u5F62\u8FD8\u53EF\u4EE5\u5B9E\u73B0\u7B80\u5355\u7684\u78B0\u649E\u68C0\u6D4B\u3002\u800C\u4E14\uFF0CZRender \u7684 ",(0,i.jsx)(n.code,{children:"BoundingRect"})," \u7C7B\u4E2D\u5DF2\u7ECF\u5B9E\u73B0\u4E86\u4E00\u4E2A ",(0,i.jsx)(n.code,{children:"intersect()"})," \u65B9\u6CD5\u6765\u5224\u65AD\u4E24\u4E2A\u5143\u7D20\u662F\u5426\u76F8\u4EA4\uFF0C\u6765\u770B\u770B\u5177\u4F53\u5B9E\u73B0\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/BoundingRect.ts#L91"',children:"export default class BoundingRect {\n  intersect(b: RectLike, mtv?: PointLike): boolean {\n      if (!b) {\n          return false;\n      }\n\n      if (!(b instanceof BoundingRect)) {\n          // Normalize negative width/height.\n          b = BoundingRect.create(b);\n      }\n\n      const a = this;\n      // highlight-start\n      const ax0 = a.x;\n      const ax1 = a.x + a.width;\n      const ay0 = a.y;\n      const ay1 = a.y + a.height;\n\n      const bx0 = b.x;\n      const bx1 = b.x + b.width;\n      const by0 = b.y;\n      const by1 = b.y + b.height;\n\n      let overlap = !(ax1 < bx0 || bx1 < ax0 || ay1 < by0 || by1 < ay0);\n      // highlight-end\n      if (mtv) {\n        // ...\n      }\n\n      if (mtv) {\n          Point.copy(mtv, overlap ? minTv : maxTv);\n      }\n      return overlap;\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4EE5\u4E0A\u4EE3\u7801\u4E2D\u9AD8\u4EAE\u90E8\u5206\u903B\u8F91\u7684\u5B9E\u73B0\u5E94\u7528\u4E86",(0,i.jsx)(n.strong,{children:"\u5206\u79BB\u8F74\u5B9A\u7406\uFF08Separating Axis Theorem, SAT\uFF09"}),"\uFF0C\u8BE5\u5B9A\u7406\u7684\u5224\u65AD\u51C6\u786E\u5EA6\u5F88\u9AD8\uFF0C\u800C\u4E14\u9002\u7528\u8303\u56F4\u5E7F\u6CDB\uFF0C\u53EF\u4EE5\u7528\u4E8E\u68C0\u6D4B\u4E8C\u7EF4\u5E73\u9762\u53CA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u591A\u8FB9\u5F62\u78B0\u649E\uFF0C\u4F46\u9700\u8981\u6CE8\u610F\u7684\u662F",(0,i.jsx)(n.strong,{children:"\u4EC5\u9002\u7528\u4E8E\u51F8\u591A\u8FB9\u5F62"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u53E6\u5916\uFF0C\u6CE8\u610F\u4E0A\u8FF0\u4EE3\u7801\u4E2D\u7684\u7B2C\u4E8C\u4E2A\u53C2\u6570 ",(0,i.jsx)(n.code,{children:"mvt"}),"\uFF0C\u5176\u4E3A",(0,i.jsx)(n.strong,{children:"\u6700\u5C0F\u5E73\u79FB\u5411\u91CF\uFF08Minimum Translation Vector, MVT\uFF09"}),"\uFF0C\u8FD9\u4E2A\u503C\u6070\u597D\u5C31\u662F\u5C06\u4E24\u4E2A\u7269\u4F53\u7531\u78B0\u649E\u53D8\u4E3A\u4E0D\u78B0\u649E\u65F6\uFF0C\u6240\u9700\u79FB\u52A8\u7684\u6700\u5C0F\u8DDD\u79BB\u3002\u8FD0\u7528\u8BE5\u503C\uFF0C\u6211\u4EEC\u53EF\u4EE5\u4F7F\u4E24\u4E2A\u76F8\u4E92\u78B0\u649E\u7684\u7269\u4F53\u5206\u79BB\uFF0C\u4E5F\u53EF\u4EE5\u4F7F\u4E24\u4E2A\u5C1A\u672A\u78B0\u649E\u7684\u7269\u4F53\u7C98\u5728\u4E00\u8D77\uFF0C\u8FD8\u53EF\u4EE5\u8BA9\u4E00\u4E2A\u7269\u4F53\u4ECE\u53E6\u4E00\u4E2A\u7269\u4F53\u8868\u9762\u5F39\u5F00\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u53C2\u8003\u8D44\u6E90",children:"\u53C2\u8003\u8D44\u6E90"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://ecomfe.github.io/zrender-doc/public/",children:"https://ecomfe.github.io/zrender-doc/public/"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Hyperplane_separation_theorem",children:"https://en.wikipedia.org/wiki/Hyperplane_separation_theorem"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://programmerart.weebly.com/separating-axis-theorem.html",children:"http://programmerart.weebly.com/separating-axis-theorem.html"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dyn4j.org/2010/01/sat/",children:"https://dyn4j.org/2010/01/sat/"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gamedev.stackexchange.com/questions/32545/what-is-the-mtv-minimum-translation-vector-in-sat-seperation-of-axis",children:"https://gamedev.stackexchange.com/questions/32545/what-is-the-mtv-minimum-translation-vector-in-sat-seperation-of-axis"})}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},50065:function(e,n,t){t.d(n,{Z:()=>a,a:()=>o});var r=t(67294);let i={},s=r.createContext(i);function o(e){let n=r.useContext(s);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},23690:function(e){e.exports=JSON.parse('{"permalink":"/2022/11/01/computer-technology/web-frontend/echarts-zrender/zrender-event-system","editUrl":"https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/web-frontend/echarts-zrender/2022-11-01-zrender-event-system.md","source":"@site/blog/computer-technology/web-frontend/echarts-zrender/2022-11-01-zrender-event-system.md","title":"\u89E3\u6790 ZRender \u8BBE\u8BA1\uFF1A\u4E8B\u4EF6\u7CFB\u7EDF","description":"\u7ED8\u56FE\u5F15\u64CE\u652F\u6301\u4E30\u5BCC\u4EA4\u4E92\u7684\u524D\u63D0\u662F\u62E5\u6709\u4E00\u5957\u4E8B\u4EF6\u7CFB\u7EDF\uFF0C\u800C\u5728\u753B\u5E03\u4E2D\u5982\u4F55\u62FE\u53D6\u5143\u7D20\u662F\u5B9E\u73B0\u7684\u5173\u952E\uFF0C\u4ECE ZRender \u7684\u6E90\u7801\u6765\u770B\u770B\u5176\u4E8B\u4EF6\u7CFB\u7EDF\u662F\u5982\u4F55\u8BBE\u8BA1\u7684\u3002","date":"2022-11-01T19:47:00.000Z","tags":[{"inline":true,"label":"\u8BA1\u7B97\u673A\u6280\u672F","permalink":"/tags/\u8BA1\u7B97\u673A\u6280\u672F"},{"inline":true,"label":"Web \u524D\u7AEF","permalink":"/tags/web-\u524D\u7AEF"},{"inline":true,"label":"\u6570\u636E\u53EF\u89C6\u5316","permalink":"/tags/\u6570\u636E\u53EF\u89C6\u5316"},{"inline":true,"label":"ZRender","permalink":"/tags/z-render"},{"inline":true,"label":"Canvas","permalink":"/tags/canvas"},{"inline":true,"label":"\u6E90\u7801\u89E3\u6790","permalink":"/tags/\u6E90\u7801\u89E3\u6790"}],"readingTime":9.64,"hasTruncateMarker":true,"authors":[{"name":"\u4E0D\u5982\u6000\u5FF5","title":"Web \u524D\u7AEF\u5DE5\u7A0B\u5E08 (Web Front-end Engineer)","url":"https://github.com/wang1212","email":"mrwang1212@126.com","socials":{"github":"https://github.com/wang1212"},"imageURL":"/img/authors/wang1212.png","key":"wang1212","page":null}],"frontMatter":{"title":"\u89E3\u6790 ZRender \u8BBE\u8BA1\uFF1A\u4E8B\u4EF6\u7CFB\u7EDF","date":"2022-11-01T19:47:00.000Z","update":"2024-06-16T16:09:00.000Z","authors":"wang1212","tags":["\u8BA1\u7B97\u673A\u6280\u672F","Web \u524D\u7AEF","\u6570\u636E\u53EF\u89C6\u5316","ZRender","Canvas","\u6E90\u7801\u89E3\u6790"],"keywords":["\u8BA1\u7B97\u673A\u6280\u672F","Web \u524D\u7AEF","\u6570\u636E\u53EF\u89C6\u5316","ZRender","Canvas","\u6E90\u7801\u89E3\u6790"],"description":"\u7ED8\u56FE\u5F15\u64CE\u652F\u6301\u4E30\u5BCC\u4EA4\u4E92\u7684\u524D\u63D0\u662F\u62E5\u6709\u4E00\u5957\u4E8B\u4EF6\u7CFB\u7EDF\uFF0C\u800C\u5728\u753B\u5E03\u4E2D\u5982\u4F55\u62FE\u53D6\u5143\u7D20\u662F\u5B9E\u73B0\u7684\u5173\u952E\uFF0C\u4ECE ZRender \u7684\u6E90\u7801\u6765\u770B\u770B\u5176\u4E8B\u4EF6\u7CFB\u7EDF\u662F\u5982\u4F55\u8BBE\u8BA1\u7684\u3002"},"unlisted":false,"prevItem":{"title":"\u63A2\u7D22 Docusaurus \u7684\u8DEF\u7531\u5B9E\u73B0","permalink":"/computer-technology/tools/tools-docusaurus"},"nextItem":{"title":"Web \u5B57\u4F53\u52A0\u8F7D\u5BF9\u9875\u9762\u4EA7\u751F\u7684\u5F71\u54CD","permalink":"/2022/10/16/computer-technology/web-frontend/web-tips-fonts"}}')}}]);