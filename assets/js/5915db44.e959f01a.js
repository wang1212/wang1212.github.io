"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[5189],{28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var r=t(96540);const i={},s=r.createContext(i);function o(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(s.Provider,{value:n},e.children)}},60744:e=>{e.exports=JSON.parse('{"permalink":"/2022/11/01/computer-technology/web-frontend/echarts-zrender/zrender-event-system","editUrl":"https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/web-frontend/echarts-zrender/2022-11-01-zrender-event-system.md","source":"@site/blog/computer-technology/web-frontend/echarts-zrender/2022-11-01-zrender-event-system.md","title":"\u89e3\u6790 ZRender \u8bbe\u8ba1\uff1a\u4e8b\u4ef6\u7cfb\u7edf","description":"\u7ed8\u56fe\u5f15\u64ce\u652f\u6301\u4e30\u5bcc\u4ea4\u4e92\u7684\u524d\u63d0\u662f\u62e5\u6709\u4e00\u5957\u4e8b\u4ef6\u7cfb\u7edf\uff0c\u800c\u5728\u753b\u5e03\u4e2d\u5982\u4f55\u62fe\u53d6\u5143\u7d20\u662f\u5b9e\u73b0\u7684\u5173\u952e\uff0c\u4ece ZRender \u7684\u6e90\u7801\u6765\u770b\u770b\u5176\u4e8b\u4ef6\u7cfb\u7edf\u662f\u5982\u4f55\u8bbe\u8ba1\u7684\u3002","date":"2022-11-01T19:47:00.000Z","tags":[{"inline":true,"label":"\u8ba1\u7b97\u673a\u6280\u672f","permalink":"/tags/\u8ba1\u7b97\u673a\u6280\u672f"},{"inline":true,"label":"Web \u524d\u7aef","permalink":"/tags/web-\u524d\u7aef"},{"inline":true,"label":"\u6570\u636e\u53ef\u89c6\u5316","permalink":"/tags/\u6570\u636e\u53ef\u89c6\u5316"},{"inline":true,"label":"ZRender","permalink":"/tags/z-render"},{"inline":true,"label":"Canvas","permalink":"/tags/canvas"},{"inline":true,"label":"\u6e90\u7801\u89e3\u6790","permalink":"/tags/\u6e90\u7801\u89e3\u6790"}],"readingTime":12.465,"hasTruncateMarker":true,"authors":[{"name":"\u4e0d\u5982\u6000\u5ff5","title":"Web \u524d\u7aef\u5de5\u7a0b\u5e08 (Web Front-end Engineer)","url":"https://github.com/wang1212","email":"mrwang1212@126.com","imageURL":"/img/authors/wang1212.png","key":"wang1212","page":null}],"frontMatter":{"title":"\u89e3\u6790 ZRender \u8bbe\u8ba1\uff1a\u4e8b\u4ef6\u7cfb\u7edf","date":"2022-11-01T19:47:00.000Z","update":"2024-06-16T16:09:00.000Z","authors":"wang1212","tags":["\u8ba1\u7b97\u673a\u6280\u672f","Web \u524d\u7aef","\u6570\u636e\u53ef\u89c6\u5316","ZRender","Canvas","\u6e90\u7801\u89e3\u6790"],"keywords":["\u8ba1\u7b97\u673a\u6280\u672f","Web \u524d\u7aef","\u6570\u636e\u53ef\u89c6\u5316","ZRender","Canvas","\u6e90\u7801\u89e3\u6790"],"description":"\u7ed8\u56fe\u5f15\u64ce\u652f\u6301\u4e30\u5bcc\u4ea4\u4e92\u7684\u524d\u63d0\u662f\u62e5\u6709\u4e00\u5957\u4e8b\u4ef6\u7cfb\u7edf\uff0c\u800c\u5728\u753b\u5e03\u4e2d\u5982\u4f55\u62fe\u53d6\u5143\u7d20\u662f\u5b9e\u73b0\u7684\u5173\u952e\uff0c\u4ece ZRender \u7684\u6e90\u7801\u6765\u770b\u770b\u5176\u4e8b\u4ef6\u7cfb\u7edf\u662f\u5982\u4f55\u8bbe\u8ba1\u7684\u3002"},"unlisted":false,"prevItem":{"title":"\u63a2\u7d22 Docusaurus \u7684\u8def\u7531\u5b9e\u73b0","permalink":"/computer-technology/tools/tools-docusaurus"},"nextItem":{"title":"Web \u5b57\u4f53\u52a0\u8f7d\u5bf9\u9875\u9762\u4ea7\u751f\u7684\u5f71\u54cd","permalink":"/2022/10/16/computer-technology/web-frontend/web-tips-fonts"}}')},95368:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var r=t(60744),i=t(74848),s=t(28453);const o={title:"\u89e3\u6790 ZRender \u8bbe\u8ba1\uff1a\u4e8b\u4ef6\u7cfb\u7edf",date:new Date("2022-11-01T19:47:00.000Z"),update:new Date("2024-06-16T16:09:00.000Z"),authors:"wang1212",tags:["\u8ba1\u7b97\u673a\u6280\u672f","Web \u524d\u7aef","\u6570\u636e\u53ef\u89c6\u5316","ZRender","Canvas","\u6e90\u7801\u89e3\u6790"],keywords:["\u8ba1\u7b97\u673a\u6280\u672f","Web \u524d\u7aef","\u6570\u636e\u53ef\u89c6\u5316","ZRender","Canvas","\u6e90\u7801\u89e3\u6790"],description:"\u7ed8\u56fe\u5f15\u64ce\u652f\u6301\u4e30\u5bcc\u4ea4\u4e92\u7684\u524d\u63d0\u662f\u62e5\u6709\u4e00\u5957\u4e8b\u4ef6\u7cfb\u7edf\uff0c\u800c\u5728\u753b\u5e03\u4e2d\u5982\u4f55\u62fe\u53d6\u5143\u7d20\u662f\u5b9e\u73b0\u7684\u5173\u952e\uff0c\u4ece ZRender \u7684\u6e90\u7801\u6765\u770b\u770b\u5176\u4e8b\u4ef6\u7cfb\u7edf\u662f\u5982\u4f55\u8bbe\u8ba1\u7684\u3002"},a=void 0,l={authorsImageUrls:[void 0]},c=[{value:"\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6",id:"\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6",level:2},{value:"\u5143\u7d20\u62fe\u53d6",id:"\u5143\u7d20\u62fe\u53d6",level:2},{value:"\u6574\u4f53\u5305\u56f4\u76d2\u5224\u5b9a",id:"\u6574\u4f53\u5305\u56f4\u76d2\u5224\u5b9a",level:3},{value:"\u6307\u4ee4\u5305\u542b\u5224\u5b9a",id:"\u6307\u4ee4\u5305\u542b\u5224\u5b9a",level:3},{value:"\u5ef6\u4f38\uff1a\u78b0\u649e\u68c0\u6d4b",id:"\u5ef6\u4f38\u78b0\u649e\u68c0\u6d4b",level:2},{value:"\u53c2\u8003\u8d44\u6e90",id:"\u53c2\u8003\u8d44\u6e90",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"\u6700\u540e\u66f4\u65b0\u4e8e 2024-06-16 16:09:00"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u7ed8\u56fe\u5f15\u64ce\u652f\u6301\u4e30\u5bcc\u4ea4\u4e92\u7684\u524d\u63d0\u662f\u62e5\u6709\u4e00\u5957\u4e8b\u4ef6\u7cfb\u7edf\uff0c\u800c\u5728\u753b\u5e03\u4e2d\u5982\u4f55\u62fe\u53d6\u5143\u7d20\u662f\u5b9e\u73b0\u7684\u5173\u952e\uff0c\u4ece ",(0,i.jsx)(n.a,{href:"https://ecomfe.github.io/zrender-doc/public/",children:"ZRender"})," \u7684\u6e90\u7801\u6765\u770b\u770b\u5176\u4e8b\u4ef6\u7cfb\u7edf\u662f\u5982\u4f55\u8bbe\u8ba1\u7684\u3002"]}),"\n",(0,i.jsx)(n.mermaid,{value:'---\ntitle: ZRender\'s Event System(v5.3.2)\n---\nflowchart BT\n    subgraph bind2dom\n        canvas["canvas (dom)"]\n        HandlerProxy["HandlerProxy (DomProxy)"]\n\n        subgraph Handler\n            findHover("findHover()")\n            dispatchToElement("dispatchToElement()")\n\n            findHover -. find .-> dispatchToElement\n        end\n\n        Handler -- on() --\x3e HandlerProxy -- on() --\x3e canvas\n        canvas -- trigger() --\x3e HandlerProxy -- trigger() --\x3e Handler\n    end\n\n    subgraph pick\n        subgraph BoundingRect\n            contain("contain()")\n        end\n\n        subgraph PathProxy\n            PathProxyGetBoundingRect("getBoundingRect()")\n        end\n\n        subgraph Path\n            PathContain("contain()")\n            PathGetBoundingRect("getBoundingRect()")\n        end\n\n        subgraph Element\n            ElGetBoundingRect("getBoundingRect()")\n        end\n\n        Element -- getClipPath() --\x3e Path\n        PathContain --\x3e contain\n        ElGetBoundingRect -.-> PathGetBoundingRect -.-> PathProxyGetBoundingRect\n        PathProxyGetBoundingRect -.-> BoundingRect\n    end\n\n    User("User")\n\n    dispatchToElement -.-> Element\n    findHover --\x3e pick\n\n    User -. on() .-> Element\n    Element -. trigger() .-> User\n\n    User -. interact .-> canvas\n\n    linkStyle 5,6,7,8,9,11 stroke: red,color: red;\n    linkStyle 0,10,12,13 stroke: green,color: green;\n    linkStyle 14 stroke: orange,color: orange;\n\n    style User fill: orange;\n    style pick fill: transparent,color: gray,stroke: gray,stroke-width: 2px,stroke-dasharray: 10 5;\n    style bind2dom fill: transparent,color: gray,stroke: gray,stroke-width: 2px,stroke-dasharray: 10 5;\n'}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0a\u56fe\u4e3a\u5176\u4e8b\u4ef6\u7cfb\u7edf\u7684\u5de5\u4f5c\u6d41\u7a0b\u56fe\uff0c\u53ef\u5c06\u5176\u7b80\u5355\u7684\u770b\u4f5c\u4e24\u4e2a\u9636\u6bb5\uff0c\u5373",(0,i.jsx)(n.strong,{children:"\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u7684\u4e8b\u4ef6\uff08bind2dom\uff09\u548c\u5143\u7d20\u62fe\u53d6\uff08pick\uff09"}),"\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u7b80\u5355\u7684\u6765\u8bf4\uff0cZRender \u4f1a\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\uff08\u4f8b\u5982 Web \u73af\u5883\u7684 canvas Dom \u5b9e\u4f8b\uff09\u7684\u4e8b\u4ef6\uff0c\u7528\u6237\u76f4\u63a5\u548c\u5bbf\u4e3b\u73af\u5883\u8fdb\u884c\u4ea4\u4e92\uff08\u4f8b\u5982\u9f20\u6807\u70b9\u51fb\uff09\uff0c\u5bbf\u4e3b\u73af\u5883\u901a\u77e5 ZRender \u53d1\u751f\u7528\u6237\u4ea4\u4e92\u4e8b\u4ef6\u5e76\u7ed9\u51fa\u4e00\u4e9b\u4fe1\u606f\uff08\u4f8b\u5982\u9f20\u6807\u5750\u6807\uff09\uff0cZRender \u5f00\u59cb\u5728\u6e32\u67d3\u7684\u56fe\u5f62\u5217\u8868\u4e2d\u62fe\u53d6\u5143\u7d20\uff0c\u82e5\u62fe\u53d6\u5230\u5143\u7d20\uff0c\u5219\u54cd\u5e94\u7528\u6237\u4e3b\u52a8\u76d1\u542c\u7684\u5143\u7d20\u4ea4\u4e92\u4e8b\u4ef6\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4e2d ",(0,i.jsx)(n.code,{children:"Element"})," \u662f ZRender \u4e2d\u7ed8\u56fe\u5143\u7d20\u7684\u57fa\u7c7b\uff0c",(0,i.jsxs)(n.a,{href:"https://github.com/ecomfe/zrender/blob/5.3.2/src/Element.ts#L1698",children:["\u5176\u7ee7\u627f\u81ea ",(0,i.jsx)(n.code,{children:"Eventful"})]}),"\uff08\u7c7b\u4f3c\u4e8e Node \u4e2d\u7684 EventEmitter \u6a21\u5757\uff09\uff0c\u5411\u7528\u6237\u66b4\u9732\u4e8b\u4ef6\u76f8\u5173\u7684 APIs\uff08\u4f8b\u5982 ",(0,i.jsx)(n.code,{children:"on()"}),"\u3001",(0,i.jsx)(n.code,{children:"off()"})," \u7b49\u7b49\uff09\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u4e0b\u9762\u6839\u636e\u6e90\u7801\u6765\u5206\u6790\u5177\u4f53\u903b\u8f91\u7684\u5b9e\u73b0\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6",children:"\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\u9636\u6bb5\uff0c\u5728 ZRender \u5b9e\u4f8b\u5316\u8fc7\u7a0b\u4e2d\u5c31\u4f1a\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u7684\u4e8b\u4ef6\u3002\u5177\u4f53\u7684\u8fc7\u7a0b\u662f\uff0cZRender \u4f1a\u5b9e\u4f8b\u5316\u4e00\u4e2a\u7528\u6765\u5904\u7406\u7528\u6237\u4e8b\u4ef6\u7684 ",(0,i.jsx)(n.code,{children:"Handler"})," \u7c7b\u5b9e\u4f8b\uff0c\u4f46\u771f\u6b63\u8d1f\u8d23\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6\u7684\u5b9e\u73b0\u5728\u62bd\u8c61\u7c7b ",(0,i.jsx)(n.code,{children:"HandlerProxy"})," \u4e2d\uff08Web \u73af\u5883\u5bf9\u5e94\u7684\u5b9e\u73b0\u4e3a ",(0,i.jsx)(n.code,{children:"HandlerDomProxy"}),"\uff09\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u521d\u59cb\u5316\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/zrender.ts#L126"',children:"class ZRender {\n  constructor(id: number, dom?: HTMLElement, opts?: ZRenderInitOpt) {\n    // ...\n\n    // highlight-start\n    const handerProxy = (!env.node && !env.worker && !ssrMode)\n        ? new HandlerProxy(painter.getViewportRoot(), painter.root)\n        : null;\n    this.handler = new Handler(storage, painter, handerProxy, painter.root);\n    // highlight-end\n\n    // ...\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u63a5\u4e0b\u6765\uff0c\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u7684\u4e8b\u4ef6\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/dom/HandlerProxy.ts#L593"',children:"export default class HandlerDomProxy extends Eventful {\n  constructor(dom: HTMLElement, painterRoot: HTMLElement) {\n    // ...\n\n    // highlight-next-line\n    mountLocalDOMEventListeners(this, this._localHandlerScope);\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u540e\uff0c\u76d1\u542c\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6\u5e76\u5b9e\u73b0\u54cd\u5e94\u4e8b\u4ef6\u7684\u5904\u7406\u903b\u8f91\uff08",(0,i.jsx)(n.strong,{children:"\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u91cc\u5c06\u7ed1\u5b9a\u5bbf\u4e3b\u73af\u5883\u4e8b\u4ef6\u548c\u54cd\u5e94\u4e8b\u4ef6\u7684\u903b\u8f91\u5206\u522b\u653e\u5728\u4e24\u4e2a\u4e0d\u540c\u7684\u7c7b\u4e2d\u5b9e\u73b0\u662f\u6709\u610f\u7684\uff0c\u8fd9\u6837\u4fbf\u4e8e\u5b9e\u73b0\u8de8\u5e73\u53f0\u652f\u6301"}),"\uff09\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/Handler.ts#L179"',children:"class Handler extends Eventful {\n  setHandlerProxy(proxy: HandlerProxyInterface) {\n      if (this.proxy) {\n          this.proxy.dispose();\n      }\n\n      if (proxy) {\n          // highlight-start\n          util.each(handlerNames, function (name) {\n              proxy.on && proxy.on(name, this[name as HandlerName], this);\n          }, this);\n          // highlight-end\n          // Attach handler\n          proxy.handler = this;\n      }\n      this.proxy = proxy;\n  }\n\n  mousemove(event: ZRRawEvent) {\n    const x = event.zrX;\n    const y = event.zrY;\n\n    const isOutside = isOutsideBoundary(this, x, y);\n\n    let lastHovered = this._hovered;\n    let lastHoveredTarget = lastHovered.target;\n\n    // If lastHoveredTarget is removed from zr (detected by '__zr') by some API call\n    // (like 'setOption' or 'dispatchAction') in event handlers, we should find\n    // lastHovered again here. Otherwise 'mouseout' can not be triggered normally.\n    // See #6198.\n    if (lastHoveredTarget && !lastHoveredTarget.__zr) {\n        // highlight-next-line\n        lastHovered = this.findHover(lastHovered.x, lastHovered.y);\n        lastHoveredTarget = lastHovered.target;\n    }\n\n    const hovered = this._hovered = isOutside ? new HoveredResult(x, y) : this.findHover(x, y);\n    const hoveredTarget = hovered.target;\n\n    const proxy = this.proxy;\n    proxy.setCursor && proxy.setCursor(hoveredTarget ? hoveredTarget.cursor : 'default');\n\n    // Mouse out on previous hovered element\n    if (lastHoveredTarget && hoveredTarget !== lastHoveredTarget) {\n        // highlight-next-line\n        this.dispatchToElement(lastHovered, 'mouseout', event);\n    }\n\n    // Mouse moving on one element\n    // highlight-next-line\n    this.dispatchToElement(hovered, 'mousemove', event);\n\n    // Mouse over on a new element\n    if (hoveredTarget && hoveredTarget !== lastHoveredTarget) {\n        // highlight-next-line\n        this.dispatchToElement(hovered, 'mouseover', event);\n    }\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u5728\u54cd\u5e94\u9f20\u6807\u79fb\u52a8\u4e8b\u4ef6\u7684\u903b\u8f91\u4e2d\uff0c\u5148\u8c03\u7528\u4e86 ",(0,i.jsx)(n.code,{children:"findHover()"})," \u6765\u627e\u5230\u9f20\u6807\u5750\u6807\u6240\u5728\u533a\u57df\u5185\u7684\u56fe\u5f62\u5b9e\u4f8b\uff08\u5373\u5143\u7d20\u62fe\u53d6\uff09\uff0c\u62fe\u53d6\u5230\u5143\u7d20\u540e\uff0c\u518d\u901a\u8fc7 ",(0,i.jsx)(n.code,{children:"dispatchToElement()"})," \u65b9\u6cd5\u54cd\u5e94\u7528\u6237\u7ed1\u5b9a\u5230\u5143\u7d20\u5b9e\u4f8b\u4e0a\u7684\u9f20\u6807\u4e8b\u4ef6\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u6700\u540e\uff0c\u770b\u770b\u5143\u7d20\u62fe\u53d6\u7684\u903b\u8f91\u5b9e\u73b0\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/Handler.ts#L337"',children:"class Handler extends Eventful {\n  findHover(x: number, y: number, exclude?: Displayable): HoveredResult {\n      const list = this.storage.getDisplayList();\n      const out = new HoveredResult(x, y);\n\n      for (let i = list.length - 1; i >= 0; i--) {\n          let hoverCheckResult;\n          if (list[i] !== exclude\n              // getDisplayList may include ignored item in VML mode\n              && !list[i].ignore\n              // highlight-next-line\n              && (hoverCheckResult = isHover(list[i], x, y))\n          ) {\n              !out.topTarget && (out.topTarget = list[i]);\n              if (hoverCheckResult !== SILENT) {\n                  out.target = list[i];\n                  break;\n              }\n          }\n      }\n\n      return out;\n  }\n}\n\nfunction isHover(displayable: Displayable, x: number, y: number) {\n  if (displayable[displayable.rectHover ? 'rectContain' : 'contain'](x, y)) {\n      let el: Element = displayable;\n      let isSilent;\n      let ignoreClip = false;\n      while (el) {\n          // Ignore clip on any ancestors.\n          if (el.ignoreClip) {\n              ignoreClip = true;\n          }\n          if (!ignoreClip) {\n              // highlight-next-line\n              let clipPath = el.getClipPath();\n              // If clipped by ancestor.\n              // FIXME: If clipPath has neither stroke nor fill,\n              // el.clipPath.contain(x, y) will always return false.\n              // highlight-next-line\n              if (clipPath && !clipPath.contain(x, y)) {\n                  return false;\n              }\n              if (el.silent) {\n                  isSilent = true;\n              }\n          }\n          // Consider when el is textContent, also need to be silent\n          // if any of its host el and its ancestors is silent.\n          const hostEl = el.__hostTarget;\n          el = hostEl ? hostEl : el.parent;\n      }\n      return isSilent ? SILENT : true;\n  }\n\n  return false;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u901a\u8fc7\u904d\u5386\u6e32\u67d3\u7684\u56fe\u5f62\u5217\u8868\uff0c\u8c03\u7528\u6bcf\u4e2a\u56fe\u5f62\u7684\u8def\u5f84\u5b9e\u4f8b\u7684 ",(0,i.jsx)(n.code,{children:"contain()"})," \u65b9\u6cd5\u6765\u5224\u65ad\u9f20\u6807\u5750\u6807\u662f\u5426\u5728\u8be5\u56fe\u5f62\u533a\u57df\u5185\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u5143\u7d20\u62fe\u53d6",children:"\u5143\u7d20\u62fe\u53d6"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e8c\u9636\u6bb5\uff0c\u662f\u5143\u7d20\u62fe\u53d6\u7684\u5177\u4f53\u5b9e\u73b0\uff0cZRender \u91c7\u7528\u4e86",(0,i.jsx)(n.strong,{children:"\u5916\u63a5\u77e9\u5f62\uff08\u5373\u5305\u56f4\u76d2\uff0cBounding Box\uff09"})," \u7684\u5224\u5b9a\u7b56\u7565\u3002"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/graphic/Path.ts#L392"',children:"class Path<Props extends PathProps = PathProps> extends Displayable<Props> {\n    contain(x: number, y: number): boolean {\n        const localPos = this.transformCoordToLocal(x, y);\n        const rect = this.getBoundingRect();\n        const style = this.style;\n        x = localPos[0];\n        y = localPos[1];\n\n        // highlight-next-line\n        if (rect.contain(x, y)) {\n            const pathProxy = this.path;\n            if (this.hasStroke()) {\n                let lineWidth = style.lineWidth;\n                let lineScale = style.strokeNoScale ? this.getLineScale() : 1;\n                // Line scale can't be 0;\n                if (lineScale > 1e-10) {\n                    // Only add extra hover lineWidth when there are no fill\n                    if (!this.hasFill()) {\n                        lineWidth = Math.max(lineWidth, this.strokeContainThreshold);\n                    }\n                    // highlight-start\n                    if (pathContain.containStroke(\n                        pathProxy, lineWidth / lineScale, x, y\n                    )) {\n                    // highlight-end\n                        return true;\n                    }\n                }\n            }\n            if (this.hasFill()) {\n                // highlight-next-line\n                return pathContain.contain(pathProxy, x, y);\n            }\n        }\n        return false;\n    }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636e\u4ee5\u4e0a\u6e90\u7801\u5206\u6790\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c",(0,i.jsx)(n.strong,{children:"\u7b2c\u4e00\u6b65\u5148\u901a\u8fc7\u56fe\u5f62\u5143\u7d20\u7684\u6574\u4f53\u5305\u56f4\u76d2\u7c97\u7565\u7684\u8fdb\u884c\u5224\u5b9a\uff0c\u5982\u679c\u901a\u8fc7\uff0c\u5219\u8fdb\u884c\u7b2c\u4e8c\u6b65\u5373\u66f4\u7ec6\u7c92\u5ea6\u7684\u6307\u4ee4\u5305\u542b\u5224\u5b9a\u3002"})]}),"\n",(0,i.jsx)(n.h3,{id:"\u6574\u4f53\u5305\u56f4\u76d2\u5224\u5b9a",children:"\u6574\u4f53\u5305\u56f4\u76d2\u5224\u5b9a"}),"\n",(0,i.jsxs)(n.p,{children:["\u7b2c\u4e00\u6b65\uff0c\u5143\u7d20\u56fe\u5f62\u5b9e\u4f8b\u6574\u4f53\u5305\u56f4\u76d2\u7684\u8ba1\u7b97\u903b\u8f91\u5728\u5173\u8054\u7684 ",(0,i.jsx)(n.code,{children:"PathProxy"})," \u5b9e\u4f8b\u4e2d\u5b9e\u73b0\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/PathProxy.ts#L478"',children:"export default class PathProxy {\n  getBoundingRect() {\n    min[0] = min[1] = min2[0] = min2[1] = Number.MAX_VALUE;\n    max[0] = max[1] = max2[0] = max2[1] = -Number.MAX_VALUE;\n\n    // ...\n\n    let i;\n    for (i = 0; i < this._len;) {\n        const cmd = data[i++] as number;\n\n        // ...\n\n        // highlight-start\n        switch (cmd) {\n            case CMD.M:\n                // ...\n                break;\n            case CMD.L:\n                // ...\n                break;\n            case CMD.C:\n                // ...\n                break;\n            case CMD.Q:\n                // ...\n                break;\n            case CMD.A:\n                // ...\n                break;\n            case CMD.R:\n                // ...\n                break;\n            case CMD.Z:\n                xi = x0;\n                yi = y0;\n                break;\n        }\n        // highlight-end\n\n        // Union\n        vec2.min(min, min, min2);\n        vec2.max(max, max, max2);\n    }\n\n    // ...\n\n    return new BoundingRect(\n        min[0], min[1], max[0] - min[0], max[1] - min[1]\n    );\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636e\u4ee5\u4e0a\u6e90\u7801\u6765\u770b\uff0c",(0,i.jsx)(n.strong,{children:"\u4e00\u4e2a\u590d\u6742\u56fe\u5f62\u7684\u5305\u56f4\u76d2\u662f\u7531\u6bcf\u4e00\u6bb5\u7ed8\u5236\u547d\u4ee4\u5bf9\u5e94\u7684\u5b50\u56fe\u5f62\u7684\u5305\u56f4\u76d2\u7ec4\u5408\u5728\u4e00\u8d77\u8ba1\u7b97\u5f97\u5230\u7684"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u800c\u5224\u65ad\u4e00\u4e2a\u5750\u6807\u662f\u5426\u5728\u4e00\u4e2a\u77e9\u5f62\u4e2d\u5219\u5728 ",(0,i.jsx)(n.code,{children:"BoundingRect"})," \u7c7b\u4e2d\u5b9e\u73b0\uff0c\u903b\u8f91\u6bd4\u8f83\u7b80\u5355\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/BoundingRect.ts#L177"',children:"export default class BoundingRect {\n  contain(x: number, y: number): boolean {\n      const rect = this;\n      // highlight-start\n      return x >= rect.x\n          && x <= (rect.x + rect.width)\n          && y >= rect.y\n          && y <= (rect.y + rect.height);\n      // highlight-end\n  }\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u6307\u4ee4\u5305\u542b\u5224\u5b9a",children:"\u6307\u4ee4\u5305\u542b\u5224\u5b9a"}),"\n",(0,i.jsx)(n.p,{children:"\u7b2c\u4e8c\u6b65\u5219\u662f\u66f4\u7ec6\u7c92\u5ea6\u7684\u5224\u65ad\uff0c\u56e0\u4e3a\u4efb\u610f\u56fe\u5f62\u5143\u7d20\u5b9e\u4f8b\u7684\u5305\u56f4\u76d2\u90fd\u662f\u4e00\u4e2a\u77e9\u5f62\u6846\uff0c\u5728\u9047\u5230\u4e00\u4e9b\u4e0d\u89c4\u5219\u56fe\u5f62\uff08\u4f8b\u5982\u51f9\u51f8\u591a\u8fb9\u5f62\uff09\u65f6\u8bef\u5dee\u8f83\u5927\uff0c\u6240\u4ee5\u6574\u4f53\u5305\u56f4\u76d2\u7684\u5224\u5b9a\u7b56\u7565\u7c92\u5ea6\u8f83\u7c97\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/contain/path.ts#L212"',children:"export function contain(pathProxy: PathProxy, x: number, y: number): boolean {\n    return containPath(pathProxy, 0, false, x, y);\n}\n\nexport function containStroke(pathProxy: PathProxy, lineWidth: number, x: number, y: number): boolean {\n    return containPath(pathProxy, lineWidth, true, x, y);\n}\n\nfunction containPath(\n    path: PathProxy, lineWidth: number, isStroke: boolean, x: number, y: number\n): boolean {\n    const data = path.data;\n    const len = path.len();\n     let w = 0;\n\n    // ...\n\n    for (let i = 0; i < len;) {\n        const cmd = data[i++];\n\n        // ...\n\n        // highlight-start\n        switch (cmd) {\n            case CMD.M:\n                // ...\n                break;\n            case CMD.L:\n                // ...\n                break;\n            case CMD.C:\n                // ...\n                break;\n            case CMD.Q:\n                // ...\n                break;\n            case CMD.A:\n                // ...\n                break;\n            case CMD.R:\n                // ...\n                break;\n            case CMD.Z:\n                // ...\n                break;\n        }\n        // highlight-end\n    }\n\n    // ...\n\n    return w !== 0;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u6839\u636e\u6e90\u7801\u5b9e\u73b0\u6765\u770b\uff0c",(0,i.jsx)(n.strong,{children:"\u7b2c\u4e8c\u6b65\u4e0e\u7b2c\u4e00\u6b65\u4e2d\u8ba1\u7b97\u5305\u56f4\u76d2\u7684\u7b97\u6cd5\u7c7b\u4f3c\uff0c\u90fd\u662f\u6839\u636e\u7ed8\u5236\u56fe\u5f62\u5143\u7d20\u7684\u6307\u4ee4\u9010\u6761\u89e3\u6790\uff0c\u4e0d\u540c\u7684\u662f\uff0c\u7b2c\u4e00\u6b65\u4ec5\u8ba1\u7b97\u7ed8\u5236\u6307\u4ee4\u7ed8\u5236\u7684\u56fe\u5f62\u7684\u5305\u56f4\u76d2\uff0c\u7b2c\u4e8c\u6b65\u5219\u7528\u66f4\u590d\u6742\u7684\u7b97\u6cd5\u5224\u65ad\u70b9\u5750\u6807\u662f\u5426\u5728\u7ed8\u5236\u6307\u4ee4\u6240\u7ed8\u5236\u7684\u56fe\u5f62\u8def\u5f84\u4e2d\u3002"})]}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0a\u5c31\u662f ZRender \u4e8b\u4ef6\u7cfb\u7edf\u5b9e\u73b0\u7684\u5927\u81f4\u539f\u7406\uff0c\u5176\u91c7\u7528\u4e86\u51e0\u4f55\u5224\u65ad\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\u753b\u5e03\u4e0a\u7684\u5143\u7d20\u62fe\u53d6\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5ef6\u4f38\u78b0\u649e\u68c0\u6d4b",children:"\u5ef6\u4f38\uff1a\u78b0\u649e\u68c0\u6d4b"}),"\n",(0,i.jsxs)(n.p,{children:["\u4e0a\u8ff0\u5206\u6790\u4e2d\uff0cZRender \u5143\u7d20\u62fe\u53d6\u7684\u5b9e\u73b0\u662f\u91c7\u7528\u4e86\u5916\u63a5\u77e9\u5f62\u7684\u5224\u5b9a\u7b56\u7565\uff0c\u800c\u57fa\u4e8e\u5916\u63a5\u77e9\u5f62\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u7b80\u5355\u7684\u78b0\u649e\u68c0\u6d4b\u3002\u800c\u4e14\uff0cZRender \u7684 ",(0,i.jsx)(n.code,{children:"BoundingRect"})," \u7c7b\u4e2d\u5df2\u7ecf\u5b9e\u73b0\u4e86\u4e00\u4e2a ",(0,i.jsx)(n.code,{children:"intersect()"})," \u65b9\u6cd5\u6765\u5224\u65ad\u4e24\u4e2a\u5143\u7d20\u662f\u5426\u76f8\u4ea4\uff0c\u6765\u770b\u770b\u5177\u4f53\u5b9e\u73b0\uff1a"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",metastring:'title="https://github.com/ecomfe/zrender/blob/5.3.2/src/core/BoundingRect.ts#L91"',children:"export default class BoundingRect {\n  intersect(b: RectLike, mtv?: PointLike): boolean {\n      if (!b) {\n          return false;\n      }\n\n      if (!(b instanceof BoundingRect)) {\n          // Normalize negative width/height.\n          b = BoundingRect.create(b);\n      }\n\n      const a = this;\n      // highlight-start\n      const ax0 = a.x;\n      const ax1 = a.x + a.width;\n      const ay0 = a.y;\n      const ay1 = a.y + a.height;\n\n      const bx0 = b.x;\n      const bx1 = b.x + b.width;\n      const by0 = b.y;\n      const by1 = b.y + b.height;\n\n      let overlap = !(ax1 < bx0 || bx1 < ax0 || ay1 < by0 || by1 < ay0);\n      // highlight-end\n      if (mtv) {\n        // ...\n      }\n\n      if (mtv) {\n          Point.copy(mtv, overlap ? minTv : maxTv);\n      }\n      return overlap;\n  }\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["\u4ee5\u4e0a\u4ee3\u7801\u4e2d\u9ad8\u4eae\u90e8\u5206\u903b\u8f91\u7684\u5b9e\u73b0\u5e94\u7528\u4e86",(0,i.jsx)(n.strong,{children:"\u5206\u79bb\u8f74\u5b9a\u7406\uff08Separating Axis Theorem, SAT\uff09"}),"\uff0c\u8be5\u5b9a\u7406\u7684\u5224\u65ad\u51c6\u786e\u5ea6\u5f88\u9ad8\uff0c\u800c\u4e14\u9002\u7528\u8303\u56f4\u5e7f\u6cdb\uff0c\u53ef\u4ee5\u7528\u4e8e\u68c0\u6d4b\u4e8c\u7ef4\u5e73\u9762\u53ca\u4e09\u7ef4\u7a7a\u95f4\u4e2d\u7684\u591a\u8fb9\u5f62\u78b0\u649e\uff0c\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f",(0,i.jsx)(n.strong,{children:"\u4ec5\u9002\u7528\u4e8e\u51f8\u591a\u8fb9\u5f62"}),"\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u53e6\u5916\uff0c\u6ce8\u610f\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684\u7b2c\u4e8c\u4e2a\u53c2\u6570 ",(0,i.jsx)(n.code,{children:"mvt"}),"\uff0c\u5176\u4e3a",(0,i.jsx)(n.strong,{children:"\u6700\u5c0f\u5e73\u79fb\u5411\u91cf\uff08Minimum Translation Vector, MVT\uff09"}),"\uff0c\u8fd9\u4e2a\u503c\u6070\u597d\u5c31\u662f\u5c06\u4e24\u4e2a\u7269\u4f53\u7531\u78b0\u649e\u53d8\u4e3a\u4e0d\u78b0\u649e\u65f6\uff0c\u6240\u9700\u79fb\u52a8\u7684\u6700\u5c0f\u8ddd\u79bb\u3002\u8fd0\u7528\u8be5\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u4e24\u4e2a\u76f8\u4e92\u78b0\u649e\u7684\u7269\u4f53\u5206\u79bb\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u4e24\u4e2a\u5c1a\u672a\u78b0\u649e\u7684\u7269\u4f53\u7c98\u5728\u4e00\u8d77\uff0c\u8fd8\u53ef\u4ee5\u8ba9\u4e00\u4e2a\u7269\u4f53\u4ece\u53e6\u4e00\u4e2a\u7269\u4f53\u8868\u9762\u5f39\u5f00\u3002"]}),"\n",(0,i.jsx)(n.h2,{id:"\u53c2\u8003\u8d44\u6e90",children:"\u53c2\u8003\u8d44\u6e90"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://ecomfe.github.io/zrender-doc/public/",children:"https://ecomfe.github.io/zrender-doc/public/"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Hyperplane_separation_theorem",children:"https://en.wikipedia.org/wiki/Hyperplane_separation_theorem"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"http://programmerart.weebly.com/separating-axis-theorem.html",children:"http://programmerart.weebly.com/separating-axis-theorem.html"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://dyn4j.org/2010/01/sat/",children:"https://dyn4j.org/2010/01/sat/"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://gamedev.stackexchange.com/questions/32545/what-is-the-mtv-minimum-translation-vector-in-sat-seperation-of-axis",children:"https://gamedev.stackexchange.com/questions/32545/what-is-the-mtv-minimum-translation-vector-in-sat-seperation-of-axis"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}}}]);