"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([[1031],{65583:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>a,contentTitle:()=>s,default:()=>d,frontMatter:()=>r,metadata:()=>c,toc:()=>p});var o=t(85893),i=t(11151);const r={title:"Monorepo \u4e2d\u4f7f\u7528 TypeScript \u7684\u95ee\u9898",date:new Date("2024-10-20T13:48:00.000Z"),update:new Date("2024-10-23T01:12:00.000Z"),authors:"wang1212",tags:["\u8ba1\u7b97\u673a\u6280\u672f","\u5de5\u5177","TypeScript","Monorepo","\u5b9e\u8df5\u6848\u4f8b"],keywords:["\u8ba1\u7b97\u673a\u6280\u672f","\u5de5\u5177","TypeScript","Monorepo","\u5b9e\u8df5\u6848\u4f8b"],description:"\u5728 Monorepo \u4e2d\u4f7f\u7528 TypeScript \u65f6\u76f8\u6bd4\u4e8e\u5355\u5305\u4ed3\u5e93\u8981\u590d\u6742\u7684\u591a\uff0c\u4f1a\u9047\u5230\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e9b\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002"},s=void 0,c={permalink:"/2024/10/20/computer-technology/typescript/tools-ts-in-monorepo",editUrl:"https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/typescript/2024-10-20-tools-ts-in-monorepo.md",source:"@site/blog/computer-technology/typescript/2024-10-20-tools-ts-in-monorepo.md",title:"Monorepo \u4e2d\u4f7f\u7528 TypeScript \u7684\u95ee\u9898",description:"\u5728 Monorepo \u4e2d\u4f7f\u7528 TypeScript \u65f6\u76f8\u6bd4\u4e8e\u5355\u5305\u4ed3\u5e93\u8981\u590d\u6742\u7684\u591a\uff0c\u4f1a\u9047\u5230\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e9b\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002",date:"2024-10-20T13:48:00.000Z",tags:[{inline:!0,label:"\u8ba1\u7b97\u673a\u6280\u672f",permalink:"/tags/\u8ba1\u7b97\u673a\u6280\u672f"},{inline:!0,label:"\u5de5\u5177",permalink:"/tags/\u5de5\u5177"},{inline:!0,label:"TypeScript",permalink:"/tags/type-script"},{inline:!0,label:"Monorepo",permalink:"/tags/monorepo"},{inline:!0,label:"\u5b9e\u8df5\u6848\u4f8b",permalink:"/tags/\u5b9e\u8df5\u6848\u4f8b"}],readingTime:4.09,hasTruncateMarker:!0,authors:[{name:"\u4e0d\u5982\u6000\u5ff5",title:"Web \u524d\u7aef\u5de5\u7a0b\u5e08 (Web Front-end Engineer)",url:"https://github.com/wang1212",email:"mrwang1212@126.com",imageURL:"/img/authors/wang1212.png",key:"wang1212",page:null}],frontMatter:{title:"Monorepo \u4e2d\u4f7f\u7528 TypeScript \u7684\u95ee\u9898",date:"2024-10-20T13:48:00.000Z",update:"2024-10-23T01:12:00.000Z",authors:"wang1212",tags:["\u8ba1\u7b97\u673a\u6280\u672f","\u5de5\u5177","TypeScript","Monorepo","\u5b9e\u8df5\u6848\u4f8b"],keywords:["\u8ba1\u7b97\u673a\u6280\u672f","\u5de5\u5177","TypeScript","Monorepo","\u5b9e\u8df5\u6848\u4f8b"],description:"\u5728 Monorepo \u4e2d\u4f7f\u7528 TypeScript \u65f6\u76f8\u6bd4\u4e8e\u5355\u5305\u4ed3\u5e93\u8981\u590d\u6742\u7684\u591a\uff0c\u4f1a\u9047\u5230\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e9b\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002"},unlisted:!1,nextItem:{title:"\u4e00\u6b21\u6e56\u5317\u81ea\u9a7e\u6e38",permalink:"/2024/07/12/life/tourism/tourism-hubei-enshi"}},a={authorsImageUrls:[void 0]},p=[{value:"\u5171\u4eab\u9879\u76ee\u914d\u7f6e",id:"\u5171\u4eab\u9879\u76ee\u914d\u7f6e",level:2},{value:"\u6e90\u4ee3\u7801\u8df3\u8f6c",id:"\u6e90\u4ee3\u7801\u8df3\u8f6c",level:2},{value:"Vite \u4e0e\u5b9e\u65f6\u751f\u6210\u7c7b\u578b\u5b9a\u4e49",id:"vite-\u4e0e\u5b9e\u65f6\u751f\u6210\u7c7b\u578b\u5b9a\u4e49",level:2},{value:"\u76f8\u5173\u8d44\u6599",id:"\u76f8\u5173\u8d44\u6599",level:2}];function l(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.a)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.blockquote,{children:["\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"\u6700\u540e\u66f4\u65b0\u4e8e 2024-10-23 01:12:00"})}),"\n"]}),"\n",(0,o.jsx)(n.p,{children:"\u5728 Monorepo \u4e2d\u4f7f\u7528 TypeScript \u65f6\u76f8\u6bd4\u4e8e\u5355\u5305\u4ed3\u5e93\u8981\u590d\u6742\u7684\u591a\uff0c\u4f1a\u9047\u5230\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u8fd9\u91cc\u8bb0\u5f55\u4e00\u4e0b\u8fd9\u4e9b\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6848\u3002"}),"\n",(0,o.jsx)(n.h2,{id:"\u5171\u4eab\u9879\u76ee\u914d\u7f6e",children:"\u5171\u4eab\u9879\u76ee\u914d\u7f6e"}),"\n",(0,o.jsxs)(n.p,{children:["\u4e3a\u4e86\u964d\u4f4e\u7ef4\u62a4\u6210\u672c\uff0c\u901a\u5e38\u7684\u505a\u6cd5\u662f\u5728\u9879\u76ee\u6839\u76ee\u5f55\u521b\u5efa\u4e00\u4e2a ",(0,o.jsx)(n.strong,{children:"tsconfig.base.json"})," \u914d\u7f6e\u6587\u4ef6\u4f5c\u4e3a\u516c\u5171\u7684\u57fa\u7840\u914d\u7f6e\uff0c\u540c\u65f6\u5728\u6bcf\u4e2a\u5b50\u5305\u4e2d\u518d\u521b\u5efa\u4e00\u4e2a\u5355\u72ec\u7684\u914d\u7f6e\u6587\u4ef6\u5e76\u5f15\u7528\u57fa\u7840\u914d\u7f6e\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'// tsconfig.base.json\n{\n  "compilerOptions": {\n    "target": "ESNext",\n  },\n  "include": ["src/**/*"]\n}\n\n// packages/foo/tsconfig.json\n{\n  "extends": "../../tsconfig.base.json",\n  "compilerOptions": {\n    "rootDir": "src",\n    "outDir": "dist",\n  },\n}\n\n// packages/bar/tsconfig.json\n{\n  "extends": "../../tsconfig.base.json",\n  "compilerOptions": {\n    "rootDir": "src",\n    "outDir": "dist",\n  },\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\u5f88\u660e\u663e\uff0c\u8fd9\u91cc\u6ca1\u6709\u628a ",(0,o.jsx)(n.code,{children:"rootDir"})," \u548c ",(0,o.jsx)(n.code,{children:"outDir"})," \u914d\u7f6e\u653e\u5230\u516c\u5171\u7684\u57fa\u7840\u914d\u7f6e\u4e2d\u53bb\uff0c\u8fd9\u662f\u56e0\u4e3a",(0,o.jsx)(n.strong,{children:"\u8def\u5f84\u76f8\u5173\u7684\u914d\u7f6e\uff08\u76f8\u5bf9\u8def\u5f84\uff09\u5728\u89e3\u6790\u65f6\u884c\u4e3a\u4e0d\u53ef\u9884\u6d4b\uff0c\u5f88\u5bb9\u6613\u51fa\u9519"}),"\uff0c\u4e3a\u4e86\u786e\u4fdd\u6b63\u786e\uff0c\u5fc5\u987b\u5c06\u5176\u653e\u5230\u5404\u81ea\u7684\u5b50\u5305\u914d\u7f6e\u4e2d\u53bb\u3002\u663e\u7136\uff0c\u8fd9\u6837\u7ef4\u62a4\u8d77\u6765\u5f88\u9ebb\u70e6\u3002"]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["\u7ec8\u4e8e\uff0cTypeScript \u5b98\u65b9\u5728 ",(0,o.jsxs)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files",children:["5.5 \u7248\u672c\u53d1\u5e03\u65f6\u652f\u6301\u4e86 ",(0,o.jsx)(n.code,{children:"${configDir}"})," \u6a21\u677f\u53d8\u91cf"]}),"\uff0c\u8fd9\u4f7f\u5f97\u8def\u5f84\u76f8\u5173\u914d\u7f6e\u66f4\u52a0\u660e\u786e\uff0c\u7ef4\u62a4\u8d77\u6765\u4e5f\u66f4\u65b9\u4fbf\u3002"]})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"{5-6,8}",children:'// tsconfig.base.json\n{\n  "compilerOptions": {\n    "target": "ESNext",\n    "rootDir": "${configDir}/src",\n    "outDir": "${configDir}/dist",\n  },\n  "include": ["${configDir}/src/**/*"]\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"\u6e90\u4ee3\u7801\u8df3\u8f6c",children:"\u6e90\u4ee3\u7801\u8df3\u8f6c"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.strong,{children:"Monorepo \u4e2d\u7684\u5305\u4f9d\u8d56\u5173\u7cfb\u901a\u5e38\u8f83\u4e3a\u590d\u6742\uff0c\u5728\u7ef4\u62a4\u8fc7\u7a0b\u4e2d\u9605\u8bfb\u6e90\u4ee3\u7801\u65f6\u4f1a\u9891\u7e41\u9047\u5230\u5176\u5b83\u4f9d\u8d56\u5305\u7684\u4ee3\u7801\u8c03\u7528"}),"\uff0c\u76f4\u63a5\u70b9\u51fb\u8df3\u8f6c\u4f1a\u8df3\u5230\u5bf9\u5e94\u7684\u7c7b\u578b\u5b9a\u4e49\u6587\u4ef6\uff0c\u8fd9\u5bf9\u4e8e\u6211\u4eec\u60f3\u76f4\u63a5\u67e5\u770b\u4f9d\u8d56\u5305\u7684\u6e90\u4ee3\u7801\u6765\u8bf4\u6781\u4e3a\u4e0d\u4fbf\u3002\u4e0d\u8fc7\uff0c\u6211\u4eec\u53ef\u4ee5\u7ed3\u5408 VSCode \u548c TypeScript \u7f16\u8bd1\u914d\u7f6e\u6765\u5b9e\u73b0\u70b9\u51fb\u76f4\u63a5\u8df3\u8f6c\u5230\u4f9d\u8d56\u5305\u6e90\u4ee3\u7801\u7684\u76ee\u7684\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u9996\u5148\uff0c\u9700\u8981\u914d\u7f6e\u4e00\u4e0b VSCode \u4e2d JavaSCript/TypeScript \u7684 ",(0,o.jsx)(n.code,{children:"Prefer Go To Source Definition"})," \u914d\u7f6e\u9879\u3002"]}),"\n",(0,o.jsxs)(n.p,{children:["\u63a5\u4e0b\u6765\uff0c\u518d\u914d\u7f6e\u4e00\u4e0b TypeScript \u7684\u7f16\u8bd1\u914d\u7f6e ",(0,o.jsx)(n.a,{href:"https://www.typescriptlang.org/tsconfig/#declarationMap",children:(0,o.jsx)(n.code,{children:"declarationMap"})})," \u5373\u53ef\uff1a"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"{4}",children:'{\n  "compilerOptions": {\n    "declaration": true,\n    "declarationMap": true,\n    "declarationDir": "${configDir}/types",\n  }\n}\n'})}),"\n",(0,o.jsx)(n.h2,{id:"vite-\u4e0e\u5b9e\u65f6\u751f\u6210\u7c7b\u578b\u5b9a\u4e49",children:"Vite \u4e0e\u5b9e\u65f6\u751f\u6210\u7c7b\u578b\u5b9a\u4e49"}),"\n",(0,o.jsx)(n.p,{children:"\u73b0\u5728\uff0c\u6211\u4eec\u559c\u6b22\u5728\u5f00\u53d1\u6a21\u5f0f\u4e0b\u4f7f\u7528 Vite \u8fd9\u79cd Bundless \u6a21\u5f0f\u7684\u6784\u5efa\u5de5\u5177\u6765\u52a0\u901f\u6211\u4eec\u7684\u5f00\u53d1\u5de5\u4f5c\u6d41\uff0c\u5c24\u5176\u662f\u5728 Monorepo \u4e2d\u7f16\u5199\u5e93\u7684\u4f7f\u7528\u793a\u4f8b\u65f6\u6781\u4e3a\u4fbf\u5229\u3002"}),"\n",(0,o.jsxs)(n.p,{children:["\u7136\u800c\uff0c\u5f53\u6211\u4eec\u540c\u65f6\u4f7f\u7528 TypeScript \u65f6\uff0c",(0,o.jsx)(n.strong,{children:"\u5b9e\u65f6\u6784\u5efa\u7c7b\u578b\u5b9a\u4e49\u6587\u4ef6\u4e5f\u5f88\u91cd\u8981\uff0c\u8fd9\u6709\u52a9\u4e8e\u6211\u4eec\u9891\u7e41\u7684\u5728\u591a\u4e2a\u5b50\u5305\u4e4b\u95f4\u4fee\u6539\u4ee3\u7801\u800c\u4e0d\u4f1a\u51fa\u9519"}),"\u3002\u5f53\u5b50\u5305\u6570\u91cf\u5f88\u591a\u65f6\uff0c\u6211\u4eec\u4e0d\u53ef\u80fd\u4e3a\u6bcf\u4e2a\u5b50\u5305\u76ee\u5f55\u90fd\u542f\u52a8\u4e00\u4e2a\u6267\u884c ",(0,o.jsx)(n.code,{children:"tsc --watch"})," \u7684\u8fdb\u7a0b\uff0c\u8fd9\u4f1a\u7531\u4e8e\u8fdb\u7a0b\u592a\u591a\u4ea7\u751f\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898\u3002"]}),"\n",(0,o.jsx)(n.p,{children:"\u76f8\u53cd\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u6309\u9700\u7684\u65b9\u5f0f\uff0c\u5728 Vite \u68c0\u6d4b\u5230\u6587\u4ef6\u70ed\u66f4\u65b0\u65f6\u6765\u5b9e\u65f6\u6784\u5efa\u8be5\u5b50\u5305\u65b0\u7684\u7c7b\u578b\u5b9a\u4e49\u6587\u4ef6\uff0c\u8fd9\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u7684\u63d2\u4ef6\u6765\u5b9e\u73b0\u3002"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",metastring:"{21}",children:"import path from 'node:path';\nimport { exec } from 'node:child_process';\n\nfunction buildTypesPlugin() {\n  return {\n    name: 'build-types-plugin',\n    /**\n     * @see https://vite.dev/guide/api-plugin.html#handlehotupdate\n     */\n    handleHotUpdate({ file }) {\n      const relativePath = path.relative(__dirname, file);\n      const packagePath = relativePath.startsWith('packages/')\n        ? relativePath.split('/').slice(0, 2).join('/')\n        : null;\n\n      if (!packagePath) {\n        return;\n      }\n\n      exec(\n        `cd ${packagePath} && npm run build:types`,\n        (error, stdout, stderr) => {\n          const date = new Date();\n          const hours = date.getHours().toString().padStart(2, '0');\n          const minutes = date.getMinutes().toString().padStart(2, '0');\n          const seconds = date.getSeconds().toString().padStart(2, '0');\n\n          if (error) {\n            console.error(\n              `\\x1b[90m${hours}:${minutes}:${seconds} [build:types]: ${error}`,\n              '\\x1b[0m',\n            );\n            return;\n          }\n\n          console.log(\n            `\\x1b[90m${hours}:${minutes}:${seconds} [build:types] success`,\n            '\\x1b[0m',\n          );\n        },\n      );\n    },\n  };\n}\n"})}),"\n",(0,o.jsx)(n.h2,{id:"\u76f8\u5173\u8d44\u6599",children:"\u76f8\u5173\u8d44\u6599"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Monorepo",children:"https://en.wikipedia.org/wiki/Monorepo"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files",children:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://github.com/microsoft/TypeScript/issues/57485",children:"https://github.com/microsoft/TypeScript/issues/57485"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.a,{href:"https://www.typescriptlang.org/tsconfig/#declarationMap",children:"https://www.typescriptlang.org/tsconfig/#declarationMap"})}),"\n"]})]})}function d(e={}){const{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},11151:(e,n,t)=>{t.d(n,{Z:()=>c,a:()=>s});var o=t(67294);const i={},r=o.createContext(i);function s(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);