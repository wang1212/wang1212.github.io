"use strict";(self.webpackChunkmy_blog=self.webpackChunkmy_blog||[]).push([["52718"],{33560:function(e,n,t){t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>r,toc:()=>p});var r=t(95477),i=t(85893),o=t(50065);let s={title:"Monorepo \u4E2D\u4F7F\u7528 TypeScript \u7684\u95EE\u9898",date:new Date("2024-10-20T13:48:00.000Z"),update:new Date("2024-10-23T01:12:00.000Z"),authors:"wang1212",tags:["\u8BA1\u7B97\u673A\u6280\u672F","\u5DE5\u5177","TypeScript","Monorepo","\u5B9E\u8DF5\u6848\u4F8B"],keywords:["\u8BA1\u7B97\u673A\u6280\u672F","\u5DE5\u5177","TypeScript","Monorepo","\u5B9E\u8DF5\u6848\u4F8B"],description:"\u5728 Monorepo \u4E2D\u4F7F\u7528 TypeScript \u65F6\u76F8\u6BD4\u4E8E\u5355\u5305\u4ED3\u5E93\u8981\u590D\u6742\u7684\u591A\uFF0C\u4F1A\u9047\u5230\u4E00\u7CFB\u5217\u95EE\u9898\uFF0C\u8FD9\u91CC\u8BB0\u5F55\u4E00\u4E0B\u8FD9\u4E9B\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\u3002"},a=void 0,c={authorsImageUrls:[void 0]},p=[{value:"\u5171\u4EAB\u9879\u76EE\u914D\u7F6E",id:"\u5171\u4EAB\u9879\u76EE\u914D\u7F6E",level:2},{value:"\u6E90\u4EE3\u7801\u8DF3\u8F6C",id:"\u6E90\u4EE3\u7801\u8DF3\u8F6C",level:2},{value:"Vite \u4E0E\u5B9E\u65F6\u751F\u6210\u7C7B\u578B\u5B9A\u4E49",id:"vite-\u4E0E\u5B9E\u65F6\u751F\u6210\u7C7B\u578B\u5B9A\u4E49",level:2},{value:"\u76F8\u5173\u8D44\u6599",id:"\u76F8\u5173\u8D44\u6599",level:2}];function l(e){let n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"\u5728 Monorepo \u4E2D\u4F7F\u7528 TypeScript \u65F6\u76F8\u6BD4\u4E8E\u5355\u5305\u4ED3\u5E93\u8981\u590D\u6742\u7684\u591A\uFF0C\u4F1A\u9047\u5230\u4E00\u7CFB\u5217\u95EE\u9898\uFF0C\u8FD9\u91CC\u8BB0\u5F55\u4E00\u4E0B\u8FD9\u4E9B\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\u3002"}),"\n",(0,i.jsx)(n.h2,{id:"\u5171\u4EAB\u9879\u76EE\u914D\u7F6E",children:"\u5171\u4EAB\u9879\u76EE\u914D\u7F6E"}),"\n",(0,i.jsxs)(n.p,{children:["\u4E3A\u4E86\u964D\u4F4E\u7EF4\u62A4\u6210\u672C\uFF0C\u901A\u5E38\u7684\u505A\u6CD5\u662F\u5728\u9879\u76EE\u6839\u76EE\u5F55\u521B\u5EFA\u4E00\u4E2A ",(0,i.jsx)(n.strong,{children:"tsconfig.base.json"})," \u914D\u7F6E\u6587\u4EF6\u4F5C\u4E3A\u516C\u5171\u7684\u57FA\u7840\u914D\u7F6E\uFF0C\u540C\u65F6\u5728\u6BCF\u4E2A\u5B50\u5305\u4E2D\u518D\u521B\u5EFA\u4E00\u4E2A\u5355\u72EC\u7684\u914D\u7F6E\u6587\u4EF6\u5E76\u5F15\u7528\u57FA\u7840\u914D\u7F6E\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:'// tsconfig.base.json\n{\n  "compilerOptions": {\n    "target": "ESNext",\n  },\n  "include": ["src/**/*"]\n}\n\n// packages/foo/tsconfig.json\n{\n  "extends": "../../tsconfig.base.json",\n  "compilerOptions": {\n    "rootDir": "src",\n    "outDir": "dist",\n  },\n}\n\n// packages/bar/tsconfig.json\n{\n  "extends": "../../tsconfig.base.json",\n  "compilerOptions": {\n    "rootDir": "src",\n    "outDir": "dist",\n  },\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:["\u5F88\u660E\u663E\uFF0C\u8FD9\u91CC\u6CA1\u6709\u628A ",(0,i.jsx)(n.code,{children:"rootDir"})," \u548C ",(0,i.jsx)(n.code,{children:"outDir"})," \u914D\u7F6E\u653E\u5230\u516C\u5171\u7684\u57FA\u7840\u914D\u7F6E\u4E2D\u53BB\uFF0C\u8FD9\u662F\u56E0\u4E3A",(0,i.jsx)(n.strong,{children:"\u8DEF\u5F84\u76F8\u5173\u7684\u914D\u7F6E\uFF08\u76F8\u5BF9\u8DEF\u5F84\uFF09\u5728\u89E3\u6790\u65F6\u884C\u4E3A\u4E0D\u53EF\u9884\u6D4B\uFF0C\u5F88\u5BB9\u6613\u51FA\u9519"}),"\uFF0C\u4E3A\u4E86\u786E\u4FDD\u6B63\u786E\uFF0C\u5FC5\u987B\u5C06\u5176\u653E\u5230\u5404\u81EA\u7684\u5B50\u5305\u914D\u7F6E\u4E2D\u53BB\u3002\u663E\u7136\uFF0C\u8FD9\u6837\u7EF4\u62A4\u8D77\u6765\u5F88\u9EBB\u70E6\u3002"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["\u7EC8\u4E8E\uFF0CTypeScript \u5B98\u65B9\u5728 ",(0,i.jsxs)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files",children:["5.5 \u7248\u672C\u53D1\u5E03\u65F6\u652F\u6301\u4E86 ",(0,i.jsx)(n.code,{children:"${configDir}"})," \u6A21\u677F\u53D8\u91CF"]}),"\uFF0C\u8FD9\u4F7F\u5F97\u8DEF\u5F84\u76F8\u5173\u914D\u7F6E\u66F4\u52A0\u660E\u786E\uFF0C\u7EF4\u62A4\u8D77\u6765\u4E5F\u66F4\u65B9\u4FBF\u3002"]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:"{5-6,8}",children:'// tsconfig.base.json\n{\n  "compilerOptions": {\n    "target": "ESNext",\n    "rootDir": "${configDir}/src",\n    "outDir": "${configDir}/dist",\n  },\n  "include": ["${configDir}/src/**/*"]\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u6E90\u4EE3\u7801\u8DF3\u8F6C",children:"\u6E90\u4EE3\u7801\u8DF3\u8F6C"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Monorepo \u4E2D\u7684\u5305\u4F9D\u8D56\u5173\u7CFB\u901A\u5E38\u8F83\u4E3A\u590D\u6742\uFF0C\u5728\u7EF4\u62A4\u8FC7\u7A0B\u4E2D\u9605\u8BFB\u6E90\u4EE3\u7801\u65F6\u4F1A\u9891\u7E41\u9047\u5230\u5176\u5B83\u4F9D\u8D56\u5305\u7684\u4EE3\u7801\u8C03\u7528"}),"\uFF0C\u76F4\u63A5\u70B9\u51FB\u8DF3\u8F6C\u4F1A\u8DF3\u5230\u5BF9\u5E94\u7684\u7C7B\u578B\u5B9A\u4E49\u6587\u4EF6\uFF0C\u8FD9\u5BF9\u4E8E\u6211\u4EEC\u60F3\u76F4\u63A5\u67E5\u770B\u4F9D\u8D56\u5305\u7684\u6E90\u4EE3\u7801\u6765\u8BF4\u6781\u4E3A\u4E0D\u4FBF\u3002\u4E0D\u8FC7\uFF0C\u6211\u4EEC\u53EF\u4EE5\u7ED3\u5408 VSCode \u548C TypeScript \u7F16\u8BD1\u914D\u7F6E\u6765\u5B9E\u73B0\u70B9\u51FB\u76F4\u63A5\u8DF3\u8F6C\u5230\u4F9D\u8D56\u5305\u6E90\u4EE3\u7801\u7684\u76EE\u7684\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u9996\u5148\uFF0C\u9700\u8981\u914D\u7F6E\u4E00\u4E0B VSCode \u4E2D JavaSCript/TypeScript \u7684 ",(0,i.jsx)(n.code,{children:"Prefer Go To Source Definition"})," \u914D\u7F6E\u9879\u3002"]}),"\n",(0,i.jsxs)(n.p,{children:["\u63A5\u4E0B\u6765\uFF0C\u518D\u914D\u7F6E\u4E00\u4E0B TypeScript \u7684\u7F16\u8BD1\u914D\u7F6E ",(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/tsconfig/#declarationMap",children:(0,i.jsx)(n.code,{children:"declarationMap"})})," \u5373\u53EF\uFF1A"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:"{4}",children:'{\n  "compilerOptions": {\n    "declaration": true,\n    "declarationMap": true,\n    "declarationDir": "${configDir}/types",\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"vite-\u4E0E\u5B9E\u65F6\u751F\u6210\u7C7B\u578B\u5B9A\u4E49",children:"Vite \u4E0E\u5B9E\u65F6\u751F\u6210\u7C7B\u578B\u5B9A\u4E49"}),"\n",(0,i.jsx)(n.p,{children:"\u73B0\u5728\uFF0C\u6211\u4EEC\u559C\u6B22\u5728\u5F00\u53D1\u6A21\u5F0F\u4E0B\u4F7F\u7528 Vite \u8FD9\u79CD Bundless \u6A21\u5F0F\u7684\u6784\u5EFA\u5DE5\u5177\u6765\u52A0\u901F\u6211\u4EEC\u7684\u5F00\u53D1\u5DE5\u4F5C\u6D41\uFF0C\u5C24\u5176\u662F\u5728 Monorepo \u4E2D\u7F16\u5199\u5E93\u7684\u4F7F\u7528\u793A\u4F8B\u65F6\u6781\u4E3A\u4FBF\u5229\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u7136\u800C\uFF0C\u5F53\u6211\u4EEC\u540C\u65F6\u4F7F\u7528 TypeScript \u65F6\uFF0C",(0,i.jsx)(n.strong,{children:"\u5B9E\u65F6\u6784\u5EFA\u7C7B\u578B\u5B9A\u4E49\u6587\u4EF6\u4E5F\u5F88\u91CD\u8981\uFF0C\u8FD9\u6709\u52A9\u4E8E\u6211\u4EEC\u9891\u7E41\u7684\u5728\u591A\u4E2A\u5B50\u5305\u4E4B\u95F4\u4FEE\u6539\u4EE3\u7801\u800C\u4E0D\u4F1A\u51FA\u9519"}),"\u3002\u5F53\u5B50\u5305\u6570\u91CF\u5F88\u591A\u65F6\uFF0C\u6211\u4EEC\u4E0D\u53EF\u80FD\u4E3A\u6BCF\u4E2A\u5B50\u5305\u76EE\u5F55\u90FD\u542F\u52A8\u4E00\u4E2A\u6267\u884C ",(0,i.jsx)(n.code,{children:"tsc --watch"})," \u7684\u8FDB\u7A0B\uFF0C\u8FD9\u4F1A\u7531\u4E8E\u8FDB\u7A0B\u592A\u591A\u4EA7\u751F\u4E25\u91CD\u7684\u6027\u80FD\u95EE\u9898\u3002"]}),"\n",(0,i.jsx)(n.p,{children:"\u76F8\u53CD\uFF0C\u6211\u4EEC\u53EF\u4EE5\u8003\u8651\u6309\u9700\u7684\u65B9\u5F0F\uFF0C\u5728 Vite \u68C0\u6D4B\u5230\u6587\u4EF6\u70ED\u66F4\u65B0\u65F6\u6765\u5B9E\u65F6\u6784\u5EFA\u8BE5\u5B50\u5305\u65B0\u7684\u7C7B\u578B\u5B9A\u4E49\u6587\u4EF6\uFF0C\u8FD9\u53EF\u4EE5\u901A\u8FC7\u4E00\u4E2A\u7B80\u5355\u7684\u63D2\u4EF6\u6765\u5B9E\u73B0\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",metastring:"{21}",children:"import path from 'node:path';\nimport { exec } from 'node:child_process';\n\nfunction buildTypesPlugin() {\n  return {\n    name: 'build-types-plugin',\n    /**\n     * @see https://vite.dev/guide/api-plugin.html#handlehotupdate\n     */\n    handleHotUpdate({ file }) {\n      const relativePath = path.relative(__dirname, file);\n      const packagePath = relativePath.startsWith('packages/')\n        ? relativePath.split('/').slice(0, 2).join('/')\n        : null;\n\n      if (!packagePath) {\n        return;\n      }\n\n      exec(\n        `cd ${packagePath} && npm run build:types`,\n        (error, stdout, stderr) => {\n          const date = new Date();\n          const hours = date.getHours().toString().padStart(2, '0');\n          const minutes = date.getMinutes().toString().padStart(2, '0');\n          const seconds = date.getSeconds().toString().padStart(2, '0');\n\n          if (error) {\n            console.error(\n              `\\x1b[90m${hours}:${minutes}:${seconds} [build:types]: ${error}`,\n              '\\x1b[0m',\n            );\n            return;\n          }\n\n          console.log(\n            `\\x1b[90m${hours}:${minutes}:${seconds} [build:types] success`,\n            '\\x1b[0m',\n          );\n        },\n      );\n    },\n  };\n}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u76F8\u5173\u8D44\u6599",children:"\u76F8\u5173\u8D44\u6599"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Monorepo",children:"https://en.wikipedia.org/wiki/Monorepo"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files",children:"https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-5.html#the-configdir-template-variable-for-configuration-files"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://github.com/microsoft/TypeScript/issues/57485",children:"https://github.com/microsoft/TypeScript/issues/57485"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://www.typescriptlang.org/tsconfig/#declarationMap",children:"https://www.typescriptlang.org/tsconfig/#declarationMap"})}),"\n"]})]})}function d(e={}){let{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},50065:function(e,n,t){t.d(n,{Z:()=>a,a:()=>s});var r=t(67294);let i={},o=r.createContext(i);function s(e){let n=r.useContext(o);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:s(e.components),r.createElement(o.Provider,{value:n},e.children)}},95477:function(e){e.exports=JSON.parse('{"permalink":"/2024/10/20/computer-technology/typescript/tools-ts-in-monorepo","editUrl":"https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/typescript/2024-10-20-tools-ts-in-monorepo.md","source":"@site/blog/computer-technology/typescript/2024-10-20-tools-ts-in-monorepo.md","title":"Monorepo \u4E2D\u4F7F\u7528 TypeScript \u7684\u95EE\u9898","description":"\u5728 Monorepo \u4E2D\u4F7F\u7528 TypeScript \u65F6\u76F8\u6BD4\u4E8E\u5355\u5305\u4ED3\u5E93\u8981\u590D\u6742\u7684\u591A\uFF0C\u4F1A\u9047\u5230\u4E00\u7CFB\u5217\u95EE\u9898\uFF0C\u8FD9\u91CC\u8BB0\u5F55\u4E00\u4E0B\u8FD9\u4E9B\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\u3002","date":"2024-10-20T13:48:00.000Z","tags":[{"inline":true,"label":"\u8BA1\u7B97\u673A\u6280\u672F","permalink":"/tags/\u8BA1\u7B97\u673A\u6280\u672F"},{"inline":true,"label":"\u5DE5\u5177","permalink":"/tags/\u5DE5\u5177"},{"inline":true,"label":"TypeScript","permalink":"/tags/type-script"},{"inline":true,"label":"Monorepo","permalink":"/tags/monorepo"},{"inline":true,"label":"\u5B9E\u8DF5\u6848\u4F8B","permalink":"/tags/\u5B9E\u8DF5\u6848\u4F8B"}],"readingTime":3.07,"hasTruncateMarker":true,"authors":[{"name":"\u4E0D\u5982\u6000\u5FF5","title":"Web \u524D\u7AEF\u5DE5\u7A0B\u5E08 (Web Front-end Engineer)","url":"https://github.com/wang1212","email":"mrwang1212@126.com","socials":{"github":"https://github.com/wang1212","x":"https://x.com/wang1212x","reddit":"https://www.reddit.com/user/Warm_Salt_2251","rednote":"https://www.xiaohongshu.com/user/profile/5e4130cb00000000010023fd"},"imageURL":"/img/authors/wang1212.png","key":"wang1212","page":null}],"frontMatter":{"title":"Monorepo \u4E2D\u4F7F\u7528 TypeScript \u7684\u95EE\u9898","date":"2024-10-20T13:48:00.000Z","update":"2024-10-23T01:12:00.000Z","authors":"wang1212","tags":["\u8BA1\u7B97\u673A\u6280\u672F","\u5DE5\u5177","TypeScript","Monorepo","\u5B9E\u8DF5\u6848\u4F8B"],"keywords":["\u8BA1\u7B97\u673A\u6280\u672F","\u5DE5\u5177","TypeScript","Monorepo","\u5B9E\u8DF5\u6848\u4F8B"],"description":"\u5728 Monorepo \u4E2D\u4F7F\u7528 TypeScript \u65F6\u76F8\u6BD4\u4E8E\u5355\u5305\u4ED3\u5E93\u8981\u590D\u6742\u7684\u591A\uFF0C\u4F1A\u9047\u5230\u4E00\u7CFB\u5217\u95EE\u9898\uFF0C\u8FD9\u91CC\u8BB0\u5F55\u4E00\u4E0B\u8FD9\u4E9B\u95EE\u9898\u7684\u89E3\u51B3\u65B9\u6848\u3002"},"unlisted":false,"prevItem":{"title":"\u300C\u6BCF\u5468\u56DE\u987E\u300DEP2024W43\uFF1AReact Native \u65B0\u67B6\u6784\u3001Next.js \u7F13\u5B58\u4E0E Facebook \u8D1F\u8F7D\u5747\u8861","permalink":"/2024/10/27/weekly/2024/weekly-review-ep2024w43"},"nextItem":{"title":"\u300C\u6BCF\u5468\u56DE\u987E\u300DEP2024W42\uFF1ANode.js 23 \u53D1\u5E03","permalink":"/2024/10/20/weekly/2024/weekly-review-ep2024w42"}}')}}]);