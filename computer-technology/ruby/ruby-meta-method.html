<!doctype html><html lang=zh-Hans dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>Ruby-元编程之方法 | 不如怀念</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://wang1212.github.io/computer-technology/ruby/ruby-meta-method><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="Ruby-元编程之方法 | 不如怀念"><meta data-rh=true name=description content="这篇文章讲述关于 Ruby 中方法相关的知识。事实上，有很多编程语言都具备元编程的能力，而 Ruby 则是将元编程发挥到极致的语言。元编程这个概念是模糊的，很多人都说是用代码生成代码的方式，不过我们不用去纠结这个概念。元编程最具有魅力的地方就是，原来我们还可以在程序运行时去操控代码。"><meta data-rh=true property=og:description content="这篇文章讲述关于 Ruby 中方法相关的知识。事实上，有很多编程语言都具备元编程的能力，而 Ruby 则是将元编程发挥到极致的语言。元编程这个概念是模糊的，很多人都说是用代码生成代码的方式，不过我们不用去纠结这个概念。元编程最具有魅力的地方就是，原来我们还可以在程序运行时去操控代码。"><meta data-rh=true name=keywords content=计算机技术,Ruby,元编程,Method><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2016-08-08T12:56:00.000Z><meta data-rh=true property=article:author content=https://github.com/wang1212><meta data-rh=true property=article:tag content=计算机技术,Ruby,元编程,Method><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://wang1212.github.io/computer-technology/ruby/ruby-meta-method><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/ruby/ruby-meta-method hreflang=zh-Hans><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/ruby/ruby-meta-method hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wang1212.github.io/computer-technology/ruby/ruby-meta-method","@type":"BlogPosting","author":{"@type":"Person","description":"Web 前端工程师 (Web Front-end Engineer)","email":"mrwang1212@126.com","image":"/img/authors/wang1212.png","name":"不如怀念","url":"https://github.com/wang1212"},"datePublished":"2016-08-08T12:56:00.000Z","description":"这篇文章讲述关于 Ruby 中方法相关的知识。事实上，有很多编程语言都具备元编程的能力，而 Ruby 则是将元编程发挥到极致的语言。元编程这个概念是模糊的，很多人都说是用代码生成代码的方式，不过我们不用去纠结这个概念。元编程最具有魅力的地方就是，原来我们还可以在程序运行时去操控代码。","headline":"Ruby-元编程之方法","isPartOf":{"@id":"https://wang1212.github.io/","@type":"Blog","name":"Blog"},"keywords":["计算机技术","Ruby","元编程","Method"],"mainEntityOfPage":"https://wang1212.github.io/computer-technology/ruby/ruby-meta-method","name":"Ruby-元编程之方法","url":"https://wang1212.github.io/computer-technology/ruby/ruby-meta-method"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="不如怀念 RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="不如怀念 Atom Feed"><link rel=stylesheet href=/assets/css/styles.9a43e9e5.css><script src=/assets/js/runtime~main.659a2213.js defer></script><script src=/assets/js/main.ec32428b.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/authors/wang1212.png><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">不如怀念</b></a><a class="navbar__item navbar__link" href=/archive>归档</a><a class="navbar__item navbar__link" href=/timeline>历程</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">精选资源<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=搜索 aria-label=Search class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label=最近博文导航><div class="sidebarItemTitle_pO2u margin-bottom--md">近期文章</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/13/weekly/2025/weekly-review-ep2025w28>「每周回顾」EP2025W28：Grok 4 发布与 AI 企业服务转型</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/06/weekly/2025/weekly-review-ep2025w27>「每周回顾」EP2025W27：GitHub Copilot Chat 开源</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/29/weekly/2025/weekly-review-ep2025w26>「每周回顾」EP2025W26：ECMAScript 2025 正式发布，AI 代理与前端工具持续演进</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/22/weekly/2025/weekly-review-ep2025w25>「每周回顾」EP2025W25：AI 编程趋势、React 发展与 AI 代理安全</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/15/weekly/2025/weekly-review-ep2025w24>「每周回顾」EP2025W24：React 服务器组件中导入的工作原理</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/08/weekly/2025/weekly-review-ep2025w23>「每周回顾」EP2025W23：探索 Claude 4 系统提示与渐进式 JSON</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/05/25/weekly/2025/weekly-review-ep2025w21>「每周回顾」EP2025W21：JavaScript 30 年发展简史</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/05/11/weekly/2025/weekly-review-ep2025w19>「每周回顾」EP2025W19：服务端组件、Node.js 24 及 Llama 4</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/04/27/weekly/2025/weekly-review-ep2025w17>「每周回顾」EP2025W17：React Compiler RC 发布，自动记忆优化 React 应用性能</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/04/20/weekly/2025/weekly-review-ep2025w16>「每周回顾」EP2025W16：API 开发学习指南与 MCP AI 工具创新</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>Ruby-元编程之方法</h1><div class="container_mt6G margin-vert--md"><time datetime=2016-08-08T12:56:00.000Z>2016年8月8日</time> · <!-- -->阅读需 11 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/img/authors/wang1212.png alt=不如怀念></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer"><span class=authorName_yefp>不如怀念</span></a></div><small class=authorTitle_nd0D title="Web 前端工程师 (Web Front-end Engineer)">Web 前端工程师 (Web Front-end Engineer)</small><div class=authorSocials_rSDt><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=GitHub><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 256 250" preserveAspectRatio=xMidYMid style=--dark:#000;--light:#fff class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"/></svg></a></div></div></div></div></div></header><blockquote>最后更新于 <!-- -->2016-08-08 12:56:00</blockquote><div id=__blog-post-container class=markdown><p><u>本文的代码均在 Ruby 2.3.0 环境下测试通过。</u>
<br>
<br></p>
<p>这篇文章讲述关于 Ruby 中方法相关的知识。事实上，有很多编程语言都具备元编程的能力，而 Ruby 则是将元编程发挥到极致的语言。元编程这个概念是模糊的，很多人都说是用代码生成代码的方式，不过我们不用去纠结这个概念。元编程最具有魅力的地方就是，原来我们还可以在程序运行时去操控代码。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=方法method>方法（Method）<a href=#方法method class=hash-link aria-label=方法（Method）的直接链接 title=方法（Method）的直接链接>​</a></h2>
<p>在 OOP（面向对象编程）思想中，对象之间通过消息传递来进行交互，其实所谓的消息就是方法。当我们调用了一个对象的某个方法时，意味着当前对象给目标对象发送了一条消息。所以说，方法也是一个很重要的概念。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=修饰符>修饰符<a href=#修饰符 class=hash-link aria-label=修饰符的直接链接 title=修饰符的直接链接>​</a></h3>
<p><strong>Ruby 中的实例方法有三种修饰符，<code>public</code>、<code>protected</code>、<code>private</code>，修饰符只是限制了实例方法的调用权限，并不影响继承，所有的超类方法都会被子类继承。</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># 声明形式修饰方法</span><br></span><span class=token-line style=color:#393A34><span class="token plain">class Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # 这里定义公共方法</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    protected</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # 这里定义保护方法</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # 这里定义私有方法</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># 标记形式修饰方法</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    class Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def method1 ; end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def method2 ; end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def method3 ; end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    # 标记，可接受多个方法名参数</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    protected :method2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private :method3</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span></code></pre></div></div>
<p>其中 <code>public</code> 是默认的修饰符，代表方法是允许外部调用的；而 <code>private</code> 修饰的方法是不允许外部调用的，只允许在对象内部调用且不需要显式指出接受者，默认为 <code>self</code>，否则会报错。</p>
<p>另外需要注意的是，<code>protected</code> 修饰的方法比较特殊，必须遵循：**接受者与发送者均为同一个类或者具有继承关系的两个类的实例。**其实，就是说保护方法只能在实例方法中调用，在其它地方是不能调用的。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class SuperClass</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def m1(obj)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        # 保护方法只能在实例方法中调用</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        obj.m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    protected</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def m</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        p "1"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">class SubClass &lt; SuperClass</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># 同一个类的不同实例</span><br></span><span class=token-line style=color:#393A34><span class="token plain">SuperClass.new.m1(SuperClass.new)  # ==> 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># 超类与子类实例</span><br></span><span class=token-line style=color:#393A34><span class="token plain">SuperClass.new.m1(SubClass.new)  # ==> 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">SubClass.new.m1(SuperClass.new)  # ==> 1</span><br></span></code></pre></div></div>
<p>用 Ruby 来编程的话，我们大多数时候写的都是公共方法，只要能分辨出不同方法的调用权限即可，而且无论什么方法都是会被子类继承的。</p>
<p>现在可以学习一些元编程的技巧了。下面有一个这样的场景：我们从图书馆办卡、借书、还书的时候都需要机器或者图书管理员作为中介帮助我们进行这些操作，而不能自己直接去操作图书馆数据库。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Library</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def get_card(name,book_id=nil)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "#{name}办卡"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def check_out(name,book_id)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "#{name}借书#{book_id}"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def return_book(name,book_id)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "#{name}还书#{book_id}"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">class Manager</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def initialize</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        @library = Library.new</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "现在受理业务"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def controller(type,name,book_id=nil)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        # ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        case type</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        when "get_card"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            @library.get_card(name)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        when "check_out"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            @library.check_out(name,book_id)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        when "return_book"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            @library.return_book(name,book_id)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            return puts "操作失败"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "操作成功"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># 模拟管理员业务</span><br></span><span class=token-line style=color:#393A34><span class="token plain">manager = Manager.new</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 现在受理业务</span><br></span><span class=token-line style=color:#393A34><span class="token plain">manager.controller("get_card","小王")</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 小王办卡</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 操作成功</span><br></span><span class=token-line style=color:#393A34><span class="token plain">manager.controller("check_out","小明",222)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 小明借书222</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 操作成功</span><br></span><span class=token-line style=color:#393A34><span class="token plain">manager.controller("return_book","小李",111)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 小李还书111</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 操作成功</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=动态派发>动态派发<a href=#动态派发 class=hash-link aria-label=动态派发的直接链接 title=动态派发的直接链接>​</a></h3>
<p>Manager 类代理了读者的各种业务操作，并在其中可以进行相应过滤，保证图书馆数据安全。不过，我们可以看到 <code>Manager</code> 中 <code>controller()</code> 方法是通过 <code>case...when</code> 来代理读者业务的，如果 <code>Library</code> 增加了新业务，那么该方法似乎又要添加新的 <code>when</code> 子句，业务如果很多呢？ <code>controller()</code> 方法似乎会变得臃肿，却实际上都在进行无聊的重复。</p>
<p>下面我们要介绍的就是<strong>动态派发</strong>技术。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Manager</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def controller(type,name,book_id=nil)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        ...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        # 动态派发</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        @library.send(type,name,book_id)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "操作成功"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span></code></pre></div></div>
<p>所有的 <code>case...when</code> 只需要一句 <code>send()</code> 方法代替即可实现同样的业务，并且不再担心 <code>Library</code> 增加业务的情况，是不是很强大呢。</p>
<p>**动态派发：**我们可以使用目标对象的<code>send()</code>方法来给其发送一条消息，也就是实现方法调用，该方法第一个参数为方法名称（可以是字符串或者符号），后续参数为传入方法的参数，最后一个参数为方法的块。不过，我们需要强调一下动态的意义，所谓动态就是我们只有在运行时才会知道调用哪个方法，另一个角度来说我们根本不需要在乎调用哪个方法。</p>
<p><strong>注意：<code>send()</code> 方法会无视 <code>private</code> 权限而调用私有方法，如果有需要可以这么做；否则请用 <code>public_send()</code> 方法代替，从而避免调用目标对象的私有方法。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=动态定义>动态定义<a href=#动态定义 class=hash-link aria-label=动态定义的直接链接 title=动态定义的直接链接>​</a></h3>
<p>现在图书馆外面引进了大量的机器，无需办卡就可以免费阅览部分书籍，并定期更新。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Machine</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def initialize</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "今天可以免费阅览部分书籍了"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def book11</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "欢迎阅览本书，编号11"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #return content</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def book22</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "欢迎阅览本书，编号22"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #return content</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def book33</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "欢迎阅览本书，编号33"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        #return content</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># 模拟免费阅览业务</span><br></span><span class=token-line style=color:#393A34><span class="token plain">machine = Machine.new</span><br></span><span class=token-line style=color:#393A34><span class="token plain">machine.book11</span><br></span><span class=token-line style=color:#393A34><span class="token plain">machine.book22</span><br></span><span class=token-line style=color:#393A34><span class="token plain">machine.book33</span><br></span></code></pre></div></div>
<p>该机器提供了具体的方法让读者免费阅览相应的书籍，而且 <code>book11()</code>、<code>book22()</code>、<code>book33()</code>方法内部业务逻辑相似，更重要的这些可供免费阅览的书籍是定期更新的，那么这些相似的方法也就需要重新去写，这是一个多么枯燥的造轮子的过程。</p>
<p>下面我们要介绍的就是<strong>动态定义</strong>技术。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Machine</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    @@free_id = [11,22,33]</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def initialize</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        @@free_id.each do |id|</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            # 动态定义</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            define_singleton_method("book#{id}") do</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                puts "欢迎阅览本书，编号#{id}"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                #...</span><br></span><span class=token-line style=color:#393A34><span class="token plain">                #return content</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "部分书籍今天可以免费阅览了"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span></code></pre></div></div>
<p>我们将提供免费阅览的书籍的编号存进一个类变量，然后在实例化时通过 <code>define_singleton_method()</code> 方法动态的定义该对象的单例方法，以后定期更新类变量中的编号即可，不用手动去删除类中原来的实例方法，也不用手动去定义新添加的实例方法。</p>
<p>**动态定义：**使用 <code>define_singleton_method()</code> 方法即可为当前对象定义一个单例方法(singleton_method)，也就是该对象独有的方法；该方法接受一个参数也就是方法名，块中也可以指定多个参数作为将被定义的方法的参数。<code>define_method()</code> 方法类似的可以用来在类、模块或者类方法内部用来动态定义当前类、模块的实例方法。</p>
<p><strong>注意：<code>define_singleton_method()</code> 方法定义的是当前对象的单例方法；而 <code>define_method()</code> 方法定义的是当前类、模块的实例方法。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=幽灵方法>幽灵方法<a href=#幽灵方法 class=hash-link aria-label=幽灵方法的直接链接 title=幽灵方法的直接链接>​</a></h3>
<p>当我们调用一个不存在的方法时，Ruby 会报错，而报错之前 Ruby 都干了些什么呢？这是一个神秘的过程。我们都知道首先会沿对象的继承链去寻找这个方法，当没有找到时就会报错吗？其实不是的，Ruby 的 Kernel 模块中定义了一个私有实例方法 <code>method_missing()</code>，在没有找到对象的方法时，会将方法名转换成符号类型作为参数传进该方法进一步处理，然后才会报错。</p>
<p><strong>我们将 <code>method_missing()</code> 方法称为幽灵方法，因为它只有在找不到我们定义的方法时才出现，借助它我们可以做很多原来不可能完成的事情；它的首个参数就是符号类型方法名，其余参数捕获的则是传入该方法的参数。</strong></p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def method_missing(name, *args)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        puts "#{name} 方法没有找到，参数为#{args}"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span></code></pre></div></div>
<p>这是个空类，我们调用该类实例对象的任何方法都不会报错。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class TestObject</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def initialize</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        @collect = {}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def method_missing(key, value=nil)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        key = key.to_s</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        if key =~ /=$/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            @collect.store(key.chop, value)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        else</span><br></span><span class=token-line style=color:#393A34><span class="token plain">            @collect[key]</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">obj = TestObject.new</span><br></span><span class=token-line style=color:#393A34><span class="token plain">obj.a = 123</span><br></span><span class=token-line style=color:#393A34><span class="token plain">obj.a  # ==> 123</span><br></span><span class=token-line style=color:#393A34><span class="token plain">obj.b  # ==> nil</span><br></span></code></pre></div></div>
<p>这样我们就创建了一个可自由设置和访问属性的对象，是不是有点像 JavaScript 中的对象呢。</p>
<p><strong>注意：<code>method_missing()</code> 实例方法是非常耗性能的，因为要查找整个继承链该方法才会起作用。类似的，在一个类、模块中，<code>const_missing()</code> 类方法用来处理引用一个不存在的常量时的情况。前者为实例方法，后者为类方法。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=响应询问>响应询问<a href=#响应询问 class=hash-link aria-label=响应询问的直接链接 title=响应询问的直接链接>​</a></h3>
<p>我们说了方法就是一个消息，在发送消息之前我们可以询问目标是否会有响应，也就是说要调用的方法是否存在，可以通过 <code>respond_to?()</code> 方法来完成。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Test</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def test1</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    public</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def test2</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    private</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def test3</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">t = Test.new</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.respond_to?(:test1)  # ==> true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.respond_to?(:test2)  # ==> true</span><br></span><span class=token-line style=color:#393A34><span class="token plain">t.respond_to?(:test3)  # ==> false</span><br></span></code></pre></div></div>
<p><strong>注意：该方法默认只询问 <code>public</code> 公有方法，若同时要询问保护方法和私有方法，需给定第二个参数为 <code>true</code>；而且私有方法调用时是不需要显式指出接受者的，否则会报错。</strong></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=方法参数>方法参数<a href=#方法参数 class=hash-link aria-label=方法参数的直接链接 title=方法参数的直接链接>​</a></h2>
<p>Ruby 中的方法参数目前支持<strong>位置参数</strong>、<strong>关键字参数</strong>、<strong>Array/Hash 参数（可变参数）</strong>、<strong>块参数</strong>。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=位置参数>位置参数<a href=#位置参数 class=hash-link aria-label=位置参数的直接链接 title=位置参数的直接链接>​</a></h3>
<p>特点：数量固定，必须按顺序传入值，可以有默认值。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">def test(a, b)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    p a: a, b: b</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2}</span><br></span></code></pre></div></div>
<p>位置参数可以带有默认值，不传入值时采用默认值，否则覆盖默认值；多个默认值参数位置必须连续，Ruby 会首先填充没有默认值的参数。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">def test(a, b='b', c='c', d)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    p a: a, b: b, c: c, d: d</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>"b", :c=>"c", :d=>2}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2, 3)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2, :c=>"c", :d=>3}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2, 3, 4)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2, :c=>3, :d=>4}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=关键字参数>关键字参数<a href=#关键字参数 class=hash-link aria-label=关键字参数的直接链接 title=关键字参数的直接链接>​</a></h3>
<p>特点：数量固定，必须显式指出关键字，不传入值时采用默认值，否则覆盖默认值。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">def test(a:, b:'b', c:)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    p "#{a} #{b} #{c}"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(a:1, c:3)  # ==> "1 b 3"</span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(a:1, b:2, c:3)  # ==> "1 2 3"</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=arrayhash-参数>Array/Hash 参数<a href=#arrayhash-参数 class=hash-link aria-label="Array/Hash 参数的直接链接" title="Array/Hash 参数的直接链接">​</a></h3>
<p>特点：数量可变，方法内部通过数组索引和键值访问；必须位于参数表末尾。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">def test(a, *b)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    p a: a, b: b</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>[]}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>[2]}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(1, 2, 3)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>[2, 3]}</span><br></span></code></pre></div></div>
<hr>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">def test(**a)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    p a</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">test()  # ==> {}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(a:1)  # ==> {:a=>1}</span><br></span><span class=token-line style=color:#393A34><span class="token plain">test(a:1,b:2)  # ==> {:a=>1, :b=>2}</span><br></span></code></pre></div></div>
<p>属于数组参数的还有一种对应赋值参数，就是把多个参数看为一个整体参数进行对应赋值。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class A</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def a(a, (b, c), d)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        p a: a, b: b, c: c, d: d</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">A.new.a(1, 2, 3)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2, :c=>nil, :d=>3}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">A.new.a(1, [2, 3], 4)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2, :c=>3, :d=>4}</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">A.new.a(1, [2, 3, 4], 5)</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> {:a=>1, :b=>2, :c=>3, :d=>5}</span><br></span></code></pre></div></div>
<p>要注意的是，这几种参数可组合在一起，但应符合：</p>
<ul>
<li>位置参数是按传入顺序匹配；关键字参数是按关键字匹配，与顺序无关，但必须指定关键字；</li>
<li>当位置参数与关键字混合使用时，所有位置参数必须放在任意关键字参数前面；</li>
<li>可变参数（Array 或 Hash）应该放在参数表末尾。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=块参数>块参数<a href=#块参数 class=hash-link aria-label=块参数的直接链接 title=块参数的直接链接>​</a></h3>
<p>事实上，每个方法还有一个隐藏的块参数，默认在参数表末尾，并用 <code>&</code> 操作符表示，用来捕获该方法的块。</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">class Array</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    def every(&block)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">        self.each(&block)</span><br></span><span class=token-line style=color:#393A34><span class="token plain">    end</span><br></span><span class=token-line style=color:#393A34><span class="token plain">end</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">[1, 2, 3].every { |value| puts value }</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 1</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 2</span><br></span><span class=token-line style=color:#393A34><span class="token plain"># ==> 3</span><br></span></code></pre></div></div>
<p>我们捕获到块之后就可以将块传入另一个方法，如果不需要将块传给其它方法则直接采用 <code>yield</code> 关键字调用块更方便，性能更好。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=结语>结语<a href=#结语 class=hash-link aria-label=结语的直接链接 title=结语的直接链接>​</a></h2>
<p>这下是不是见识到了元编程的能力呢？用你写的代码来动态生成更多的代码供我们所使用，也许这就是所谓的生成代码的代码。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=参考>参考<a href=#参考 class=hash-link aria-label=参考的直接链接 title=参考的直接链接>​</a></h2>
<ul>
<li>《Ruby 元编程》，[意] Paolo Perrotta，廖志刚 译</li>
<li>《Ruby 基础教程》，[日] 高桥征义 后藤裕藏，何文斯 译</li>
</ul></div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/计算机技术>计算机技术</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/ruby>Ruby</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/元编程>元编程</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/method>Method</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/ruby/ruby-meta-method.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=博文分页导航><a class="pagination-nav__link pagination-nav__link--prev" href=/computer-technology/web-frontend/web-cross-domain><div class=pagination-nav__sublabel>较新一篇</div><div class=pagination-nav__label>Web 前端跨域访问</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/computer-technology/ruby/ruby-meta-object><div class=pagination-nav__sublabel>较旧一篇</div><div class=pagination-nav__label>Ruby-元编程之对象模型</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#方法method class="table-of-contents__link toc-highlight">方法（Method）</a><ul><li><a href=#修饰符 class="table-of-contents__link toc-highlight">修饰符</a><li><a href=#动态派发 class="table-of-contents__link toc-highlight">动态派发</a><li><a href=#动态定义 class="table-of-contents__link toc-highlight">动态定义</a><li><a href=#幽灵方法 class="table-of-contents__link toc-highlight">幽灵方法</a><li><a href=#响应询问 class="table-of-contents__link toc-highlight">响应询问</a></ul><li><a href=#方法参数 class="table-of-contents__link toc-highlight">方法参数</a><ul><li><a href=#位置参数 class="table-of-contents__link toc-highlight">位置参数</a><li><a href=#关键字参数 class="table-of-contents__link toc-highlight">关键字参数</a><li><a href=#arrayhash-参数 class="table-of-contents__link toc-highlight">Array/Hash 参数</a><li><a href=#块参数 class="table-of-contents__link toc-highlight">块参数</a></ul><li><a href=#结语 class="table-of-contents__link toc-highlight">结语</a><li><a href=#参考 class="table-of-contents__link toc-highlight">参考</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>关于我</div><ul class="footer__items clean-list"><li class=footer__item><a href=mailto:mrwang1212@126.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gitee.com/i_wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>Gitee<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>更多</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class=footer__link-item>Awesome Favorites List<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/the-book-of-ruby target=_blank rel="noopener noreferrer" class=footer__link-item>The Book Of Ruby (ZH)<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/echarts-api-docs target=_blank rel="noopener noreferrer" class=footer__link-item>Apache ECharts APIs Guide<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 My Blog. Built with Docusaurus.</div></div></div></footer></div>