<!doctype html><html lang=zh-Hans dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>探索 Docusaurus 的路由实现 | 不如怀念</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://wang1212.github.io/computer-technology/tools/tools-docusaurus><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="探索 Docusaurus 的路由实现 | 不如怀念"><meta data-rh=true name=description content="Docusaurus 是由 Meta 公司发布的一款专门用来构建文档站点的工具库，当然也对博客网站提供支持，为了实现自定义博客的页面，遂对其路由机制做了简单的了解。"><meta data-rh=true property=og:description content="Docusaurus 是由 Meta 公司发布的一款专门用来构建文档站点的工具库，当然也对博客网站提供支持，为了实现自定义博客的页面，遂对其路由机制做了简单的了解。"><meta data-rh=true name=keywords content=计算机技术,工具,Docusaurus><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2022-11-15T00:47:00.000Z><meta data-rh=true property=article:author content=https://github.com/wang1212><meta data-rh=true property=article:tag content=计算机技术,工具,Docusaurus><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://wang1212.github.io/computer-technology/tools/tools-docusaurus><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/tools/tools-docusaurus hreflang=zh-Hans><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/tools/tools-docusaurus hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wang1212.github.io/computer-technology/tools/tools-docusaurus","@type":"BlogPosting","author":{"@type":"Person","description":"Web 前端工程师 (Web Front-end Engineer)","email":"mrwang1212@126.com","image":"/img/authors/wang1212.png","name":"不如怀念","url":"https://github.com/wang1212"},"datePublished":"2022-11-15T00:47:00.000Z","description":"Docusaurus 是由 Meta 公司发布的一款专门用来构建文档站点的工具库，当然也对博客网站提供支持，为了实现自定义博客的页面，遂对其路由机制做了简单的了解。","headline":"探索 Docusaurus 的路由实现","isPartOf":{"@id":"https://wang1212.github.io/","@type":"Blog","name":"Blog"},"keywords":["计算机技术","工具","Docusaurus"],"mainEntityOfPage":"https://wang1212.github.io/computer-technology/tools/tools-docusaurus","name":"探索 Docusaurus 的路由实现","url":"https://wang1212.github.io/computer-technology/tools/tools-docusaurus"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="不如怀念 RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="不如怀念 Atom Feed"><link rel=stylesheet href=/assets/css/styles.9a43e9e5.css><script src=/assets/js/runtime~main.dd1c5908.js defer></script><script src=/assets/js/main.0d9b245b.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/authors/wang1212.png><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">不如怀念</b></a><a class="navbar__item navbar__link" href=/archive>归档</a><a class="navbar__item navbar__link" href=/timeline>历程</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">精选资源<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=搜索 aria-label=Search class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label=最近博文导航><div class="sidebarItemTitle_pO2u margin-bottom--md">近期文章</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/10/weekly/2025/weekly-review-ep2025w32>「每周回顾」EP2025W32：GPT-5 发布、Gemini 新功能、gpt-oss 开源及多项开发者工具更新</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/03/weekly/2025/weekly-review-ep2025w31>「每周回顾」EP2025W31：Node.js 新版本、Figma 成功上市、GLM-4.5 开源等</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/27/weekly/2025/weekly-review-ep2025w30>「每周回顾」EP2025W30：GitHub Spark、React 编译器与千问 Qwen3 Coder</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/20/weekly/2025/weekly-review-ep2025w29>「每周回顾」EP2025W29：AI 工具进展与 WebAssembly 的十年</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/13/weekly/2025/weekly-review-ep2025w28>「每周回顾」EP2025W28：Grok 4 发布与 AI 企业服务转型</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/06/weekly/2025/weekly-review-ep2025w27>「每周回顾」EP2025W27：GitHub Copilot Chat 开源</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/29/weekly/2025/weekly-review-ep2025w26>「每周回顾」EP2025W26：ECMAScript 2025 正式发布，AI 代理与前端工具持续演进</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/22/weekly/2025/weekly-review-ep2025w25>「每周回顾」EP2025W25：AI 编程趋势、React 发展与 AI 代理安全</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/15/weekly/2025/weekly-review-ep2025w24>「每周回顾」EP2025W24：React 服务器组件中导入的工作原理</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/08/weekly/2025/weekly-review-ep2025w23>「每周回顾」EP2025W23：探索 Claude 4 系统提示与渐进式 JSON</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>探索 Docusaurus 的路由实现</h1><div class="container_mt6G margin-vert--md"><time datetime=2022-11-15T00:47:00.000Z>2022年11月15日</time> · <!-- -->阅读需 10 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/img/authors/wang1212.png alt=不如怀念></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer"><span class=authorName_yefp>不如怀念</span></a></div><small class=authorTitle_nd0D title="Web 前端工程师 (Web Front-end Engineer)">Web 前端工程师 (Web Front-end Engineer)</small><div class=authorSocials_rSDt><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=GitHub><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 256 250" preserveAspectRatio=xMidYMid style=--dark:#000;--light:#fff class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"/></svg></a></div></div></div></div></div></header><blockquote>最后更新于 <!-- -->2022-11-15 00:47:00</blockquote><div id=__blog-post-container class=markdown><p>大概早在一年前就了解到 Meta(Facebook) 发布的一款专门用来构建文档站点的 <a href=https://docusaurus.io/ target=_blank rel="noopener noreferrer">Docusaurus</a> 工具库，那时候 Docusaurus 就已在社区中受欢迎起来，随着这一年多来看到很多开源项目的文档站点都基于 Docusaurus 构建，便下定决定要找机会尝试一下。于是，前不久在团队内对基建做改进时，对于文档这一块的迭代了解了很多热门的社区方案，一直举棋不定，在某天闲下来时就准备基于 Docusaurus 做一个尝试，最终发现效果还不错，而且迁移起来也几乎没有什么成本。</p>
<p>基于对 Docusaurus 这次尝试留下的好印象，便顺带深入了解了一下，发现还支持博客站点，而且功能很丰富，最吸引人的便是可以借助插件构建本地的离线全站搜索功能。说干就干，找了个周末就把自己的博客站点完全迁移到基于 Docusaurus 构建的站点了。当然，迁移过程是挺顺利的，而且也并没有想象中的麻烦，只是以前的博客页面都是自己写的，而现在基于 Docusaurus 的博客页面是开箱即用的主题，尤其是归档页面并不太符合期望，准备自己重新实现归档页面。经过<a href=https://docusaurus.io/docs/swizzling target=_blank rel="noopener noreferrer">查看文档</a>，发现 Docusaurus 确实提供了重写归档页面的机制。不过，在重写之前，我心里突然发出一个疑问：我只能在已有的路由下（<code>/archive</code>）重写页面吗？博客的数据解析后是如何存储并传递给页面组件的呢？为了一探究竟，我便带着这些问题对 Docusaurus 的路由机制做了简单的探索，总算是了解了 Docusaurus 是如何以巧妙的方式做到这些事情的。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=如何重写页面>如何重写页面<a href=#如何重写页面 class=hash-link aria-label=如何重写页面的直接链接 title=如何重写页面的直接链接>​</a></h2>
<p>根据 Docusaurus 官方的文档描述，首先对于重写页面的场景做了简单的分类，第一类便是<a href=https://docusaurus.io/docs/styling-layout target=_blank rel="noopener noreferrer">样式重写</a>，此类场景只需要覆盖 CSS 样式即可；而另一类场景，以更细粒度的方式调整页面结构，也就是 Docusaurus 提供的 <a href=https://docusaurus.io/docs/swizzling target=_blank rel="noopener noreferrer"><strong>Swizzling</strong></a> 机制。对于调整页面结构，Docusaurus 又提供了两套方案 <a href=https://docusaurus.io/docs/swizzling#ejecting target=_blank rel="noopener noreferrer"><strong>Ejecting</strong></a> 和 <a href=https://docusaurus.io/docs/swizzling#wrapping target=_blank rel="noopener noreferrer"><strong>Wrapping</strong></a>，根据官方推荐来看，后者要比前者更安全一些，随即选了后者，但后面因为完全重写了整个博客的归档页面，所以实际上干了前者所对应的事情。</p>
<p><strong>Wrapping</strong> 方案简单的来说就是对原有的 <code>BlogArchivePage</code> 组件做一层包装，即实现 <code>BlogArchivePageWrapper</code> 组件，用代码来表达的话如下：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>BlogArchivePageWrapper</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">props</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token punctuation" style=color:#393A34>{</span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/** TODO something */</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">BlogArchivePage </span><span class="token punctuation" style=color:#393A34>{</span><span class="token operator" style=color:#393A34>...</span><span class="token plain">props</span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token operator" style=color:#393A34>/</span><span class="token operator" style=color:#393A34>></span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>为了重写博客的归档页面，必然得了解 <code>props</code> 的数据结构。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=页面的数据从何而来>页面的数据从何而来<a href=#页面的数据从何而来 class=hash-link aria-label=页面的数据从何而来的直接链接 title=页面的数据从何而来的直接链接>​</a></h2>
<p>随即打开 Chrome 的开发工具，利用 React 的调试插件查看了页面组件树，了解了 <code>BlogArchivePageWrapper</code> 组件所接收的 <code>props</code> 数据结构。如下图所示：</p>
<p><img decoding=async loading=lazy alt=Snipaste_2022-11-15_01-29-33.png src=/assets/images/Snipaste_2022-11-15_01-29-33-5440fb0d000703c5cad37a93d13d9d74.png width=1069 height=390 class=img_ev3q></p>
<p>此时，我便产生了刚开始提到的一些疑问：页面的数据从何而来？是否有 API 可以获取？如果我想利用博客的数据构建一个自定义路由下的页面是否有可能呢？</p>
<p>带着这些问题我仔细查看了官方的文档，然而一无所获。当然，这便引起了我的兴趣，我决定通过探索 Docusaurus 源码的方式搞清楚这些问题。通过快速的阅读源码，大致了解了其机制和原理，觉得非常有意思和有技巧性，决定记录下来。（事实证明，由于没有仔细看官方的架构设计文档，花费了很多不必要的时间。）</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=创建路由>创建路由<a href=#创建路由 class=hash-link aria-label=创建路由的直接链接 title=创建路由的直接链接>​</a></h3>
<p>第一步，便是通过分析得到的数据结构关键字 <code>archive</code> 做一个源码的全局搜索，便找到了 <strong>@docusaurus/plugin-content-blog</strong> 包的源码实现部分。其关键代码如下：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_OeMC>https://github.com/facebook/docusaurus/blob/v2.2.0/packages/docusaurus-plugin-content-blog/src/index.ts#L229</div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>contentLoaded</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">content</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> blogContents</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> actions</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>addRoute</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    path</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> archiveUrl</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    component</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> blogArchiveComponent</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    exact</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token boolean" style=color:#36acaa>true</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    modules</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">      archive</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>aliasedSource</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">archiveProp</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>根据源码可以看出，通过 <code>addRoute()</code> API 创建了一个路由（即默认的 <code>/archive</code>），并将解析好的博客归档数据 <code>archive</code> 作为参数传入。这个时候，如果及时查看一下<a href=https://docusaurus.io/docs/api/plugin-methods/lifecycle-apis#addRoute target=_blank rel="noopener noreferrer">官方插件文档</a> 理解起来要容易很多，当然跟踪上游的代码实现也是可以的，毕竟源码是绝对可信的。</p>
<p>在看源码之前，仔细看看官方的<a href=https://docusaurus.io/docs/advanced/architecture target=_blank rel="noopener noreferrer">架构文档</a>和<a href=https://docusaurus.io/docs/advanced/routing target=_blank rel="noopener noreferrer">路由文档</a>对于源码的理解要更深一些。关键源码如下：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_OeMC>https://github.com/facebook/docusaurus/blob/v2.2.0/packages/docusaurus/src/server/plugins/index.ts#L119</div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token function" style=color:#d73a49>addRoute</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">initialRouteConfig</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// Trailing slash behavior is handled generically for all plugins</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> finalRouteConfig </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>applyRouteTrailingSlash</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    initialRouteConfig</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    context</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">siteConfig</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  pluginsRouteConfigs</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>push</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token operator" style=color:#393A34>...</span><span class="token plain">finalRouteConfig</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    context</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token operator" style=color:#393A34>...</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">finalRouteConfig</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">context </span><span class="token operator" style=color:#393A34>&&</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain">data</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> finalRouteConfig</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      plugin</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> pluginRouteContextModulePath</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><br></span></code></pre></div></div>
<p>单纯看这段源码的话，并不能明白 <code>addRoute()</code> API 具体做了什么事情，不过架构文档中对于该 API 有一段描述，一个重点则是 <strong>“插件代码和主题代码不直接相互导入，而是通过 JSON 临时文件和调用 <code>addRoute</code>”</strong>。另一方面，可以注意到以上关键代码位于 <em>server/</em> 目录下，而 Docusaurus 是 Server-Client 架构。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=页面是如何加载数据的>页面是如何加载数据的<a href=#页面是如何加载数据的 class=hash-link aria-label=页面是如何加载数据的的直接链接 title=页面是如何加载数据的的直接链接>​</a></h3>
<p>经过以上分析，我们知道博客插件将解析好的博客归档数据 <code>archive</code> 通过 <code>addRoute()</code> API 注册路由时绑定了起来，那么页面加载 <code>/archive</code> 路由时如何获取这份数据是非常关键的。最简单的方式就是查看开发工具的请求信息，当然确实发出了一个<strong>js 文件</strong>请求，如下图所示：</p>
<p><img decoding=async loading=lazy alt=Snipaste_2022-11-15_02-14-57.png src=/assets/images/Snipaste_2022-11-15_02-14-57-0902059e4a4b8d9b4b20473aa2508f50.png width=968 height=468 class=img_ev3q></p>
<p>根据该 JS 文件的源码来看，实际上是一个包含了博客归档 JSON 数据的 webpack 构建的模块。联想到之前架构文档中提到的 JSON 数据通信，再去看一下官方的<a href=https://docusaurus.io/docs/advanced/plugins target=_blank rel="noopener noreferrer">插件文档</a> 发现提供了一个很有用的 <strong>debug plugin's metadata panel</strong> 调试面板，然后再看看项目根目录的 <em>.docusaurus</em> 文件夹，很容易就找到了 <em>.docusaurus/docusaurus-plugin-content-blog/default/archive-3ef.json</em> 文件，而这正是博客归档数据，也是以上 JS 模块所包含的 JSON 数据。而该 JSON 文件又是何时生成的呢？</p>
<p>回过头来看，在分析 <code>addRoute()</code> 源码的时候忽略了其上几行的 <code>createData()</code> API 的关键代码：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_OeMC>https://github.com/facebook/docusaurus/blob/v2.2.0/packages/docusaurus-plugin-content-blog/src/index.ts#L220</div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// Create a blog archive route</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> archiveProp </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>await</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>createData</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation function" style=color:#d73a49>docuHash</span><span class="token template-string interpolation punctuation" style=color:#393A34>(</span><span class="token template-string interpolation">archiveUrl</span><span class="token template-string interpolation punctuation" style=color:#393A34>)</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string string" style=color:#e3116c>.json</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token constant" style=color:#36acaa>JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>stringify</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> blogPosts </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>至此，已经清楚的知道插件在通过 <code>addRoute()</code> 添加路由时，就调用 <code>createData()</code> API 生成了相关的 JSON 数据临时文件，以备后续客户端代码通信。</p>
<p>根据之前留意的一个细节，<code>addRoute</code> 的源码在 <em>server/</em>，现在来看看 <em>client/</em> 目录便可知晓客户端页面是如何加载数据的。在此之前，先通过开发工具的 React 调试插件看看该数据到底是从哪个父组件获取并注入 <code>BlogArchivePageWrapper</code> 组件的。结果如下：</p>
<p><img decoding=async loading=lazy alt=Snipaste_2022-11-15_02-37-14.png src=/assets/images/Snipaste_2022-11-15_02-37-14-4fd02c4b397413c9764dd4d18743cb40.png width=760 height=512 class=img_ev3q></p>
<p>如图中所示，实际上是 <code>LoadableComponent</code> 完成了数据获取，并将其注入到子组件中。这一看似乎是 <a href=https://github.com/jamiebuilds/react-loadable target=_blank rel="noopener noreferrer">react-loadable</a> 的代码，经过查看源码确实如此，不过让我感到疑惑的是，曾经用过 react-loadable 却不知道其还有加载（请求）数据的功能？实际上，Docusaurus 利用了其<a href=https://github.com/jamiebuilds/react-loadable#optsrender target=_blank rel="noopener noreferrer">自定义渲染的 API</a> 来巧妙的完成了页面加载时数据请求的任务。关键代码如下：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_OeMC>https://github.com/facebook/docusaurus/blob/v2.2.0/packages/docusaurus/src/client/exports/ComponentCreator.tsx#L75</div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token function" style=color:#d73a49>render</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  loaded</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">keyPath</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">exportedName</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  props</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// `loaded` will be a map from key path (as returned from the flattened</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// chunk names) to the modules loaded from the loaders. We now have to</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// restore the chunk names' previous shape from this flat record.</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// We do so by taking advantage of the existing `chunkNames` and replacing</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// each chunk name with its loaded module, so we don't create another</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// object from scratch.</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> loadedModules </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token constant" style=color:#36acaa>JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>parse</span><span class="token punctuation" style=color:#393A34>(</span><span class="token constant" style=color:#36acaa>JSON</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>stringify</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">chunkNames</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>as</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    __comp</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> React</span><span class="token punctuation" style=color:#393A34>.</span><span class="token plain">ComponentType</span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain">object</span><span class="token operator" style=color:#393A34>></span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    __context</span><span class="token operator" style=color:#393A34>?</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> RouteContext</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>[</span><span class="token plain">propName</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>]</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">unknown</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>这段代码中，<code>chunkNames</code> 实际上就是请求的 JS 模块加载后注入到全局的数据信息（参考 Webpack 模块机制）。现在，我们明白了客户端页面是如何完成数据加载工作的，但还有一个问题还未解决，我们了解了 JSON 数据临时文件何时生成的，JS 模块是何时加载数据的，但唯独中间过程，即是如何利用 JSON 数据临时文件生成该 JS 模块文件的目前还不得而知？</p>
<p>实际上，这个问题随着追溯上面代码的上下文 <code>ComponentCreator</code> 方法的引用就立刻明白了。于是，又回到了服务端代码 <em>server/routes.ts</em> 中，这是路由的核心实现。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockTitle_OeMC>https://github.com/facebook/docusaurus/blob/v2.2.0/packages/docusaurus/src/server/routes.ts#L246</div><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * This is the higher level overview of route code generation. For each route</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * config node, it returns the node's serialized form, and mutates `registry`,</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * `routesPaths`, and `routesChunkNames` accordingly.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>genRouteCode</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">routeConfig</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> RouteConfig</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> res</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> LoadedRoutes</span><span class="token punctuation" style=color:#393A34>)</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token doc-comment comment" style=color:#999988;font-style:italic>/**</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * Routes are prepared into three temp files:</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> *</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * - `routesConfig`, the route config passed to react-router. This file is kept</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * minimal, because it can't be code-splitted.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * - `routesChunkNames`, a mapping from route paths (hashed) to code-splitted</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * chunk names.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> * - `registry`, a mapping from chunk names to options for react-loadable.</span><br></span><span class=token-line style=color:#393A34><span class="token doc-comment comment" style=color:#999988;font-style:italic> */</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>export</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>loadRoutes</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  routeConfigs</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> RouteConfig</span><span class="token punctuation" style=color:#393A34>[</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  baseUrl</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token builtin">string</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  onDuplicateRoutes</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> ReportingSeverity</span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>以上不再细说，代码和注释已经非常的清晰了。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=结语>结语<a href=#结语 class=hash-link aria-label=结语的直接链接 title=结语的直接链接>​</a></h2>
<p>最终，由于在重写博客归档页面中引起的一些疑问简单探索了 Docusaurus 路由机制的实现原理，了解了从数据解析到路由创建，再到页面加载完成数据请求并渲染页面内容的整个过程。从这个分析过程中，可以看到 Docusaurus 实现静态文档站点工具库所使用的一些技术和技巧，也许可以在解决某些问题时受到启发。</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/计算机技术>计算机技术</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/工具>工具</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/docusaurus>Docusaurus</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/tools/tools-docusaurus/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=博文分页导航><a class="pagination-nav__link pagination-nav__link--prev" href=/computer-technology/3d/web-3d-practical-case-2><div class=pagination-nav__sublabel>较新一篇</div><div class=pagination-nav__label>Web 3D 开发实践：计算物体在 2D 平面上的像素尺寸</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/2022/11/01/computer-technology/web-frontend/echarts-zrender/zrender-event-system><div class=pagination-nav__sublabel>较旧一篇</div><div class=pagination-nav__label>解析 ZRender 设计：事件系统</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#如何重写页面 class="table-of-contents__link toc-highlight">如何重写页面</a><li><a href=#页面的数据从何而来 class="table-of-contents__link toc-highlight">页面的数据从何而来</a><ul><li><a href=#创建路由 class="table-of-contents__link toc-highlight">创建路由</a><li><a href=#页面是如何加载数据的 class="table-of-contents__link toc-highlight">页面是如何加载数据的</a></ul><li><a href=#结语 class="table-of-contents__link toc-highlight">结语</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>关于我</div><ul class="footer__items clean-list"><li class=footer__item><a href=mailto:mrwang1212@126.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gitee.com/i_wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>Gitee<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>更多</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class=footer__link-item>Awesome Favorites List<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/the-book-of-ruby target=_blank rel="noopener noreferrer" class=footer__link-item>The Book Of Ruby (ZH)<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/echarts-api-docs target=_blank rel="noopener noreferrer" class=footer__link-item>Apache ECharts APIs Guide<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 My Blog. Built with Docusaurus.</div></div></div></footer></div>