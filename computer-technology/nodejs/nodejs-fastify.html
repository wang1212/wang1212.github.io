<!doctype html><html lang=zh-Hans dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>Fastify - 专注于性能和低内存消耗 | 不如怀念</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="Fastify - 专注于性能和低内存消耗 | 不如怀念"><meta data-rh=true name=description content="Fastify 作为一个 Node.js Web 框架，是如何实现高性能和低内存消耗的呢？"><meta data-rh=true property=og:description content="Fastify 作为一个 Node.js Web 框架，是如何实现高性能和低内存消耗的呢？"><meta data-rh=true name=keywords content="计算机技术,Web,Web 后端,Node.js,JavaScript,Fastify"><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2021-06-27T16:28:00.000Z><meta data-rh=true property=article:author content=https://github.com/wang1212><meta data-rh=true property=article:tag content="计算机技术,Web,Web 后端,Node.js,JavaScript,Fastify"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify hreflang=zh-Hans><link data-rh=true rel=alternate href=https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify","@type":"BlogPosting","author":{"@type":"Person","description":"Web 前端工程师 (Web Front-end Engineer)","email":"mrwang1212@126.com","image":"/img/authors/wang1212.png","name":"不如怀念","url":"https://github.com/wang1212"},"datePublished":"2021-06-27T16:28:00.000Z","description":"Fastify 作为一个 Node.js Web 框架，是如何实现高性能和低内存消耗的呢？","headline":"Fastify - 专注于性能和低内存消耗","isPartOf":{"@id":"https://wang1212.github.io/","@type":"Blog","name":"Blog"},"keywords":["计算机技术","Web","Web 后端","Node.js","JavaScript","Fastify"],"mainEntityOfPage":"https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify","name":"Fastify - 专注于性能和低内存消耗","url":"https://wang1212.github.io/computer-technology/nodejs/nodejs-fastify"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="不如怀念 RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="不如怀念 Atom Feed"><link rel=stylesheet href=/assets/css/styles.9a43e9e5.css><script src=/assets/js/runtime~main.1c281f95.js defer></script><script src=/assets/js/main.270fc577.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/authors/wang1212.png><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">不如怀念</b></a><a class="navbar__item navbar__link" href=/archive>归档</a><a class="navbar__item navbar__link" href=/timeline>历程</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">精选资源<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=搜索 aria-label=Search class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label=最近博文导航><div class="sidebarItemTitle_pO2u margin-bottom--md">近期文章</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/09/07/weekly/2025/weekly-review-ep2025w36>「每周回顾」EP2025W36：Atlassian 收购 AI 浏览器开发商</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/31/weekly/2025/weekly-review-ep2025w35>「每周回顾」EP2025W35：Zed 集成 Gemini CLI、Claude Chrome 扩展测试及 AI 图像模型新进展</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/24/weekly/2025/weekly-review-ep2025w34>「每周回顾」EP2025W34：Google 系列产品更新，阿里开源图像模型</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/17/weekly/2025/weekly-review-ep2025w33>「每周回顾」EP2025W33：GitHub 并入微软、Cursor 调整收费、Google 推出 Gemma 3</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/10/weekly/2025/weekly-review-ep2025w32>「每周回顾」EP2025W32：GPT-5 发布、Gemini 新功能、gpt-oss 开源及多项开发者工具更新</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/03/weekly/2025/weekly-review-ep2025w31>「每周回顾」EP2025W31：Node.js 新版本、Figma 成功上市、GLM-4.5 开源等</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/27/weekly/2025/weekly-review-ep2025w30>「每周回顾」EP2025W30：GitHub Spark、React 编译器与千问 Qwen3 Coder</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/20/weekly/2025/weekly-review-ep2025w29>「每周回顾」EP2025W29：AI 工具进展与 WebAssembly 的十年</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/13/weekly/2025/weekly-review-ep2025w28>「每周回顾」EP2025W28：Grok 4 发布与 AI 企业服务转型</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/06/weekly/2025/weekly-review-ep2025w27>「每周回顾」EP2025W27：GitHub Copilot Chat 开源</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>Fastify - 专注于性能和低内存消耗</h1><div class="container_mt6G margin-vert--md"><time datetime=2021-06-27T16:28:00.000Z>2021年6月27日</time> · <!-- -->阅读需 18 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/img/authors/wang1212.png alt=不如怀念></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer"><span class=authorName_yefp>不如怀念</span></a></div><small class=authorTitle_nd0D title="Web 前端工程师 (Web Front-end Engineer)">Web 前端工程师 (Web Front-end Engineer)</small><div class=authorSocials_rSDt><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=GitHub><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 256 250" preserveAspectRatio=xMidYMid style=--dark:#000;--light:#fff class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"/></svg></a><a href=https://x.com/wang1212x target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=X><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em fill=none viewBox="0 0 1200 1227" style=--dark:#000;--light:#fff class="authorSocialLink_owbf xSvg_y3PF"><path d="M714.163 519.284 1160.89 0h-105.86L667.137 450.887 357.328 0H0l468.492 681.821L0 1226.37h105.866l409.625-476.152 327.181 476.152H1200L714.137 519.284h.026ZM569.165 687.828l-47.468-67.894-377.686-540.24h162.604l304.797 435.991 47.468 67.894 396.2 566.721H892.476L569.165 687.854v-.026Z"/></svg></a><a href=https://www.reddit.com/user/Warm_Salt_2251 target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=reddit><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class=authorSocialLink_owbf><path stroke=none d="M0 0h24v24H0z" fill=none /><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"/><path d="M3.6 9h16.8"/><path d="M3.6 15h16.8"/><path d="M11.5 3a17 17 0 0 0 0 18"/><path d="M12.5 3a17 17 0 0 1 0 18"/></svg></a><a href=https://www.xiaohongshu.com/user/profile/5e4130cb00000000010023fd target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=rednote><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 24 24" fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=round class=authorSocialLink_owbf><path stroke=none d="M0 0h24v24H0z" fill=none /><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0"/><path d="M3.6 9h16.8"/><path d="M3.6 15h16.8"/><path d="M11.5 3a17 17 0 0 0 0 18"/><path d="M12.5 3a17 17 0 0 1 0 18"/></svg></a></div></div></div></div></div></header><blockquote>最后更新于 <!-- -->2021-07-04 21:56:00</blockquote><div id=__blog-post-container class=markdown><p>最近在做 Node.js 技术相关的调研，需要选定一个 Web 框架作为基础来构建业务。一般来说，首选开源方案，对于我来说，比较关注框架背后的开发团队情况、项目活跃度、是否有足够多的商业案例、文档是否完整可读、框架的设计理念、技术架构是否灵活可扩展、技术社区生态是否完整等方面。目前，我比较倾心的是 Fastify 这个新兴框架，根据官网介绍，其专注于高性能和低消耗，并且公开的基准测试表现相当不错，项目足够活跃，更重要的是属于 OpenJS 基金会的孵化项目。本文主要介绍 Fastify 的设计理念和探究其是如何提高性能和降低内存消耗的。</p>
<blockquote>
<p>Fastify 官网：<a href=https://www.fastify.io/ target=_blank rel="noopener noreferrer">https://www.fastify.io/</a></p>
</blockquote>
<p>Fastify v1.0.0 发布是在 2018 年的 3 月份，相比于业内广为熟知的 Express / Koa 等框架还很年轻，其项目发起者和核心维护者之一 Matteo Collina 也在开源社区很有声望，是 Node.js TSC 成员，目前 Fastify 项目已经加入 OpenJS 基金会。</p>
<blockquote>
<p><a href=https://medium.com/the-node-js-collection/fastify-goes-lts-with-1-0-0-911112c64752 target=_blank rel="noopener noreferrer">Fastify 到达 1.0.0 LTS！</a></p>
</blockquote>
<blockquote>
<p><a href=https://openjsf.org/blog/2019/11/20/web-framework-fastify-joins-openjs-foundation-as-an-incubating-project/ target=_blank rel="noopener noreferrer">Fastify 作为孵化项目加入 OpenJS 基金会</a></p>
</blockquote>
<blockquote>
<p><a href=https://openjsf.org/blog/2020/08/27/fastify-graduation-performance-and-the-future/ target=_blank rel="noopener noreferrer">Fastify：毕业、性能和未来</a></p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=设计理念>设计理念<a href=#设计理念 class=hash-link aria-label=设计理念的直接链接 title=设计理念的直接链接>​</a></h2>
<p>一般来说，一个开源项目会在文档中阐述自己的设计理念和技术架构等理论层面的思考，以帮助开发者更快的了解项目的核心思想和目标人群，或者说解决的关键性问题。官网首页首先给出了标题为 Why 的一段话，然后列举了核心功能点（Core features），文档中没有找到具体阐述设计理念之类的东西。不过，在看了官方博客文章以及相关的资料之后，Fastify 的设计理念大体可以总结：</p>
<ul>
<li>高性能</li>
<li>灵活可扩展</li>
<li>开发人员友好（例如内置日志系统、TS 支持等等）</li>
</ul>
<p>纵观众多 Node.js Web 开源框架，大多都做到了后两点，例如 Express 项目利用中间件提供了足够的灵活性，内置了开箱即用的功能；而 Koa 为了改进开发人员的体验，引入 <code>async/await</code> 替代回调函数，以及所谓的 “洋葱模型” 提供了更高的灵活性，精简了框架核心，只提供必要的功能，从而有了比 Express 更好的性能。而 Fastify 除此之外，对性能有极致的追求，同时也提出了很多不一样的思想，值得学习。</p>
<p>其实，Web 开发框架还有一个较为严峻的问题就是项目的工程化标准，最著名的就是 MVC 模型，而对应的也有解决此类问题的 Node.js 框架，近年来发展前景比较好的应该就是 nest.js 了。</p>
<blockquote>
<p><a href=https://thenewstack.io/introducing-fastify-speedy-node-js-web-framework/ target=_blank rel="noopener noreferrer">Introducing Fastify, a Speedy Node.js Web Framework</a></p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=fastify-的实现细节>Fastify 的实现细节<a href=#fastify-的实现细节 class=hash-link aria-label="Fastify 的实现细节的直接链接" title="Fastify 的实现细节的直接链接">​</a></h2>
<p>了解了 Fastify 的设计理念之后，接下来要看看开发团队是如何实施的，探索其技术细节。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=json-序列化>JSON 序列化<a href=#json-序列化 class=hash-link aria-label="JSON 序列化的直接链接" title="JSON 序列化的直接链接">​</a></h3>
<p>Fastify 项目的历史故事背后是 <code>fast-json-stringify</code> 模块的诞生，该模块比 <code>JSON.stringify()</code> 这种原生 JavaScript 方法快很多，可以达到 2 到 3 倍的性能优势。其背后的原理主要是 <strong>依赖 JSON Schema 对 JSON 数据进行校验，避免了类型判断的过程，从而提高了性能</strong>。根据其公开的基准测试，其优势主要体现在处理的目标数据为复杂对象时，可以达到 4 倍的性能优势。</p>
<blockquote>
<p><a href=https://github.com/fastify/fast-json-stringify target=_blank rel="noopener noreferrer">GitHub: <code>fast-json-stringify</code></a></p>
</blockquote>
<blockquote>
<p><a href=https://json-schema.org/ target=_blank rel="noopener noreferrer">JSON Schema</a></p>
</blockquote>
<p>其中有两个细节我们值得注意。第一个便是项目 <em>README.md</em> 文件中提到的安全方面需要注意的问题，是由于 <strong>在初始化时利用 <code>Function</code> 构造函数预编译了函数体，以此达到优化性能的目的</strong>。</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">result </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name builtin">Function</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'schema'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> code</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">root</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>而这个原理其实也是比较好理解的，通过把一个函数体内包含循环迭代的代码预先“编译”成字符串再交给函数来执行，在函数的“运行时”就不需要再做额外的“解释翻译”以及迭代工作，从而提高性能。下面有一篇相关的比较有趣的文章可以看看：</p>
<blockquote>
<p><a href=https://github.com/felixge/faster-than-c target=_blank rel="noopener noreferrer">Faster than C? Parsing binary data in JavaScript.</a></p>
</blockquote>
<p>我们也可以通过以下示例代码来进行简单的测试：</p>
<div class="language-typescript codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-typescript codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>a</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>for</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>let</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>&lt;</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>3</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> i</span><span class="token operator" style=color:#393A34>++</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>log</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">i</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> code </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>[</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>]</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>map</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">i</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token template-string string" style=color:#e3116c>console.log(</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>${</span><span class="token template-string interpolation">i</span><span class="token template-string interpolation interpolation-punctuation punctuation" style=color:#393A34>}</span><span class="token template-string string" style=color:#e3116c>)</span><span class="token template-string template-punctuation string" style=color:#e3116c>`</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// 函数体预编译后 b 等价于</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// function b() {</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//   console.log(0);</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//   console.log(1);</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>//   console.log(2);</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// }</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> b </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name builtin">Function</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">code</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>time</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'a'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>a</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>timeEnd</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'a'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// a: 0.136962890625 ms</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>time</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'b'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token function" style=color:#d73a49>b</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token builtin">console</span><span class="token punctuation" style=color:#393A34>.</span><span class="token function" style=color:#d73a49>timeEnd</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'b'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"> </span><span class="token comment" style=color:#999988;font-style:italic>// b: 0.05908203125 ms</span><br></span></code></pre></div></div>
<p>第二个细节便是 <em>README.md</em> 文件中有提到可以和 <code>flatstr</code> 模块很好的配合使用，因为该模块会触发 V8 的优化机制，把字符串最终转换成了 <code>Buffer</code>。 其项目的 <em>README.md</em> 文件中 <strong>How does it work</strong> 段落详细解释了底层机制，简单的来说，V8 会在某些情况下针对 <code>String</code> 数据做特定优化，而该模块的主要作用就是主动去触发这种 V8 的优化机制以达到提高性能的目的。</p>
<blockquote>
<p><a href=https://github.com/davidmarkclements/flatstr target=_blank rel="noopener noreferrer">GitHub: <code>flatstr</code></a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=路由routing>路由（Routing）<a href=#路由routing class=hash-link aria-label=路由（Routing）的直接链接 title=路由（Routing）的直接链接>​</a></h3>
<p>Fastify 的路由是依赖 <code>find-my-way</code> 模块实现的，在公开的基准测试中相比于 <code>express</code> 和 <code>koa-router</code> 有数倍的性能优势。</p>
<p>根据 <code>find-my-way</code> 模块的 <em>README.md</em> 文件中所介绍，其 <strong>底层采用了基数树（Radix tree，亦称 compact prefix tree）的数据结构，并非通常的路由数组和迭代正则匹配方案</strong>。基数树是一种空间优化的前缀树（即紧凑前缀树），具有前缀树的搜索性能同时尽可能小的占用内存。前缀树的应用场景比较常见，常用于字符串检索，例如字典查找、字符统计、公共前缀匹配等等，要比遍历数组和正则匹配的查找性能好数倍。但前缀树的内存消耗比较大，所以通过将只有一个子节点的与其父节点合并从而减少内存消耗，形成了“基数树”数据结构。</p>
<blockquote>
<p><a href=https://github.com/delvedor/find-my-way target=_blank rel="noopener noreferrer">GitHub: <code>find-my-way</code></a></p>
</blockquote>
<blockquote>
<p><a href=https://en.wikipedia.org/wiki/Radix_tree target=_blank rel="noopener noreferrer">Radix tree</a></p>
</blockquote>
<p>Koa 的官方路由 <code>@koa/router</code> 从源码中可以看到，是将每个路由的路径 <code>path</code> 转换成正则表达式存储在数组中，此后遍历该数组通过正则匹配来完成路由映射，这种方案实现起来相对简单，但性能要低得多。不过也有一个同样基于基数树结构实现的 <code>koa-tree-router</code> 模块，性能比前者高数倍，当然它的功能还是相当简单的。Express 的官方路由实现也大致相同，<code>@koa/router</code> 应该是参考了前者的实现。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=闭包closure>闭包（Closure）<a href=#闭包closure class=hash-link aria-label=闭包（Closure）的直接链接 title=闭包（Closure）的直接链接>​</a></h3>
<p>闭包是 JavaScript 一个很有用的语言特性，利用它可以实现很多东西，最常见的则是模块封装了，在没有类（Class）概念的情况下，要实现类似类的效果必然会用到闭包，很多第三方库就是这样做的，例如著名的 <code>jQuery</code>。但另一方面需要注意的是，闭包极易引起内存泄漏，同时造成不必要的内存消耗；而且，在闭包中如果嵌套太深，作用域递归解析也会有一定的开销。</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>process</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">bigData</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> cb</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>remoteCall</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">bigData</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> something</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>storeSomething</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">something</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> res</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 该函数是暂时的，但是难以被优化</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// bigData 一直驻留在作用域中，无法被 GC</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token function" style=color:#d73a49>cb</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> res </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// -------</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>process</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">bigData</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> cb</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>remoteCall</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">bigData</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> something</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// bigData 在这里退出了作用域，可以被 GC</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>callStoreSomething</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">something</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> cb</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>callStoreSomething</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">something</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> cb</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// 该函数可以被优化</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token function" style=color:#d73a49>storeSomething</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">something</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> res</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token function" style=color:#d73a49>cb</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> res </span><span class="token operator" style=color:#393A34>*</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>2</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>基于此，<strong>Fastify 团队在框架内部基本上杜绝了利用闭包实现功能，从而保证了低内存消耗</strong>。</p>
<blockquote>
<p><a href=https://akaphenom.medium.com/javascript-closures-and-the-call-stack-722ef2c3b5a8 target=_blank rel="noopener noreferrer">JavaScript: Closures and the Call Stack</a></p>
</blockquote>
<blockquote>
<p><a href=https://en.wikipedia.org/wiki/Scope_(computer_science) target=_blank rel="noopener noreferrer">Scope</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=调用栈call-stack>调用栈（Call stack）<a href=#调用栈call-stack class=hash-link aria-label="调用栈（Call stack）的直接链接" title="调用栈（Call stack）的直接链接">​</a></h3>
<p>Fastify 内部优化之后，调用栈也小很多，作者利用 <code>0x</code> 工具进行了分析，从生成的栈火焰图来看，Express 的图形中有两个高峰，说明调用栈特别大；相对的，Fastify 的图形总体较为平缓。<strong>更小的调用栈也降低了内存消耗</strong>，详细信息可以在下面的视频讲解中查看。</p>
<blockquote>
<p><a href="https://www.youtube.com/watch?v=5z46jJZNe8k" target=_blank rel="noopener noreferrer">Take your http server to ludicrous speed</a></p>
</blockquote>
<blockquote>
<p><a href=https://github.com/davidmarkclements/0x target=_blank rel="noopener noreferrer">GitHub: <code>0x</code></a></p>
</blockquote>
<blockquote>
<p><a href=https://en.wikipedia.org/wiki/Call_stack target=_blank rel="noopener noreferrer">Call stack</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=服务器的生命周期server-lifecycle>服务器的生命周期（Server Lifecycle）<a href=#服务器的生命周期server-lifecycle class=hash-link aria-label="服务器的生命周期（Server Lifecycle）的直接链接" title="服务器的生命周期（Server Lifecycle）的直接链接">​</a></h3>
<p>大多数 Web 框架的生命周期是相似的：服务器启动，路由处理程序注册，服务器侦听请求并调用适当的函数来处理它们。如下图所示，Fastify 做了特殊处理，在服务器启动之后执行预初始化阶段（preinitialisation ），该阶段做了一些优化工作，使用 <code>fast-json-stringify</code> 模块处理 JSON schemas，以及用 <code>reusify</code> 模块优化处理函数（handler functions）。</p>
<p><img decoding=async loading=lazy alt=diagram_fastify_lifecycle src=/assets/images/diagram_fastify_lifecycle-d75addf33e1030640c1d408734889820.png width=767 height=525 class=img_ev3q></p>
<p>这里提及的 <code>reusify</code> 模块是如何来优化处理函数的呢？首先，请求的处理函数属于频繁被执行的代码块，也就是所谓的"热代码路径（hot code paths）"。<code>reusify</code> 的源码非常简单，主要作用是 <strong>将对象或者函数进行缓存，降低高并发场景下热代码路径上的 GC 压力</strong>。</p>
<blockquote>
<p><a href=https://www.nearform.com/blog/reaching-ludicrous-speed-with-fastify/ target=_blank rel="noopener noreferrer">Reaching Ludicrous Speed with Fastify</a></p>
<p><a href=https://github.com/mcollina/reusify target=_blank rel="noopener noreferrer">GitHub: <code>reusify</code></a></p>
<p><a href=https://stackoverflow.com/questions/22894877/avoid-allocations-in-compiler-hot-paths-roslyn-coding-conventions target=_blank rel="noopener noreferrer">Avoid allocations in compiler hot paths” Roslyn Coding Conventions</a></p>
</blockquote>
<p>不过，在 <code>reusify</code> 模块给出的示例代码中有一个细节值得注意：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function maybe-class-name" style=color:#d73a49>MyObject</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// you need to define this property</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// so V8 can compile MyObject into an</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// hidden class</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword" style=color:#00009f>this</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">next</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><br></span></code></pre></div></div>
<p>作者注释到你要重用的对象内部第一个属性应该定义为 <code>next</code>，因为可以触发 V8 的优化机制 <strong>“隐藏类（hidden class）”</strong>。首先，<strong>隐藏类是 V8 内部为了优化非整数索引属性（命名属性）的访问速度的机制，每一次对对象命名属性的增删操作都会导致新的隐藏类被创建，而具备同样的命名属性定义顺序的对象可以共享隐藏类，减少开销</strong>。接下来，通过查看 <code>reusify</code> 模块的源码便可知道，模块内部为了实现缓存队列给被重用的对象添加了一个 <code>next</code> 属性，由此便可以明白作者的注释是告诉我们如何利用好 V8 的内部优化机制 —— 隐藏类。</p>
<blockquote>
<p><a href=https://v8.dev/blog/fast-properties target=_blank rel="noopener noreferrer">Fast properties in V8</a></p>
</blockquote>
<blockquote>
<p><a href=https://engineering.linecorp.com/en/blog/v8-hidden-class/ target=_blank rel="noopener noreferrer">V8 Hidden class</a></p>
</blockquote>
<blockquote>
<p><a href=https://stackoverflow.com/questions/17925726/clearing-up-the-hidden-classes-concept-of-v8 target=_blank rel="noopener noreferrer">Clearing up the <code>hidden classes</code> concept of V8</a></p>
</blockquote>
<blockquote>
<p><a href=https://codereview.stackexchange.com/questions/28344/should-i-put-default-values-of-attributes-on-the-prototype-to-save-space/28360#28360 target=_blank rel="noopener noreferrer">Should I put default values of attributes on the prototype to save space?</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=插件模型plugin-model>插件模型（Plugin Model）<a href=#插件模型plugin-model class=hash-link aria-label="插件模型（Plugin Model）的直接链接" title="插件模型（Plugin Model）的直接链接">​</a></h3>
<p>Fastify 的灵活扩展主要依赖于其插件系统，同时也支持 Express 中间件（需要 <code>middie</code> 插件），可以说是 Express 与 Hapi 的组合。在探究 Fastify 的插件模型之前，先来看看 Koa 的中间件模型的源码实现：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// https://github.com/koajs/compose/blob/25568a36509fefc58914bc2a7600f787b16aa0df/index.js#L42</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>compose</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">middleware</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">context</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> next</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>dispatch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>0</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>dispatch</span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">i</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// ...</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token comment" style=color:#999988;font-style:italic>// 遍历嵌套迭代（类递归）的方式执行</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">      </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token known-class-name class-name">Promise</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>resolve</span><span class="token punctuation" style=color:#393A34>(</span><span class="token function" style=color:#d73a49>fn</span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">context</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> dispatch</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>bind</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword null nil" style=color:#00009f>null</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> i </span><span class="token operator" style=color:#393A34>+</span><span class="token plain"> </span><span class="token number" style=color:#36acaa>1</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>我们可以看到 <code>koa-compose</code> 模块实现了 Koa 的中间件模型，是一种通过遍历嵌套迭代（类递归）的方式来逐个执行中间件函数，而且引入上下游（upstream / downstream）的概念，这种方式会导致调用栈会非常的大，性能很难优化。而查看 Express 的源码，发现其会把中间件函数当作路由函数来对待，存储在数组中，后续也会以类似的方式执行，同样也会有调用栈过大的问题。</p>
<p>Fastify 依赖于 <code>avvio</code> 模块 <strong>建立了一种基于可重入（reentrant ）和有向无环图（directed acyclic graph）的插件模型</strong>，可以正确处理异步代码，保证插件的加载顺序，避免了前面提到的调用栈过大的问题。建立一个有向无环图的插件系统可以保证不会创建交叉依赖，并且实现了可以在应用程序的不同部分使用相同插件的不同版本。</p>
<p><img decoding=async loading=lazy alt=有向无环图.png src=/assets/images/survivejs.com_9f7ecd003147aad41c8b8c236c703db4.png-13bb33e0f1d14afed1a247f8d2475b1f.png width=1008 height=862 class=img_ev3q>
有向无环图</p>
<p>由于这种架构模式，带来的另外一个好处就是很容易将应用拆分为多个微服务。</p>
<p><img decoding=async loading=lazy alt=有向无环图服务.png src=/assets/images/6758771bb4590b09ac0780ceb3c51da9-b5922a9186009d6699cf7750432565ac.webp width=1369 height=862 class=img_ev3q>
有向无环图服务</p>
<p>那么，可重入带来了什么？可重入性是代码的一种属性，指其没有共享状态，可以安全的在多个线程中或者递归地调用执行；换句话说，代码因为具备某些状态，在多个线程或者递归调用时因为改变了该状态而导致逻辑出错，表明代码是不可重入的，不具备可重入性。常见的应用场景就是在遍历图形的算法中，可能会多次到达同一个节点，可重入性保证了遍历过程中是安全的。</p>
<p>具体实现，在 Fastify 官方文档的 <strong><a href=https://www.fastify.io/docs/latest/Encapsulation/ target=_blank rel="noopener noreferrer">Encapsulation</a></strong> 章节有关于其基本特性 "封装上下文（encapsulation context）" 的介绍，示例代码形象易懂，核心是围绕 <code>register</code> API 构建的自上而下继承的上下文模型，并可以通过 <code>fastify-plugin</code> 模块打破这种限制完成特定场景下的应用。在 Fastify 中一切皆插件，形成的这种插件系统，也正是上面提到的可以将应用方便的拆分为微服务的基础。</p>
<blockquote>
<p><a href=https://github.com/fastify/middie target=_blank rel="noopener noreferrer">GitHub: <code>middie</code></a></p>
</blockquote>
<blockquote>
<p><a href=https://github.com/fastify/avvio target=_blank rel="noopener noreferrer">GitHub: <code>avvio</code></a></p>
</blockquote>
<blockquote>
<p><a href=https://en.wikipedia.org/wiki/Directed_acyclic_graph target=_blank rel="noopener noreferrer">Directed acyclic graph</a></p>
</blockquote>
<blockquote>
<p><a href=https://stackoverflow.com/questions/1312259/what-is-the-re-entrant-lock-and-concept-in-general target=_blank rel="noopener noreferrer">What is the Re-entrant lock and concept in general?</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=其它方面>其它方面<a href=#其它方面 class=hash-link aria-label=其它方面的直接链接 title=其它方面的直接链接>​</a></h3>
<p>除了上面所介绍的 Fastify 特点外，还有其它一些方面值得关注。</p>
<p>第一个，<code>Decorators</code> API 提供了一个在整个应用的请求链路中共享数据的机制，此 API 也体现了 Fastify 对性能的关注，其与 V8 内部优化机制“隐藏类”和“内联缓存”相关。</p>
<blockquote>
<p><a href=https://mathiasbynens.be/notes/shapes-ics target=_blank rel="noopener noreferrer">JavaScript engine fundamentals: Shapes and Inline Caches</a></p>
</blockquote>
<p>第二个，<code>Hooks</code> API 允许监听一些应用生命周期事件，提供了更高的灵活性，给特定场景下的应用提供了较好的实现机制。</p>
<p>第三个，内置了依赖于 <code>Pino</code> 模块实现的日志系统，日志作为后端应用针对错误分析、性能分析等的原始信息是相当重要的，可见 Fastify 团队关注点还是相当准确的。</p>
<p>最后，Fastify 的插件生态目前可能还不算很丰富，但官方提供的核心插件基本上也覆盖了常见的各种场景，例如消息队列、WebSocket、鉴权、缓存等。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=结语>结语<a href=#结语 class=hash-link aria-label=结语的直接链接 title=结语的直接链接>​</a></h2>
<p>可以看得出来，Fastify 对性能的追求是极致的，涉及到很多 V8 内部对代码的优化机制，通过了解还是收获颇丰的。回过头来，Node.js Web 框架虽然层出不穷，但根据 NPM Trends 的下载量统计来看，Express 依然高居榜首，说明 Node.js Web 框架在重业务场景下的应用其实不多，更多的应该是作为一些小项目的后端或者类似 BFF 层这种轻量的场景下应用。从 Express 到 Koa 再到 Fastify，这是向更轻量更高性能的方向发展，技术的发展趋势也从侧面反映了该技术在业务场景中的价值体现。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=参考资源>参考资源<a href=#参考资源 class=hash-link aria-label=参考资源的直接链接 title=参考资源的直接链接>​</a></h2>
<ul>
<li><a href=https://www.webexpo.net/prague2017/talk/what-if-i-told-you-that-http-can-be-fast/ target=_blank rel="noopener noreferrer">What if I told you that HTTP can be fast?</a></li>
<li><a href=https://survivejs.com/blog/fastify-interview/ target=_blank rel="noopener noreferrer">Fastify - Fast and low overhead web framework for Node.js - Interview with Tomas Della Vedova</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=附对比表>附：对比表<a href=#附对比表 class=hash-link aria-label=附：对比表的直接链接 title=附：对比表的直接链接>​</a></h2>





















































































































<table><thead><tr><th>对比项(2021-06-01)<th>express<th>koa<th>Fastify<th>nestjs<tbody><tr><td>当前版本<td>v4.17.1(2019-05-26)<td>v2.13.1(2021-01-04)<td>v3.17.0(2021-05-29)<td>v7.6.17(2021-05-18)<tr><td>设计理念/哲学<td>小型、强大的 HTTP 服务器工具<td>更轻量、高性能、“洋葱模型”<td>高性能、低开销，开发友好<td>提供 Node Web 应用的”架构规范“<tr><td>技术架构<td>核心简单，具备路由等常见功能，其它需依赖中间件扩展<td>核心极简，不包含任何额外功能，路由等其它功能需要依赖中间件扩展<td>核心简单，提供路由、日志等必要组件，其它依赖插件扩展<td>底层核心可替换，上层 MVC 模型<tr><td>扩展机制<td>中间件<td>中间件<td>插件<td>插件<tr><td>项目活跃度（近一年平均每周 GitHub commits）<td>0-2<td>0-2<td>5-10<td>20<tr><td>维护团队的 roadmap<td>4.x -> 5.0（缓慢）<td>2.x -> 3.0（缓慢）<td>3.x -> 4.0（积极）<td>v8.0 计划完成，待发布<tr><td>是否支持 ts<td>社区维护 @types<td>社区维护 @types<td>官方维护 @types<td>官方内置支持<tr><td>公开的基准测试<td>QPS 最低<td>QPS 高<td>QPS 最高<td><tr><td>技术生态（官方+社区）<td>丰富<td>丰富<td>较丰富<td>较丰富<tr><td>常见业务场景解决方案<td>社区中间件<td>社区中间件<td>官方插件<td>官方文档，内置适配器<tr><td>商业案例<td>有<td>有<td>有<td>有<tr><td>上手难易程度<td>容易<td>容易<td>容易<td>中等<tr><td>可查阅的资料<td>多<td>较多<td>较多<td>较多<tr><td>官网文档（中文）<td>有<td>有<td>有<td>有<tr><td>OpenJS 基金会项目<td>是<td><td>是<td></table>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=附基准测试>附：基准测试<a href=#附基准测试 class=hash-link aria-label=附：基准测试的直接链接 title=附：基准测试的直接链接>​</a></h2>
<p>这里做了一个简单的基准测试，在 <em>windows 10</em> 平台下采用 <code>autocannon</code> 测试工具，依赖版本如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token string-property property" style=color:#36acaa>"dependencies"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>"express"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"4.17.1"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>"fastify"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"3.18.1"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>"koa"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"2.13.1"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token string-property property" style=color:#36acaa>"devDependencies"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token string-property property" style=color:#36acaa>"autocannon"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"^7.3.0"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><br></span></code></pre></div></div>
<p>测试代码如下：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// express</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> app </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>express</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'/'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>function</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">req</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> res</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  res</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>send</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>hello</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'world'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>listen</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>3002</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// koa</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> app </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>new</span><span class="token plain"> </span><span class="token class-name">Koa</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>use</span><span class="token punctuation" style=color:#393A34>(</span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">ctx</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  ctx</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">body</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>hello</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'world'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">app</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>listen</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>3001</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token comment" style=color:#999988;font-style:italic>// fastify</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token keyword" style=color:#00009f>const</span><span class="token plain"> fastify </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function maybe-class-name" style=color:#d73a49>Fastify</span><span class="token punctuation" style=color:#393A34>(</span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token comment" style=color:#999988;font-style:italic>// logger: true,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fastify</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>get</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'/'</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token keyword" style=color:#00009f>async</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">request</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> reply</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  reply</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>type</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'application/json'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>code</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>200</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>return</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token literal-property property" style=color:#36acaa>hello</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'world'</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">fastify</span><span class="token punctuation" style=color:#393A34>.</span><span class="token method function property-access" style=color:#d73a49>listen</span><span class="token punctuation" style=color:#393A34>(</span><span class="token number" style=color:#36acaa>3000</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token parameter">err</span><span class="token parameter punctuation" style=color:#393A34>,</span><span class="token parameter"> address</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token arrow operator" style=color:#393A34>=></span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">err</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>throw</span><span class="token plain"> err</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><br></span></code></pre></div></div>
<p>测试结果如下：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># express</span><br></span><span class=token-line style=color:#393A34><span class="token plain">> autocannon http://127.0.0.1:3002/</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Running 10s test @ http://127.0.0.1:3002/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">10 connections</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Latency │ 0 ms │ 1 ms │ 2 ms  │ 3 ms │ 0.84 ms │ 0.61 ms │ 10 ms │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌───────────┬─────────┬─────────┬─────────┬────────┬─────────┬─────────┬─────────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%  │ Avg     │ Stdev   │ Min     │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼─────────┼────────┼─────────┼─────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Req/Sec   │ 4675    │ 4675    │ 8199    │ 8287   │ 7838.37 │ 1017.07 │ 4672    │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼─────────┼────────┼─────────┼─────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Bytes/Sec │ 1.07 MB │ 1.07 MB │ 1.88 MB │ 1.9 MB │ 1.79 MB │ 233 kB  │ 1.07 MB │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└───────────┴─────────┴─────────┴─────────┴────────┴─────────┴─────────┴─────────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Req/Bytes counts sampled once per second.</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">86k requests in 11.01s, 19.7 MB read</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># koa</span><br></span><span class=token-line style=color:#393A34><span class="token plain">> autocannon http://127.0.0.1:3001/</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Running 10s test @ http://127.0.0.1:3001/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">10 connections</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬──────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max  │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼──────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.12 ms │ 9 ms │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴──────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌───────────┬─────────┬─────────┬────────┬─────────┬────────┬────────┬─────────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat      │ 1%      │ 2.5%    │ 50%    │ 97.5%   │ Avg    │ Stdev  │ Min     │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼────────┼─────────┼────────┼────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Req/Sec   │ 17743   │ 17743   │ 20111  │ 20335   │ 19496  │ 964.55 │ 17731   │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼────────┼─────────┼────────┼────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Bytes/Sec │ 2.91 MB │ 2.91 MB │ 3.3 MB │ 3.33 MB │ 3.2 MB │ 159 kB │ 2.91 MB │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└───────────┴─────────┴─────────┴────────┴─────────┴────────┴────────┴─────────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Req/Bytes counts sampled once per second.</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">214k requests in 11.01s, 35.2 MB read</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># fastify</span><br></span><span class=token-line style=color:#393A34><span class="token plain">> autocannon http://127.0.0.1:3000/</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Running 10s test @ http://127.0.0.1:3000/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">10 connections</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌─────────┬──────┬──────┬───────┬──────┬─────────┬─────────┬───────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat    │ 2.5% │ 50%  │ 97.5% │ 99%  │ Avg     │ Stdev   │ Max   │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├─────────┼──────┼──────┼───────┼──────┼─────────┼─────────┼───────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Latency │ 0 ms │ 0 ms │ 0 ms  │ 0 ms │ 0.01 ms │ 0.13 ms │ 13 ms │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└─────────┴──────┴──────┴───────┴──────┴─────────┴─────────┴───────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain">┌───────────┬─────────┬─────────┬─────────┬─────────┬──────────┬─────────┬─────────┐</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Stat      │ 1%      │ 2.5%    │ 50%     │ 97.5%   │ Avg      │ Stdev   │ Min     │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Req/Sec   │ 19759   │ 19759   │ 27631   │ 27903   │ 26960.73 │ 2284.47 │ 19752   │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">├───────────┼─────────┼─────────┼─────────┼─────────┼──────────┼─────────┼─────────┤</span><br></span><span class=token-line style=color:#393A34><span class="token plain">│ Bytes/Sec │ 3.24 MB │ 3.24 MB │ 4.53 MB │ 4.58 MB │ 4.42 MB  │ 375 kB  │ 3.24 MB │</span><br></span><span class=token-line style=color:#393A34><span class="token plain">└───────────┴─────────┴─────────┴─────────┴─────────┴──────────┴─────────┴─────────┘</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">Req/Bytes counts sampled once per second.</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">297k requests in 11.01s, 48.6 MB read</span><br></span></code></pre></div></div>
<p>根据测试结果来看，仅 <strong>Req/Sec</strong> 这一项的平均值（Avg），Express 只有 <strong>7838.37</strong>，Koa 有 <strong>19496</strong>，约为前者的 2.4 倍，而 Fastify 达到了 <strong>26960.73</strong>，是 Express 的约 3.4 倍，Koa 的约 1.4 倍。除此之外，<strong>Bytes/Sec</strong> 指标也有差距，综合起来 Koa 和 Fastify 的表现要好的多，而 Fastify 要比 Koa 表现更好一些。</div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/计算机技术>计算机技术</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/web>Web</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/web-后端>Web 后端</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/node-js>Node.js</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/java-script>JavaScript</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/fastify>Fastify</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/nodejs/nodejs-fastify/index.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=博文分页导航><a class="pagination-nav__link pagination-nav__link--prev" href=/life/2021-life-work-review><div class=pagination-nav__sublabel>较新一篇</div><div class=pagination-nav__label>对第一份工作生活的回顾</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/computer-technology/tools/tools-programming-language><div class=pagination-nav__sublabel>较旧一篇</div><div class=pagination-nav__label>理解编程语言的设计与实现</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#设计理念 class="table-of-contents__link toc-highlight">设计理念</a><li><a href=#fastify-的实现细节 class="table-of-contents__link toc-highlight">Fastify 的实现细节</a><ul><li><a href=#json-序列化 class="table-of-contents__link toc-highlight">JSON 序列化</a><li><a href=#路由routing class="table-of-contents__link toc-highlight">路由（Routing）</a><li><a href=#闭包closure class="table-of-contents__link toc-highlight">闭包（Closure）</a><li><a href=#调用栈call-stack class="table-of-contents__link toc-highlight">调用栈（Call stack）</a><li><a href=#服务器的生命周期server-lifecycle class="table-of-contents__link toc-highlight">服务器的生命周期（Server Lifecycle）</a><li><a href=#插件模型plugin-model class="table-of-contents__link toc-highlight">插件模型（Plugin Model）</a><li><a href=#其它方面 class="table-of-contents__link toc-highlight">其它方面</a></ul><li><a href=#结语 class="table-of-contents__link toc-highlight">结语</a><li><a href=#参考资源 class="table-of-contents__link toc-highlight">参考资源</a><li><a href=#附对比表 class="table-of-contents__link toc-highlight">附：对比表</a><li><a href=#附基准测试 class="table-of-contents__link toc-highlight">附：基准测试</a></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>关于我</div><ul class="footer__items clean-list"><li class=footer__item><a href=mailto:mrwang1212@126.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gitee.com/i_wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>Gitee<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>更多</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class=footer__link-item>Awesome Favorites List<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/the-book-of-ruby target=_blank rel="noopener noreferrer" class=footer__link-item>The Book Of Ruby (ZH)<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/echarts-api-docs target=_blank rel="noopener noreferrer" class=footer__link-item>Apache ECharts APIs Guide<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 My Blog. Built with Docusaurus.</div></div></div></footer></div>