<!DOCTYPE html>
<html lang="zh-CN">
<body>
	<header class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 class="page-title display-4">使用 Git</h1>
			<p>
				<span class="tag tag-danger">Git</span>&nbsp;&nbsp;&nbsp;
				<span class="tag tag-warning">Bash</span>
			</p>
			<p class="head-indent lead">
				Git 是一个分布式的版本控制工具，类似的版本控制工具还有 SVN ；由于 GitHub 平台的盛行，也使得 git 更加受欢迎，在 Windows 平台使用 git 也是非常方便的。
			</p>
			<hr />
			<p>
				<span id="time" class="tag tag-pill tag-success">发表于 2016-12-31</span>&nbsp;
				<span id="categories" class="tag tag-pill tag-success">分类 Tools</span>
			</p>
		</div>
	</header>
	<div class="container">
		<div class="row">
			<div class="col-md-9">
				<section>
					<h2>Git</h2>
					<p class="head-indent">
						Git 是一个非常强大的版本控制工具，所谓的版本控制即就是对一个项目的更改进行记录，随后可以进行撤销、查看等功能。对于大型的开源项目，版本控制工具提供了非常大的便利，可以多人同时协作开发。Github 则提供了这样一个平台，使用 git 进行项目维护，世界上大多数的开源项目都在 github 仓库中进行展示。而 github 对程序员也是友好的，因为我们个人也可以使用免费的仓库，来维护自己的项目。
					</p>
					<p class="head-indent">
						Git 源于 Linux ，但不仅仅限于 Linux 平台下的使用， Git for Windows 就是最好的选择：
					</p>
					<blockquote>
						<b>Git for Windows：</b><a href="https://git-scm.com/" target="_blank">https://git-scm.com/</a>
					</blockquote>
				</section>
				<section>
					<h2>Git Bash</h2>
					<p class="head-indent">
						Git 在 Windows 下提供了图形用户界面（Git GUI）和命令行（Git Bash）两种操作方式，不过我更推荐使用后者，命令行更快速、简单一些。
					</p>
					<p class="head-indent">
						安装好后，我们打开 Bash 终端，可以在界面上<code>右键-->Options-->Text</code>，更改字体大小和字符编码，推荐将字符编码改为<strong>UTF-8</strong>。
					</p>
					<section>
						<h3>配置</h3>
						<p class="head-indent">
							我们首先可以对 Git 进行简单的配置，使用 SSH 来避免重复提交时每次都要输入密码。
						</p>
						<section>
							<h4>个人信息</h4>
							<p class="head-indent">
								进行用户名和邮箱的全局配置：
							</p>
							<pre class="language-bash"><code>git config --global user.name "MrWang"
git config --global user.email "wangyuan230@163.com"</code></pre>
						</section>
						<section>
							<h4>SSH 密钥</h4>
							<p class="head-indent">
								安装 SSH 密钥可以在我们进行项目提交时避免重复输入用户名密码，也更安全。可以直接查看 GitHub 官方文档：
							</p>
							<blockquote>
								<b>Help：</b><a href="https://help.github.com/articles/generating-an-ssh-key/" target="_blank">https://help.github.com/articles/generating-an-ssh-key/</a>
							</blockquote>
							<p class="head-indent">检查是否已有 SSH 密钥文件：</p>
							<pre class="language-bash"><code>ls -al ~/.ssh</code></pre>
							<p class="head-indent">如果不存在（或者想覆盖），可以生成一个新的 SSH 密钥文件：</p>
							<pre class="language-bash"><code>ssh-keygen -t rsa -b 4096 -C "wangyuan230@163.com"</code></pre>
							<p class="head-indent">这里使用你的邮箱作为 SSH 密钥标签，该过程中直接全按回车即可。</p>
							<p class="head-indent">得到 SSH 密钥文件后，接下来应该将该密钥添加到 ssh-agent ：</p>
							<pre class="language-bash"><code># 启动 ssh-agent
eval $(ssh-agent -s)
# 添加 SSH
ssh-add ~/.ssh/id_rsa</code></pre>
							<p class="head-indent">
								最后将 SSH 添加到你的 GitHub 账户即可，先将密钥文件复制到剪切板：
							</p>
							<pre class="language-bash"><code>clip < ~/.ssh/id_rsa.pub</code></pre>
							<p class="head-indent">
								然后，打开 <a href="https://github.com/login" target="_blank">GitHub</a> 网站登录你的帐户，右上角头像进入<code>Settings</code>，左边导航选择<code>SSH and GPG keys</code>，点击<code>New SSH key</code>，自己命名一个 title，然后将 SSH 文件复制到 key 框中，然后需要输入你的 github 账户密码。
							</p>
							<p class="head-indent">最后，可以测试一下：</p>
							<pre class="language-bash"><code>ssh -T git@github.com</code></pre>
							<p class="head-indent">回车后输入<strong>yes</strong>，如果看到 <b>Hi 你的用户名</b> 一串信息，就说明添加 SSH 密钥成功了。</p>
						</section>
					</section>
				</section>
				<section>
					<h2>使用 Git</h2>
					<p class="head-indent">下面来看看 git bash 中一些常用的 git 命令，介绍一下其简单的用法，利用 git 来管理我们的代码。</p>
					<section>
						<h3>初始化</h3>
						<p class="head-indent">
							在创建好一个新文件夹之后，进入该空白文件夹，我们在 git bash 中输入<code>init</code>命令即可初始化该文件夹为一个新的 git 仓库。
						</p>
						<pre class="language-bash"><code># 初始化仓库
git init</code></pre>
						<p class="head-indent">初始化完成后，该文件夹会出现一个隐藏的<strong> .git </strong>文件夹，可以使用<code>ls</code>命令查看是否已生成该文件夹</p>
						<pre class="language-bash"><code># 查看文件
ls -a</code></pre>
						<p class="head-indent">
							该文件夹为仓库管理文件，并且是隐藏，一般情况下不要修改其中的文件。
						</p>
					</section>
					<section>
						<h3>添加与提交</h3>
						<p class="head-indent">
							Git 的工作状态有3个，分别为<strong>工作区（working directory）</strong>、<strong>暂存区（staging index）</strong>和<strong>版本库（Repository）</strong>。我们在个人仓库（本地文件夹）中修改代码时，就处于工作区中；修改完成后，需要使用<code>add</code>命令将修改好的文件添加到暂存区中；随后，确认无误后我们可以使用<code>commit</code>命令将已添加到暂存区的文件提交到版本库中。
						</p>
						<pre class="language-bash"><code># 第一步：添加文件到暂存区
git add file_name  # 例如 git add index.html
# 第二步：将暂存区文件提交到版本库中
git commit -m "version_message"  # 例如 git commit -m "1.0"</code></pre>
						<p class="head-indent">另外地，为了方便我们可以一次性将当前文件夹（工作区）的所有文件都添加到暂存区中：</p>
						<pre class="language-bash"><code># 添加工作区所有文件到暂存区
git add .</code></pre>
						<p class="head-indent">当然了，我们还可以将添加与提交操作合二为一，跳过暂存区：</p>
						<pre class="language-bash"><code># 一次性添加与提交工作区文件到版本库
git commit -am "version_message"</code></pre>
					</section>
					<section>
						<h3>查看信息</h3>
						<p class="head-indent">
							如果能随时查看仓库中文件的修改情况以及与版本库中文件进行对比的结果可以方便很多，其实使用<code>status</code>和<code>log</code>命令即可查看所需要的信息。
						</p>
						<pre class="language-bash"><code># 查看目前文件修改情况（是否已添加、提交）
git status
# 查看已提交的文件日志
git log</code></pre>
					</section>
					<section>
						<h3>撤销操作</h3>
						<p class="head-indent">当我们将文件修改后，如果发现更改并不恰当，需要回滚到修改之前的状态时，可以撤销我们的更改操作。</p>
						<pre class="language-bash"><code># 撤销工作区改动，将暂存区文件覆盖到工作区
git checkout -- file_name</code></pre>
						<p class="head-indent">这个命令所做的就是用暂存区中的文件来覆盖工作区已被修改的文件，从而实现撤销工作区的修改操作。</p>
						<pre class="language-bash"><code># 撤销暂存区改动，将版本库文件覆盖到暂存区
git reset HEAD -- file_name</code></pre>
						<p class="head-indent">
							而这个命令所做的则是用版本库中的文件来覆盖暂存区中已被修改的文件，从而实现撤销暂存区的修改操作。这里的<strong>HEAD</strong>指的是最近一次提交操作，可以将其更换为你需要撤销的提交操作的ID号，可以使用<code>log</code>命令查看提交信息中的ID。
						</p>
						<p class="head-indent">
							实际上，先撤销暂存区改动，再撤销工作区改动，就可以将版本库中的文件恢复到工作区中。另外，还可以撤销提交操作并重新进行提交，这个命令可以用来修改提交信息和内容。
						</p>
						<pre class="language-bash"><code># 第一次提交
git commit -m "version 1.0"
# 撤销上次提交修改提交信息并重新提交
git commit --amend</code></pre>
					</section>
					<section>
						<h3>删除操作</h3>
						<p class="head-indent">有时候我们可能把不需要添加到暂存区的文件给添加到了暂存区，这时候可以使用以下命令将其在暂存区中删除：</p>
						<pre class="language-bash"><code># 仅删除暂存区中的文件
git rm --cached file_name</code></pre>
						<p class="head-indent">当然，也有可能我们想直接删除掉工作区和暂存区中的文件：</p>
						<pre class="language-bash"><code># 同时删除工作区与暂存区中的文件
git rm -f file_name</code></pre>
						<p class="head-indent">
							除此之外，还有一种情况就是我们在工作区将同一个文件重命名后，需要删除原有在暂存区中的文件，添加新的文件到暂存区中，但是它们的文件内容是相同的。所以，直接可以进行重命名操作：
						</p>
						<pre class="language-bash"><code>git mv old_filename new_filename</code></pre>
					</section>
				</section>
				<section>
					<h2>分支管理</h2>
					<p class="head-indent">
						Git 是一个版本控制工具，可以实现多人协作处理同一个项目的代码，同时又互不发生冲突。而要实现多人协作互不发生冲突，团队成员就不能同时操作同一个文件，于是 Git 中有一个分支（branch）的概念需要我们弄清楚，因为就是它解决了这个关键的问题。
					</p>
					<p class="head-indent">
						当首次提交文件到版本库时，会自动创建一个<strong>主分支（master）</strong>，多人协作时我们不能同时在主分支上操作，因为会发生冲突。所以，我们可以从主分支（master）上分出多个副分支来，就像从一颗树的主干上长出多个分叉枝节一样，我们在这些副分支上进行修改操作。当修改完成后，我们再将副分支上的更改合并到主分支（master）上即可，这样就不会出现多人同时操作同一个文件的冲突。
					</p>
					<section>
						<h3>查看分支</h3>
						<p class="head-indent">
							在项目第一次提交到版本库时，会自动创建一个主分支（master），随后就可以创建副分支了。当我们想查看该项目的分支情况时，使用<code>branch</code>命令即可。
						</p>
						<pre class="language-bash"><code># 查看项目分支
git branch</code></pre>
					</section>
					<section>
						<h3>创建分支</h3>
						<p class="head-indent">在 master 分支上我们可以创建多个副分支并自己命名，使用以下命令即可：</p>
						<pre class="language-bash"><code># 创建新的分支，但不切换
git branch branch_name  # 例如 git branch dev
</code></pre>
					</section>
					<section>
						<h3>切换分支</h3>
						<p class="head-indent">切换分支就是<code>checkout</code>命令：</p>
						<pre class="language-bash"><code># 切换到另一个分支上
git checkout branch_name  # 例如 git checkout dev</code></pre>
						<p class="head-indent">其实，我们可以直接在创建新分支时切换到新分支上去：</p>
						<pre class="language-bash"><code># 创建新的分支，并切换到新分支
git checkout -b branch_name</code></pre>
					</section>
					<section>
						<h3>重命名分支</h3>
						<p class="head-indent">可以使用以下命令来更改一个已有副分支（因为主分支是不能重命名）的名字：</p>
						<pre class="language-bash"><code># 重命名已有的副分支
git branch -m old_branchname new_branchname</code></pre>
					</section>
					<section>
						<h3>删除分支</h3>
						<p class="head-indent">当我们想删除一个分支时，先切换到其它分支上去，再使用以下命令：</p>
						<pre class="language-bash"><code># 删除已有的副分支，注意先切换到其它分支
git branch -d branch_name</code></pre>
					</section>
					<section>
						<h3>合并分支</h3>
						<p class="head-indent">当副分支上的工作完成后，就需要将副分支合并到主分支上去，此时应先切换到主分支上去，再使用<code>merge</code>命令：</p>
						<pre class="language-bash"><code># 合并分支，注意先切换到主分支上去
git merge branch_name</code></pre>
					</section>
					<section>
						<h3>对比差异</h3>
						<p class="head-indent">
							很多时候我们需要查看工作区与暂存区、暂存区与版本库、分支与分支等等之间文件的具体改动的差异信息，使用<code>diff</code>命令即可：
						</p>
						<pre class="language-bash"><code># 对比工作区与暂存区的文件差异
git diff
# 对比暂存区与版本库的文件差异
git diff --staged
# 对比分支与分支的文件差异
git diff other_branchname</code></pre>
						<p class="head-indent">除此之外，还可以对比两次提交版本的文件差异，在 diff 命令后跟要对比的两次提交操作的ID号即可。</p>
					</section>
					<section>
						<h3>保存工作区状态</h3>
						<p class="head-indent">
							当我们在一个分支上改动了工作区的文件，没有添加到暂存区并提交到版本库时，使用 checkout 切换分支时就会失败，因为这样会丢失工作区的更改。我们可以提交后再切换分支，当然也可以使用<code>stash</code>命令将此分支的工作区状态保存下来再切换到别的分支，之后回到该分支可以还原工作区的状态。
						</p>
						<pre class="language-bash"><code># 保存当前分支工作区状态
git stash
# 查看所有分支已保存的工作区状态及其序号
git stash list</code></pre>
						<p class="head-indent">保存了工作区状态之后，我们可以在任意分支下将保存的工作区状态与当前工作区状态合并，先查看保存的工作区状态序号：</p>
						<pre class="language-bash"><code># 合并当前工作区与已保存工作区，不删除已保存状态
git stash apply stash@{num}  # 例如 git stash apply stash@{0}</code></pre>
						<p class="head-indent">合并之后，可以删除掉已保存的工作区状态，同样地先查看保存的工作区状态序号：</p>
						<pre class="language-bash"><code># 删除已保存的工作区状态
git stash drop stash@{num}</code></pre>
						<p class="head-indent">当然，为了方便我们可以一次性完成合并工作区与删除已保存的工作区状态：</p>
						<pre class="language-bash"><code># 合并工作区状态，并删除已保存的工作区状态
git stash pop stash@{num}</code></pre>
					</section>
				</section>	
			</div>			
		</div>		
	</div>
	
	<script src="/source/js/prism.js"></script>
</body>
</html>