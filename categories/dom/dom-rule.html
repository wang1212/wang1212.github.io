<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1, user-scalable=no">
	<title>DOM-元素节点几何量</title>
	<link rel="stylesheet" href="/source/css/bootstrap.min.css">
	<link rel="stylesheet" href="/source/css/font-awesome.min.css">
	<link rel="stylesheet" href="/source/css/prism.css">
	<link rel="stylesheet" href="/source/css/main.css">
</head>
<body>
	<header class="jumbotron jumbotron-fluid">
		<div class="container">
			<h1 class="display-4">DOM-元素节点几何量</h1>
			<p>
				<span class="tag tag-danger">Web</span>&nbsp;&nbsp;&nbsp;
				<span class="tag tag-warning">DOM</span>&nbsp;&nbsp;&nbsp;
				<span class="tag tag-info">几何量</span>
			</p>
			<p class="head-indent lead">
				当我们在查看 HTML 文档时，每个元素节点被解析后，都画成了可视形状。我们可以获取每个元素节点的几何量（宽、高、偏移量）以及页面滚动距离。
			</p>
			<hr />
			<p>
				<span id="time" class="tag tag-pill tag-success">发表于 2016-5-19</span>&nbsp;
				<span id="categories" class="tag tag-pill tag-success">分类 Dom</span>
			</p>
		</div>
	</header>
	<div class="container">
		<div class="row">
			<div class="col-md-9">
				<section>
					<h2>元素节点几何量</h2>
					<p class="head-indent">通常我们将一个元素抽象成一个盒子模型，具有 content（内容）、padding（填充、内边距）、border（边框）、margin（外边距）这些尺寸属性。</p>
					<section>
						<h3>定位偏移量</h3>
						<p class="head-indent">使用元素节点的<code>offsetTop</code>与<code>offsetLeft</code>属性，我们可以分别获取该元素节点<b>顶部与左侧外边框</b>相对于<code>offsetParent</code>的<b>顶部与左侧内边框</b>的偏移像素量。</p>
						<ul>
							<li>offsetParent</li>
							<li>offsetTop</li>
							<li>offsetLeft</li>
						</ul>
						<p class="head-indent">一个元素节点的<code>offsetParent</code>判定依据为查找<b>距离该元素节点最近的 CSS 定位（position）值不为 static（默认值）的祖先元素，</b>直至<code>body</code>元素为止。如果在查询过程中，找到<code>td、th、table</code>元素之一，且它的定位值为<code>static</code>，则将它作为<code>offsetParent</code>。</p>
						<pre class="language-markup"><code>&lt;style&gt;
	#out{
		width: 200px;
		height: 200px;
		background-color: #ccc;
		border: 5px solid yellow;
		padding: 10px;
		margin: 15px; 
		position: relative;
	}
	#in{
		width: 100px;
		height: 100px;
		background-color: red;
		border: 3px solid blue;
		padding: 6px;
		margin: 9px;  
	}
&lt;/style&gt;
&lt;body&gt;
  	&lt;div id="out"&gt;
    	&lt;div id="in"&gt;&lt;/div&gt;
  	&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
	// 查看内部DIV的offsetParent
	console.log(document.querySelector("#in").offsetParent);
	// 输出&lt;div id="out"&gt;...&lt;/div&gt;
	// 这是因为外部DIV的position="relative/absolute"

	// 验证内部DIV的offsetTop与offsetParent的值
	console.log(document.querySelector("#in").offsetTop);  // 输出19
	console.log(document.querySelector("#in").offsetLeft);  // 输出19
&lt;/script&gt;</code></pre>
						<p class="head-indent">上述示例可以看出，符合<b>外边框到<code>offsetParent</code>内边框</b>的计算方式。通俗的说就是，我们将一个小盒子放到一个大盒子中，小盒子外侧到大盒子内侧的距离就是我们要计算的值。</p>
					</section>
					<section>
						<h3>盒子属性</h3>
						<p class="head-indent">在可视区（浏览器 HTML 文档显示区，不包含浏览器导航、地址栏等）内，我们可以通过<code>getBoundingClientRect()</code>方法获取某个元素的矩形盒子基本属性。</p>
						<ul>
							<li>getBoundingClientRect()</li>
						</ul>
						<pre class="language-markup"><code>&lt;style&gt;
	body{
		border: 0px;
		padding: 0px;
		margin: 0px;
	}
	div{
		width: 200px;
		height: 200px;
		background-color: #ccc;
		border: 10px solid yellow;
		padding: 30px;
		margin: 50px; 
	}
&lt;/style&gt;
&lt;body&gt;
  	&lt;div&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
	  // 获取DIV的矩形盒子基本属性
	  console.log(document.querySelector("div").getBoundingClientRect());
	  // 输出ClientRect{top: 50, right: 330, bottom: 330, left: 50, width: 280, height: 280}

	  // 可以单独获得某项基本属性
	  console.log(document.querySelector("div").getBoundingClientRect().top);
	  // 输出50
&lt;/script&gt;</code></pre>
						<p class="head-indent">上述示例可以看出，<code>top</code>、<code>bottom</code>、<code>left</code>、<code>right</code>属性表示该元素矩形的<b>上、下、左、右外边框</b>相对于浏览器<b>可视区上、下、左、右边沿</b>的偏移像素量。通俗的说就是，在存放快递盒子的仓库中，每个盒子四周外侧到仓库四周墙壁的距离就是我们要计算的值。</p>
						<p class="head-indent"><code>width</code>与<code>height</code>属性表示该元素矩形的可视尺寸（宽、高），不包括<code>margin</code>（外边距）。</p>
					</section>
					<section>
						<h3>盒子尺寸</h3>
						<p class="head-indent">我们可以通过一些属性获取可视区（浏览器HTML文档显示区，不包含浏览器导航、地址栏等）内元素矩形的尺寸。</p>
						<ul>
							<li>offsetWidth</li>
							<li>offsetHeight</li>
							<li>clientWidth</li>
							<li>clientHeight</li>
						</ul>
						<pre class="language-markup"><code>&lt;style&gt;
	div{
		width: 200px;
		height: 200px;
		background-color: #ccc;
		border: 10px solid yellow;
		padding: 30px;
		margin: 50px; 
	}
&lt;/style&gt;
&lt;body&gt;
  	&lt;div&gt;&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
	// 获取DIV的矩形盒子尺寸
	console.log(document.querySelector("div").offsetWidth);  // 输出280
	console.log(document.querySelector("div").offsetHeight);  // 输出280

	console.log(document.querySelector("div").clientWidth);  // 输出260
	console.log(document.querySelector("div").clientHeight);  // 输出260
&lt;/script&gt;</code></pre>
						<p class="head-indent">上述示例可以看出，<code>offsetWidth</code>与<code>offsetHeight</code>属性表示的是元素矩形的可视尺寸（宽、高），不包括<code>margin</code>（外边距）。</p>
						<p class="head-indent">但是，<code>clientWidth</code>与<code>clientHeight</code>属性表示的是元素矩形的有效尺寸（宽、高），不包括<code>margin</code>（外边距）、<code>border</code>（边框）。</p>
					</section>
					<section>
						<h3>获取特定点上最顶层元素节点</h3>
						<p class="head-indent">我们可以使用<code>elementFromPoint()</code>方法获取可视区（浏览器 HTML 文档显示区，不包含浏览器导航、地址栏等）内，特定点上最顶层元素节点的引用。</p>
						<ul>
							<li>elementFromPoint()</li>
						</ul>
						<pre class="language-markup"><code>&lt;script&gt;
	// 获取文档可视区内left=50，top=50处最顶层元素节点
	console.log(document.elementFromPoint(50,50));
&lt;/script&gt;</code></pre>
						<p class="head-indent"><b>如果没有设置 z 轴索引值<code>z-index</code>，则最顶层元素节点就是 HTML 文档中该点上最后被解析的元素节点。</b></p>
					</section>
				</section>
				<section>
					<h2>滚动几何量</h2>
					<p class="head-indent">当HTML文档太大（页面元素太多）时，或者当某个元素节点内内容太多时，会出现左右滚动条。此时，我们可能需要知道该元素节点的滚动区域、滚动距离等等。</p>
					<section>
						<h3>滚动尺寸</h3>
						<p class="head-indent">我们可以通过以下属性来获取 HTML 页面或者某个元素节点的滚动尺寸（总高、总宽）。</p>
						<ul>
							<li>scrollWidth</li>
							<li>scrollHeight</li>
						</ul>
						<pre class="language-markup"><code>&lt;style&gt;
	div{
		width: 200px;
		height: 200px;
		background-color: #ccc;
		overflow: auto;
	}
	p{
		width: 1000px;
		height: 10000px;
		margin: 0px;
	}
&lt;/style&gt;
&lt;body&gt;
  	&lt;div&gt;
    	&lt;p&gt;&lt;/p&gt;
  	&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
  	// 获取DIV的滚动尺寸
	console.log(document.querySelector("div").scrollWidth);  // 输出1000
	console.log(document.querySelector("div").scrollHeight);  // 输出1000
&lt;/script&gt;</code></pre>
						<p class="head-indent"><b>当滚动条未出现（滚动区域<元素尺寸）时，这两个属性将返回<code>clientWidth</code>与<code>clientHeight</code>属性的值，也就是有效尺寸。</b></p>
					</section>
					<section>
						<h3>滚动距离</h3>
						<p class="head-indent">通常页内导航可以将视区跳转到页内某个区域内，或者当页面向下滚动时才继续加载图片等等。这些功能的实现都要获取（设置）所滚动的距离。</p>
						<ul>
							<li>scrollLeft</li>
							<li>scrollTop</li>
						</ul>
						<pre class="language-markup"><code>&lt;style&gt;
	p{
		width: 10000px;
		height: 10000px;
	}
&lt;/style&gt;
&lt;body&gt;
  &lt;p&gt;&lt;/p&gt;
&lt;/body&gt;
&lt;script&gt;
  	// 利用事件将窗口滚动距离显示在标题上
  	window.onscroll=function(){
		scroll_left=document.body.scrollLeft || document.documentElement.scrollLeft;
		scroll_top=document.body.scrollTop || document.documentElement.scrollTop;
		document.title=scroll_left+","+scroll_top;
  	}
&lt;/script&gt;</code></pre>
						<p class="head-indent">如果我们想让页面滚动到某一处，直接给<code>scrollLeft</code>和<code>scrollTop</code>属性赋值即可。</p>
					</section>
					<section>
						<h3>滚动元素节点到视区内</h3>
						<p class="head-indent">页内导航通常也可以根据选取特定元素，将视区跳转到该元素节点上来实现，这样实现的方式是最科学的。</p>
						<ul>
							<li>scrollIntoView()</li>
						</ul>
						<pre class="language-markup"><code>&lt;style&gt;
	button{
		margin: 10px;
	}
	p{
		height: 1000px;
		background-color: #ccc;
	}
&lt;/style&gt;
&lt;body&gt;
	&lt;button&gt;跳转到第一段&lt;/button&gt;
	&lt;button&gt;跳转到第二段&lt;/button&gt;
	&lt;button&gt;跳转到第三段&lt;/button&gt;
	&lt;button&gt;跳转到第四段&lt;/button&gt;
	&lt;button&gt;跳转到第五段&lt;/button&gt;
	&lt;p id="p1"&gt;第一段&lt;/p&gt;
	&lt;p id="p2"&gt;第二段&lt;/p&gt;
	&lt;p id="p3"&gt;第三段&lt;/p&gt;
	&lt;p id="p4"&gt;第四段&lt;/p&gt;
	&lt;p id="p5"&gt;第五段&lt;/p&gt;
&lt;/body&gt;
&lt;script&gt;
	// 获取按钮集合并转换为数组
	var buttons=document.getElementsByTagName("button");
	buttons=Array.prototype.slice.call(buttons);
	// 利用事件实现按钮跳转
	for (var i = buttons.length - 1; i &gt;= 0; i--) {
		buttons[i].onclick=function(){
			var index=buttons.indexOf(this)+1;
			document.querySelector("#p"+index).scrollIntoView();
		}
	}
&lt;/script&gt;</code></pre>
					</section>
				</section>
				<section>
					<h2>结语</h2>
					<p class="head-indent">元素节点的几何量（尺寸、定位偏移量），页面元素的滚动距离等等都是我们经常使用的值，所以清楚的了解什么属性、方法获取什么值是非常有必要的。</p>
				</section>
				<section>
					<h2>参考</h2>
					<p>《DOM启蒙》，Cody Lindley，陈养剑 译</p>
				</section>
			</div>			
		</div>		
	</div>
	
	<script src="/source/js/jquery-3.1.0.min.js"></script>
	<script src="/source/js/prism.js"></script>
	<script src="/source/js/main.js"></script>
</body>
</html>