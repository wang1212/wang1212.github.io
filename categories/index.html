<!DOCTYPE html>
<html lang="en">
<body>
	<div id="list" style="display: block">
		<div class="page-title" style="display: none">笔记 Categories</div>
		<header class="jumbotron jumbotron-fluid">
			<div class="container text-xs-center">
				<h1 class="display-3">笔记 <small class="text-muted hidden-sm-down">Categories</small></h1>
				<hr />
				<p class="lead">
					分享与交流是让我获得提升的最佳途径<br />
					<span class="hidden-xs-down">Sharing and communication is the best way to get my promotion</span>
				</p>
			</div>
		</header>
		<div class="container">
			<ul class="list-group">
				<li class="list-group-item" style="border-color: #fff">
					<p class="text-xs-center">正在奋力加载哟...</p>
				</li>
			</ul>
		</div>		
	</div>
	<div id="content" style="display: none; margin-bottom: 2rem;"></div>

	<script>
		$(function(){
			// Generate list head
			$.getJSON('/source/json/categories.json', function(data){
				var str = '',
					num = 0,
					articles = 0;

				for (var i in data) {
					str += '<li id="cate-' + i + '" class="list-group-item">';
					str += '<h5 class="list-group-item list-group-item-heading list-group-item-action">' + i;
					str += '<div class="float-xs-right"><span class="hidden-md-down tag tag-pill tag-danger">最新：&nbsp;&nbsp;&nbsp;' + data[i][0].title + '</span>&nbsp;';
					str += '<span class="hidden-xs-down tag tag-pill tag-success">最后发表于&nbsp;&nbsp;&nbsp;' + data[i][0].time + '</span>&nbsp;';
					str += '<span class="tag tag-pill tag-primary">' + data[i].length + '&nbsp;&nbsp;&nbsp;articles</span></div></h5>';
					str += '<ul style="display:none" class="list-group"><p class="text-xs-center">正在奋力加载哟...</p></ul></li>';
					num++;
					articles += data[i].length;
				}

				$('#list .list-group').fadeOut(300, function(){
					$(this).append($(str)).children(':first-child').html('有 ' + num + ' 个类别，共 ' + articles + ' 篇文章。加油喔！<small class="hidden-sm-down text-muted">There are ' + num + ' categories, ' + articles + ' articles. Come on!</small>').end().fadeIn(1000);
				});
			});

			// Get list content
			$('#list .list-group').on('click', 'li[id*="cate-"] .list-group-item-heading', function(){
				var $self = $(this),
				 	key = $self.parent().attr('id').substr(5),
				 	$ul = $self.next('ul');

				$ul.slideToggle(500);

				if (!$ul.data('hasData')) {
					$.getJSON('/source/json/categories.json', function(data){
						var str = '';

						for (var i in data[key]){
							str += '<a href="/#' + data[key][i].path + '" class="list-group-item list-group-item-action list-group-item-success">' + data[key][i].title + '<span class="hidden-sm-down float-xs-right">' + data[key][i].time + '</span></a>';
						}

						$ul.hide(300, function(){
							$(this).html(str).slideDown(500);
						});
					});
					
					$ul.data('hasData', true);
				}
			});

			// Get and show content
			$('#list .list-group').on('click', 'a[href*="/#/"]', function(){
				$('#list').slideToggle(300);
			});
		});
	</script>	
</body>
</html>