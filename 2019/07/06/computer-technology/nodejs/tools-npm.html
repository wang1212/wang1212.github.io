<!doctype html><html lang=zh-Hans dir=ltr class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated=false><meta charset=UTF-8><meta name=generator content="Docusaurus v3.8.1"><title data-rh=true>使用 npm | 不如怀念</title><meta data-rh=true name=viewport content="width=device-width, initial-scale=1.0"><meta data-rh=true name=twitter:card content=summary_large_image><meta data-rh=true property=og:url content=https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm><meta data-rh=true property=og:locale content=zh_Hans><meta data-rh=true name=docusaurus_locale content=zh-Hans><meta data-rh=true name=docusaurus_tag content=default><meta data-rh=true name=docsearch:language content=zh-Hans><meta data-rh=true name=docsearch:docusaurus_tag content=default><meta data-rh=true property=og:title content="使用 npm | 不如怀念"><meta data-rh=true name=description content="npm 是 Node.js 的一个包管理器，Web 前端工程师也经常利用它构建前端工作流，来看看如何愉快的使用 npm。"><meta data-rh=true property=og:description content="npm 是 Node.js 的一个包管理器，Web 前端工程师也经常利用它构建前端工作流，来看看如何愉快的使用 npm。"><meta data-rh=true name=keywords content="计算机技术,工具,Web,Web 前端,Web 后端,Node.js,npm"><meta data-rh=true property=og:type content=article><meta data-rh=true property=article:published_time content=2019-07-06T15:43:00.000Z><meta data-rh=true property=article:author content=https://github.com/wang1212><meta data-rh=true property=article:tag content="计算机技术,工具,Web,Web 前端,Web 后端,Node.js,npm"><link data-rh=true rel=icon href=/img/favicon.ico><link data-rh=true rel=canonical href=https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm><link data-rh=true rel=alternate href=https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm hreflang=zh-Hans><link data-rh=true rel=alternate href=https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm hreflang=x-default><script data-rh=true type=application/ld+json>{"@context":"https://schema.org","@id":"https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm","@type":"BlogPosting","author":{"@type":"Person","description":"Web 前端工程师 (Web Front-end Engineer)","email":"mrwang1212@126.com","image":"/img/authors/wang1212.png","name":"不如怀念","url":"https://github.com/wang1212"},"datePublished":"2019-07-06T15:43:00.000Z","description":"npm 是 Node.js 的一个包管理器，Web 前端工程师也经常利用它构建前端工作流，来看看如何愉快的使用 npm。","headline":"使用 npm","isPartOf":{"@id":"https://wang1212.github.io/","@type":"Blog","name":"Blog"},"keywords":["计算机技术","工具","Web","Web 前端","Web 后端","Node.js","npm"],"mainEntityOfPage":"https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm","name":"使用 npm","url":"https://wang1212.github.io/2019/07/06/computer-technology/nodejs/tools-npm"}</script><link rel=alternate type=application/rss+xml href=/rss.xml title="不如怀念 RSS Feed"><link rel=alternate type=application/atom+xml href=/atom.xml title="不如怀念 Atom Feed"><link rel=stylesheet href=/assets/css/styles.9a43e9e5.css><script src=/assets/js/runtime~main.dd1c5908.js defer></script><script src=/assets/js/main.0d9b245b.js defer></script><body class=navigation-with-keyboard><svg xmlns=http://www.w3.org/2000/svg style="display: none;"><defs>
<symbol id=theme-svg-external-link viewBox="0 0 24 24"><path fill=currentColor d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t="light",e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",e||t),document.documentElement.setAttribute("data-theme-choice",e||t)}(),function(){try{for(var[t,e]of new URLSearchParams(window.location.search).entries())if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id=__docusaurus><link rel=preload as=image href=/img/authors/wang1212.png><div role=region aria-label=跳到主要内容><a class=skipToContent_fXgn href=#__docusaurus_skipToContent_fallback>跳到主要内容</a></div><nav aria-label=主导航 class="theme-layout-navbar navbar navbar--fixed-top navbarHideable_m1mJ"><div class=navbar__inner><div class="theme-layout-navbar-left navbar__items"><button aria-label=切换导航栏 aria-expanded=false class="navbar__toggle clean-btn" type=button><svg width=30 height=30 viewBox="0 0 30 30" aria-hidden=true><path stroke=currentColor stroke-linecap=round stroke-miterlimit=10 stroke-width=2 d="M4 7h22M4 15h22M4 23h22"/></svg></button><a class=navbar__brand href=/><b class="navbar__title text--truncate">不如怀念</b></a><a class="navbar__item navbar__link" href=/archive>归档</a><a class="navbar__item navbar__link" href=/timeline>历程</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class="navbar__item navbar__link">精选资源<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type=button disabled title="system mode" aria-label="切换浅色/暗黑模式（当前为system mode）"><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill=currentColor d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill=currentColor d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"/></svg><svg viewBox="0 0 24 24" width=24 height=24 aria-hidden=true class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill=currentColor d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"/></svg></button></div><div class=navbarSearchContainer_Bca1><div class="navbar__search searchBarContainer_NW3z" dir=ltr><input placeholder=搜索 aria-label=Search class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role=presentation class=navbar-sidebar__backdrop></div></nav><div id=__docusaurus_skipToContent_fallback class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class=row><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label=最近博文导航><div class="sidebarItemTitle_pO2u margin-bottom--md">近期文章</div><div role=group><h3 class=yearGroupHeading_rMGB>2025</h3><ul class="sidebarItemList_Yudw clean-list"><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/10/weekly/2025/weekly-review-ep2025w32>「每周回顾」EP2025W32：GPT-5 发布、Gemini 新功能、gpt-oss 开源及多项开发者工具更新</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/08/03/weekly/2025/weekly-review-ep2025w31>「每周回顾」EP2025W31：Node.js 新版本、Figma 成功上市、GLM-4.5 开源等</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/27/weekly/2025/weekly-review-ep2025w30>「每周回顾」EP2025W30：GitHub Spark、React 编译器与千问 Qwen3 Coder</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/20/weekly/2025/weekly-review-ep2025w29>「每周回顾」EP2025W29：AI 工具进展与 WebAssembly 的十年</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/13/weekly/2025/weekly-review-ep2025w28>「每周回顾」EP2025W28：Grok 4 发布与 AI 企业服务转型</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/07/06/weekly/2025/weekly-review-ep2025w27>「每周回顾」EP2025W27：GitHub Copilot Chat 开源</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/29/weekly/2025/weekly-review-ep2025w26>「每周回顾」EP2025W26：ECMAScript 2025 正式发布，AI 代理与前端工具持续演进</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/22/weekly/2025/weekly-review-ep2025w25>「每周回顾」EP2025W25：AI 编程趋势、React 发展与 AI 代理安全</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/15/weekly/2025/weekly-review-ep2025w24>「每周回顾」EP2025W24：React 服务器组件中导入的工作原理</a><li class=sidebarItem__DBe><a class=sidebarItemLink_mo7H href=/2025/06/08/weekly/2025/weekly-review-ep2025w23>「每周回顾」EP2025W23：探索 Claude 4 系统提示与渐进式 JSON</a></ul></div></nav></aside><main class="col col--7"><article class=""><header><h1 class=title_f1Hy>使用 npm</h1><div class="container_mt6G margin-vert--md"><time datetime=2019-07-06T15:43:00.000Z>2019年7月6日</time> · <!-- -->阅读需 11 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--12 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=avatar__photo-link><img class="avatar__photo authorImage_XqGP" src=/img/authors/wang1212.png alt=不如怀念></a><div class="avatar__intro authorDetails_lV9A"><div class=avatar__name><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer"><span class=authorName_yefp>不如怀念</span></a></div><small class=authorTitle_nd0D title="Web 前端工程师 (Web Front-end Engineer)">Web 前端工程师 (Web Front-end Engineer)</small><div class=authorSocials_rSDt><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=authorSocialLink_owbf title=GitHub><svg xmlns=http://www.w3.org/2000/svg width=1em height=1em viewBox="0 0 256 250" preserveAspectRatio=xMidYMid style=--dark:#000;--light:#fff class="authorSocialLink_owbf githubSvg_Uu4N"><path d="M128.001 0C57.317 0 0 57.307 0 128.001c0 56.554 36.676 104.535 87.535 121.46 6.397 1.185 8.746-2.777 8.746-6.158 0-3.052-.12-13.135-.174-23.83-35.61 7.742-43.124-15.103-43.124-15.103-5.823-14.795-14.213-18.73-14.213-18.73-11.613-7.944.876-7.78.876-7.78 12.853.902 19.621 13.19 19.621 13.19 11.417 19.568 29.945 13.911 37.249 10.64 1.149-8.272 4.466-13.92 8.127-17.116-28.431-3.236-58.318-14.212-58.318-63.258 0-13.975 5-25.394 13.188-34.358-1.329-3.224-5.71-16.242 1.24-33.874 0 0 10.749-3.44 35.21 13.121 10.21-2.836 21.16-4.258 32.038-4.307 10.878.049 21.837 1.47 32.066 4.307 24.431-16.56 35.165-13.12 35.165-13.12 6.967 17.63 2.584 30.65 1.255 33.873 8.207 8.964 13.173 20.383 13.173 34.358 0 49.163-29.944 59.988-58.447 63.157 4.591 3.972 8.682 11.762 8.682 23.704 0 17.126-.148 30.91-.148 35.126 0 3.407 2.304 7.398 8.792 6.14C219.37 232.5 256 184.537 256 128.002 256 57.307 198.691 0 128.001 0Zm-80.06 182.34c-.282.636-1.283.827-2.194.39-.929-.417-1.45-1.284-1.15-1.922.276-.655 1.279-.838 2.205-.399.93.418 1.46 1.293 1.139 1.931Zm6.296 5.618c-.61.566-1.804.303-2.614-.591-.837-.892-.994-2.086-.375-2.66.63-.566 1.787-.301 2.626.591.838.903 1 2.088.363 2.66Zm4.32 7.188c-.785.545-2.067.034-2.86-1.104-.784-1.138-.784-2.503.017-3.05.795-.547 2.058-.055 2.861 1.075.782 1.157.782 2.522-.019 3.08Zm7.304 8.325c-.701.774-2.196.566-3.29-.49-1.119-1.032-1.43-2.496-.726-3.27.71-.776 2.213-.558 3.315.49 1.11 1.03 1.45 2.505.701 3.27Zm9.442 2.81c-.31 1.003-1.75 1.459-3.199 1.033-1.448-.439-2.395-1.613-2.103-2.626.301-1.01 1.747-1.484 3.207-1.028 1.446.436 2.396 1.602 2.095 2.622Zm10.744 1.193c.036 1.055-1.193 1.93-2.715 1.95-1.53.034-2.769-.82-2.786-1.86 0-1.065 1.202-1.932 2.733-1.958 1.522-.03 2.768.818 2.768 1.868Zm10.555-.405c.182 1.03-.875 2.088-2.387 2.37-1.485.271-2.861-.365-3.05-1.386-.184-1.056.893-2.114 2.376-2.387 1.514-.263 2.868.356 3.061 1.403Z"/></svg></a></div></div></div></div></div></header><blockquote>最后更新于 <!-- -->2024-09-01 13:09:00</blockquote><div id=__blog-post-container class=markdown><p>npm 是 Node.js 的一个包管理器，Web 前端工程师也经常利用它来简化开发流程，看看如何愉快的使用 npm ，并且发布自己的包，让 npm 成为我们的开发利器。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=npm>npm<a href=#npm class=hash-link aria-label=npm的直接链接 title=npm的直接链接>​</a></h2>
<blockquote>
<p><strong>Node.js：</strong><a href=https://www.npmjs.com/ target=_blank rel="noopener noreferrer">https://www.npmjs.com/</a></p>
</blockquote>
<blockquote>
<p><strong>npm：</strong><a href=https://www.npmjs.com/ target=_blank rel="noopener noreferrer">https://www.npmjs.com/</a></p>
</blockquote>
<p>npm 通常是伴随着 Node.js 一起安装的，只要安装了 Node.js，那么 npm 也就已经安装好了，可以在命令行运行以下命令查看版本：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">node -v</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm -v</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=换源>换源<a href=#换源 class=hash-link aria-label=换源的直接链接 title=换源的直接链接>​</a></h2>
<p>这是作为墙内的开发者必须掌握的一项技能，将 npm 的官方源替换为国内源，这样下载 npm 包速度也会更快，更不容易出错。</p>
<p>运行以下命令查看 npm 配置，其中有仓库源 <code>registry</code> 一项：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm config list</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm config get registry     // 只查看 registry 配置</span><br></span></code></pre></div></div>
<p>更换仓库源：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm config set registry &lt;source></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm config set registry https://registry.npmjs.org/         // 换回官方源</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm config set registry https://registry.npm.taobao.org/    // 换到国内淘宝源</span><br></span></code></pre></div></div>
<p>更换掉仓库源之后，再查看下是否更换成功。</p>
<p><strong>请勿使用 cnpm 等其它类似工具，用官方 npm 换到国内源即可。</strong></p>
<blockquote>
<p>常用源切换工具 <a href=https://www.npmjs.com/package/nrm target=_blank rel="noopener noreferrer">nrm</a></p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=常用命令>常用命令<a href=#常用命令 class=hash-link aria-label=常用命令的直接链接 title=常用命令的直接链接>​</a></h2>
<p>通常来说，我们只会利用 npm 来安装、卸载依赖包，或者在项目启动时进行初始化。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm init [-y]   // 在当前文件夹初始化，生成一个 package.json 文件，-y 选项为全部默认</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-install</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm install --global|-g &lt;package_name>     // 在全局安装指定包</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm uninstall --global|-g &lt;package_name>   // 卸载安装在全局的指定包</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm install [-P|--save] &lt;package_name>     // 在当前项目本地安装生产环境依赖包，会列在 dependencies 中</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm uninstall [-S|--save] &lt;package_name>   // 卸载安装在项目本地的 dependencies 中指定包</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm install -D|--save-dev &lt;package_name>   // 在当前项目本地安装开发环境依赖包，会列在 devDependencies 中</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm uninstall -D|--save-dev &lt;package_name> // 卸载安装在项目本地的 devDependencies 中指定包</span><br></span></code></pre></div></div>
<p>这里值得一提的是，在 npm 5.2+ 之后，附带了一个 <code>npx</code> 命令，作用是<strong>执行包的二进制文件</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://www.npmjs.com/package/npx</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npx [options] [-p|--package &lt;pkg>]... &lt;command> [command-arg]...</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npx create-react-app my-app     // 执行 create-react-app 包的主命令</span><br></span></code></pre></div></div>
<p>通过 <code>npx</code> 命令执行包的二进制文件有一个优点：<strong>不需要安装包，即可执行包的命令，对本地环境无污染。</strong></p>
<p>而且，在 npm 6.0+ 之后，<code>init</code> 命令可以接收一个新的选项：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-init</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm init &lt;initializer></span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm init react-app my-app       // same as : npx create-react-app my-app</span><br></span></code></pre></div></div>
<p>其中 <code>&lt;initializer></code> 是一个以 <code>create-</code> 开头命名的包，算是对这种特殊命名的包的 <code>npx</code> 命令的简写方式。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=node-版本管理>Node 版本管理<a href=#node-版本管理 class=hash-link aria-label="Node 版本管理的直接链接" title="Node 版本管理的直接链接">​</a></h2>
<p>作为一名 Node.js 开发，如何在自己的设备上管理多个 Node 版本是一个相当重要的技能，而 npm 库中的 <a href=https://www.npmjs.com/package/n target=_blank rel="noopener noreferrer"><code>n</code></a> 模块就为我们提供了最佳解决方案，使用它可以在同一台设备上安装多个不同版本的 Node，并随时进行切换，同时也可以方便的升级、降级。</p>
<p>作为一个管理 Node 的工具，建议将其安装在全局：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm install -g n</span><br></span></code></pre></div></div>
<p>安装完成后，执行以下命令安装相应版本的 Node：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">n &lt;version> // eg: n 10.16.0</span><br></span><span class=token-line style=color:#393A34><span class="token plain">n latest    // 安装最新版 node</span><br></span><span class=token-line style=color:#393A34><span class="token plain">n lts       // 安装最新的 LTS 版本 node</span><br></span></code></pre></div></div>
<p>查看已安装的所有版本的 Node：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">n   // 貌似只能查看通过 n 模块安装的 node</span><br></span></code></pre></div></div>
<p>切换 node 版本来执行命令：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">n use &lt;version> [args ...]    // 切换到已安装的另一个版本的 node 并执行命令</span><br></span></code></pre></div></div>
<p>卸载 node：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">n rm &lt;version>      // 卸载指定版本 node</span><br></span><span class=token-line style=color:#393A34><span class="token plain">n prune             // 卸载所有已安装 node 版本，但当前正在使用的 node 版本不会被卸载</span><br></span></code></pre></div></div>
<blockquote>
<p>Windows 平台用户可以使用 <a href=https://github.com/coreybutler/nvm-windows target=_blank rel="noopener noreferrer">nvm-windows</a></p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=npm-升级>npm 升级<a href=#npm-升级 class=hash-link aria-label="npm 升级的直接链接" title="npm 升级的直接链接">​</a></h2>
<p>虽然 npm 是随 Node 一起安装的，但在之后通过 <code>n</code> 模块升级 Node 的过程中，npm 不会也跟着升级，需要我们手动升级：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm install -g npm[@latest|&lt;version>]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=发布-npm-包>发布 npm 包<a href=#发布-npm-包 class=hash-link aria-label="发布 npm 包的直接链接" title="发布 npm 包的直接链接">​</a></h2>
<p>通常，我们只是下载安装 npm 库中的包来使用，辅助我们进行开发，但去了解如何利用 npm 发布包也是有必要的，这样我们也可以写一些自己的模块并进行发布供自己和他人使用。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=注册>注册<a href=#注册 class=hash-link aria-label=注册的直接链接 title=注册的直接链接>​</a></h3>
<p>首先需要去 npm 官网注册一个账号（无需翻墙）。如果想更换头像的话，还要去注册一个 <strong>Gravatar</strong> 并上传一张照片，才可以将这张照片作为头像。</p>
<blockquote>
<p><strong>npm：</strong><a href=https://www.npmjs.com/ target=_blank rel="noopener noreferrer">https://www.npmjs.com/</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=初始化>初始化<a href=#初始化 class=hash-link aria-label=初始化的直接链接 title=初始化的直接链接>​</a></h3>
<p>在本地新建一个文件夹，并初始化：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm init [-y]</span><br></span></code></pre></div></div>
<p>然后，修改生成的 <code>package.json</code> 中的必要字段，例如 <code>name</code>、<code>author</code>、<code>homepage</code> 等等，具体的字段以及含义可以去查 npm 的官方文档。</p>
<p><strong>这里需要注意的是，如果你将要发布的包，是别人通过 <code>require('package_name')</code> 来使用的话，请指定 <code>package.json</code> 中的 <code>main</code> 字段为该包的入口文件。或者，也可能你将要发布的包只是一个命令行工具，那么删除掉 <code>main</code> 字段，指定 <code>bin</code> 字段即可。当然 <code>main</code> 与 <code>bin</code> 是可以共存的。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=编码>编码<a href=#编码 class=hash-link aria-label=编码的直接链接 title=编码的直接链接>​</a></h3>
<p>初始化完成后，就主要是我们编码了，建议将入口文件放在项目根目录下，其余代码文件都放在相应文件夹下：</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-text codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">Package/</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - build/   // 编译后用于生产环境的文件</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - config/  // 项目开发环境配置文件</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - bin/     // 项目命令行脚本文件</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - scripts/ // 项目 npm 脚本文件</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - src/     // 项目源码文件</span><br></span><span class=token-line style=color:#393A34><span class="token plain">  - index.js // 项目入口文件</span><br></span></code></pre></div></div>
<p><strong>这里需要注意，<code>bin/</code> 中的命令行脚本文件，必须在每个文件的第一行指定 <code>#!/usr/bin/env node</code>，表明这是一个 node 脚本，以及执行该脚本的二进制文件系统路径。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=发布前本地测试>发布前本地测试<a href=#发布前本地测试 class=hash-link aria-label=发布前本地测试的直接链接 title=发布前本地测试的直接链接>​</a></h3>
<p>在编码完成并完善 <code>package.json</code> 文件后，我们可能需要测试才能确保最终发布后能被自己或者他人通过 npm 安装正常使用。</p>
<p>我们不需要反复进行<strong>发布--测试--修复--撤销发布--重新发布</strong>这个过程，npm 官方为我们提供了便捷的本地测试工具，也就是 <code>link</code> 命令。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-link</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm link    // 在你将要发布的包根目录下执行该命令，如同将其安装到全局一样，更改文件及时生效，不需要重新 link</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm link &lt;package_name>     // 在另外一个测试目录中执行该命令，如同 install</span><br></span><span class=token-line style=color:#393A34><span class="token plain" style=display:inline-block></span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm unlink  // 测试完成后，在你将要发布的包根目录下执行该命令，unlink 会将其从全局卸载</span><br></span></code></pre></div></div>
<p>本地测试还是相当简单和方便的，也是无污染的。但是， <code>npm link</code> 并不是最好的方案，查看以下文章：</p>
<blockquote>
<p><a href=https://hirok.io/posts/avoid-npm-link target=_blank rel="noopener noreferrer">4 reasons to avoid using <code>npm link</code></a></p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=小技巧>小技巧<a href=#小技巧 class=hash-link aria-label=小技巧的直接链接 title=小技巧的直接链接>​</a></h4>
<p>这里有个小技巧可以不使用 <code>npm link</code> 命令就能在本地测试，而且是真的无污染：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token property" style=color:#36acaa>"dependencies"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"my-dev-module"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"file:../my-dev-module/index.min.js"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=登录>登录<a href=#登录 class=hash-link aria-label=登录的直接链接 title=登录的直接链接>​</a></h3>
<p>发布前需要在命令行登录 npm <strong>官方仓库</strong>：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-adduser</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm login [--registry=url] [--scope=@orgname]</span><br></span></code></pre></div></div>
<p><strong>注意：如果替换了官方源，一定要指定 <code>--registry=https://registry.npmjs.org/</code>，这样才能登录到官方仓库进行发布。</strong><code>--scope</code>则是命名空间，例如 <code>@babel</code>。</p>
<p>登录成功后，可以查看已登录用户：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-whoami</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm whoami [--registry &lt;registry>]</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=发布>发布<a href=#发布 class=hash-link aria-label=发布的直接链接 title=发布的直接链接>​</a></h3>
<p>登录后，即可通过 <code>publish</code> 命令发布包：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-publish</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm publish [--access public]   // 在将要发布的包根目录执行</span><br></span></code></pre></div></div>
<p><strong>需要注意，如果发布的包带有命名空间，例如 <code>@babel/core</code>，需要指定发布限制范围 <code>--access</code>，默认为 <code>restricted</code>（受限制），如你的 npm 帐户不是付费帐户，必须指定为 <code>public</code>。</strong></p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=撤销发布>撤销发布<a href=#撤销发布 class=hash-link aria-label=撤销发布的直接链接 title=撤销发布的直接链接>​</a></h3>
<p>通常，是在本地测试无误后进行发布，如果真的在发布后发现问题，导致不能正常使用，可以撤销发布：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-unpublish</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm unpublish [&lt;@scope>/]&lt;package_name>[@&lt;version>]</span><br></span></code></pre></div></div>
<p>**事实上，npm 官方不建议开发者使用 <code>unpublish</code> 命令来撤销发布，因为如果其它用户已经安装了该包作为依赖，并能正常使用的情况下该包被撤销，会导致其它用户无法再次安装该包。**所以，尽可能用 <code>deprecate</code> 命令来表明该包已被弃用，即便用户安装成功，也会有醒目的提示告知用户已被弃用，用户则会及时寻找替代包。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-deprecate</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm deprecate &lt;package_name>[@&lt;version>] &lt;message></span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=退出登录>退出登录<a href=#退出登录 class=hash-link aria-label=退出登录的直接链接 title=退出登录的直接链接>​</a></h3>
<p>如果不是在自己的机器上工作，建议完成发布后退出登录，保证数据安全。退出登录与登录一样简单，同样需要指定 <code>--registry</code> 与 <code>--scope</code> 参数。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain"># https://docs.npmjs.com/cli/v6/commands/npm-logout</span><br></span><span class=token-line style=color:#393A34><span class="token plain">npm logout [--registry=url] [--scope=@orgname]</span><br></span></code></pre></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=最佳实践>最佳实践<a href=#最佳实践 class=hash-link aria-label=最佳实践的直接链接 title=最佳实践的直接链接>​</a></h2>
<p>以上，是使用 npm 工具本身的过程，但 npm 工具本质上是为维护和发布 Node 模块/包服务的，开发 Node 模块/包有一些很好的社区实践，这里大致记录一下开发 Node 模块/包过程中一些注意的关键点。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=模块包的类型>模块/包的类型<a href=#模块包的类型 class=hash-link aria-label=模块/包的类型的直接链接 title=模块/包的类型的直接链接>​</a></h3>
<p>根据用途，模块/包的类型大致可以分为以下几种，不同的类型需要做对应的处理。</p>
<ul>
<li>Node 包</li>
<li>Web 包</li>
</ul>
<p>Node 包一般来说发布时是不需要压缩的，JavaScript 代码也不需要编译，但需要标记一些特殊字段（如 <code>engines</code>）表明包所依赖的 Node 版本限制。</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token comment" style=color:#999988;font-style:italic>// https://docs.npmjs.com/cli/v6/configuring-npm/package-json#engines</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"engines"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"> </span><span class="token property" style=color:#36acaa>"node"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>">=0.10.3 &lt;0.12"</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>而用于 Web 的包在发布前通常需要进行编译和压缩，目的是解决兼容性问题和资源加载优化，而这些工作一般借助 <strong>Babel</strong>、<strong>Rollup</strong> 等工具配合使用即可。另一方面，用于 Web 的包在开发过程中为了便于调试，所以引入的应该是未经编译和压缩的源码版本，而打包时再引入经过编译和压缩的版本，实现这个目的社区有一个比较通用的做法就是在入口文件使用 <code>NODE_ENV</code> 进行判断并导出相应版本文件，以下是 React 的入口文件示例：</p>
<div class="language-js codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-js codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token keyword control-flow" style=color:#00009f>if</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>(</span><span class="token plain">process</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">env</span><span class="token punctuation" style=color:#393A34>.</span><span class="token constant" style=color:#36acaa>NODE_ENV</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>===</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>'production'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  module</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>require</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'./cjs/react.production.min.js'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><span class="token plain"> </span><span class="token keyword control-flow" style=color:#00009f>else</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  module</span><span class="token punctuation" style=color:#393A34>.</span><span class="token property-access">exports</span><span class="token plain"> </span><span class="token operator" style=color:#393A34>=</span><span class="token plain"> </span><span class="token function" style=color:#d73a49>require</span><span class="token punctuation" style=color:#393A34>(</span><span class="token string" style=color:#e3116c>'./cjs/react.development.js'</span><span class="token punctuation" style=color:#393A34>)</span><span class="token punctuation" style=color:#393A34>;</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>通过下面这篇文章即可了解实现细节。</p>
<blockquote>
<p><a href=https://overreacted.io/how-does-the-development-mode-work/ target=_blank rel="noopener noreferrer">https://overreacted.io/how-does-the-development-mode-work/</a></p>
</blockquote>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=支持多个环境>支持多个环境<a href=#支持多个环境 class=hash-link aria-label=支持多个环境的直接链接 title=支持多个环境的直接链接>​</a></h3>
<p>纵观 Node.js 的发展历史，其生态中出现过多种模式，例如 <a href=https://github.com/amdjs/amdjs-api/blob/master/AMD.md target=_blank rel="noopener noreferrer">AMD</a>、<a href=http://www.commonjs.org/ target=_blank rel="noopener noreferrer">CommonJS</a>、ESM(ECMAScript modules)，以及 <a href=https://github.com/umdjs/umd target=_blank rel="noopener noreferrer">UMD</a>，这种情况给包的开发带来一定困难，不过经过多年的发展社区已经形成一个约定（共识），可以很方便的解决该问题从而同时支持所有环境。</p>
<p>主要是通过对应字段导出不同的入口文件来实现，下面是一个示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"main"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"index.js"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"module"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"index.esm.js"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"browser"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"index.umd.js"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<p>具体实现可以通过下面这篇文章进行了解。</p>
<blockquote>
<p><a href=https://2ality.com/2017/04/setting-up-multi-platform-packages.html target=_blank rel="noopener noreferrer">https://2ality.com/2017/04/setting-up-multi-platform-packages.html</a></p>
</blockquote>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=新的方案>新的方案<a href=#新的方案 class=hash-link aria-label=新的方案的直接链接 title=新的方案的直接链接>​</a></h4>
<p>事实上，<code>main</code> 和 <code>browser</code> 字段在 npm 文档中有定义，查看文档：</p>
<blockquote>
<p><a href=https://docs.npmjs.com/cli/v6/configuring-npm/package-json#main target=_blank rel="noopener noreferrer">https://docs.npmjs.com/cli/v6/configuring-npm/package-json#main</a></p>
</blockquote>
<p>而 <code>module</code> 字段后来并没有被 Node 社区采用，而是推出了新的模块入口点定义字段 <code>exports</code>，配合<strong>条件导出</strong>我们就可以实现支持多个环境。查看文档：</p>
<blockquote>
<p><a href=https://nodejs.org/dist/latest-v16.x/docs/api/packages.html#package-entry-points target=_blank rel="noopener noreferrer">https://nodejs.org/dist/latest-v16.x/docs/api/packages.html#package-entry-points</a></p>
</blockquote>
<p>示例：</p>
<div class="language-json codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-json codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"exports"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token punctuation" style=color:#393A34>{</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"import"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"./index.esm.js"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"require"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"./index.cjs.js"</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">    </span><span class="token property" style=color:#36acaa>"browser"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"./index.umd.js"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token punctuation" style=color:#393A34>}</span><span class="token punctuation" style=color:#393A34>,</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain">  </span><span class="token property" style=color:#36acaa>"main"</span><span class="token operator" style=color:#393A34>:</span><span class="token plain"> </span><span class="token string" style=color:#e3116c>"./index.cjs.js"</span><span class="token plain"></span><br></span><span class=token-line style=color:#393A34><span class="token plain"></span><span class="token punctuation" style=color:#393A34>}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=类型定义>类型定义<a href=#类型定义 class=hash-link aria-label=类型定义的直接链接 title=类型定义的直接链接>​</a></h3>
<p>JavaScript 并不是一个强类型语言，所以 IDE 要做类型推断和代码智能提示是比较困难的，尤其是编译、压缩、混淆后的代码对于用户使用有诸多不便，要不断的查询文档。然而，<a href=https://www.typescriptlang.org/ target=_blank rel="noopener noreferrer">TypeScript</a> 的出现使这一状况得到了改善，如果源代码直接使用 TypeScript 编写，最终编译时生成<strong>类型定义文件</strong>，在发布 npm 模块/包时指定一个 <code>types</code> 字段即可，查看文档：</p>
<blockquote>
<p><a href=https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html target=_blank rel="noopener noreferrer">https://www.typescriptlang.org/docs/handbook/declaration-files/publishing.html</a></p>
</blockquote>
<p>对于使用 JavaScript 编写的源代码，事实上也可以利用 TypeScript 工具生成相应的类型定义文件，并随之一起发布，查看文档：</p>
<blockquote>
<p><a href=https://www.typescriptlang.org/docs/handbook/declaration-files/dts-from-js.html target=_blank rel="noopener noreferrer">https://www.typescriptlang.org/docs/handbook/declaration-files/dts-from-js.html</a></p>
</blockquote>
<p>在使用第三方库时，如果作者发布时没有附带类型定义文件，我们则可以去社区维护的 <a href=https://github.com/DefinitelyTyped/DefinitelyTyped target=_blank rel="noopener noreferrer">DefinitelyTyped</a> 仓库中看看，使用 npm 命令即可查询：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style=--prism-color:#393A34;--prism-background-color:#f6f8fa><div class=codeBlockContent_QJqH><pre tabindex=0 class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style=color:#393A34;background-color:#f6f8fa><code class=codeBlockLines_e6Vv><span class=token-line style=color:#393A34><span class="token plain">npm info @types/react</span><br></span></code></pre></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id=参考资料>参考资料<a href=#参考资料 class=hash-link aria-label=参考资料的直接链接 title=参考资料的直接链接>​</a></h3>
<ul>
<li><a href=https://github.com/sarbbottam/write-an-open-source-js-lib target=_blank rel="noopener noreferrer">https://github.com/sarbbottam/write-an-open-source-js-lib</a></li>
<li><a href=https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html target=_blank rel="noopener noreferrer">https://reactjs.org/blog/2017/12/15/improving-the-repository-infrastructure.html</a></li>
<li><a href=https://blog.isquaredsoftware.com/2023/08/esm-modernization-lessons/ target=_blank rel="noopener noreferrer">https://blog.isquaredsoftware.com/2023/08/esm-modernization-lessons/</a></li>
</ul></div><footer class=docusaurus-mt-lg><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/计算机技术>计算机技术</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/工具>工具</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/web>Web</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/web-前端>Web 前端</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/web-后端>Web 后端</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/node-js>Node.js</a><li class=tag_QGVx><a rel=tag class="tag_zVej tagRegular_sFm0" href=/tags/npm>npm</a></ul></div></div><div class="row margin-top--sm theme-blog-footer-edit-meta-row"><div class=col><a href=https://github.com/wang1212/wang1212.github.io/tree/master/blog/computer-technology/nodejs/2019-07-06-tools-npm.md target=_blank rel="noopener noreferrer" class=theme-edit-this-page><svg fill=currentColor height=20 width=20 viewBox="0 0 40 40" class=iconEdit_Z9Sw aria-hidden=true><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"/></g></svg>编辑此页</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label=博文分页导航><a class="pagination-nav__link pagination-nav__link--prev" href=/2019/07/16/life/reading><div class=pagination-nav__sublabel>较新一篇</div><div class=pagination-nav__label>经济学的意义</div></a><a class="pagination-nav__link pagination-nav__link--next" href=/2019/06/11/life/tourism/tourism-chengdu-company><div class=pagination-nav__sublabel>较旧一篇</div><div class=pagination-nav__label>再游成都</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href=#npm class="table-of-contents__link toc-highlight">npm</a><li><a href=#换源 class="table-of-contents__link toc-highlight">换源</a><li><a href=#常用命令 class="table-of-contents__link toc-highlight">常用命令</a><li><a href=#node-版本管理 class="table-of-contents__link toc-highlight">Node 版本管理</a><li><a href=#npm-升级 class="table-of-contents__link toc-highlight">npm 升级</a><li><a href=#发布-npm-包 class="table-of-contents__link toc-highlight">发布 npm 包</a><ul><li><a href=#注册 class="table-of-contents__link toc-highlight">注册</a><li><a href=#初始化 class="table-of-contents__link toc-highlight">初始化</a><li><a href=#编码 class="table-of-contents__link toc-highlight">编码</a><li><a href=#发布前本地测试 class="table-of-contents__link toc-highlight">发布前本地测试</a><li><a href=#登录 class="table-of-contents__link toc-highlight">登录</a><li><a href=#发布 class="table-of-contents__link toc-highlight">发布</a><li><a href=#撤销发布 class="table-of-contents__link toc-highlight">撤销发布</a><li><a href=#退出登录 class="table-of-contents__link toc-highlight">退出登录</a></ul><li><a href=#最佳实践 class="table-of-contents__link toc-highlight">最佳实践</a><ul><li><a href=#模块包的类型 class="table-of-contents__link toc-highlight">模块/包的类型</a><li><a href=#支持多个环境 class="table-of-contents__link toc-highlight">支持多个环境</a><li><a href=#类型定义 class="table-of-contents__link toc-highlight">类型定义</a><li><a href=#参考资料 class="table-of-contents__link toc-highlight">参考资料</a></ul></ul></div></div></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class=footer__title>关于我</div><ul class="footer__items clean-list"><li class=footer__item><a href=mailto:mrwang1212@126.com target=_blank rel="noopener noreferrer" class=footer__link-item>Email<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://github.com/wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>GitHub<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://gitee.com/i_wang1212 target=_blank rel="noopener noreferrer" class=footer__link-item>Gitee<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div><div class="theme-layout-footer-column col footer__col"><div class=footer__title>更多</div><ul class="footer__items clean-list"><li class=footer__item><a href=https://wang1212.github.io/awesome-favorites-list target=_blank rel="noopener noreferrer" class=footer__link-item>Awesome Favorites List<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/the-book-of-ruby target=_blank rel="noopener noreferrer" class=footer__link-item>The Book Of Ruby (ZH)<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a><li class=footer__item><a href=https://wang1212.github.io/echarts-api-docs target=_blank rel="noopener noreferrer" class=footer__link-item>Apache ECharts APIs Guide<svg width=13.5 height=13.5 aria-hidden=true class=iconExternalLink_nPIU><use href=#theme-svg-external-link /></svg></a></ul></div></div><div class="footer__bottom text--center"><div class=footer__copyright>Copyright © 2025 My Blog. Built with Docusaurus.</div></div></div></footer></div>